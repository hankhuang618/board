<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NFC_SYSTEM</title>


  <!-- 引入你的 JavaScript 文件 -->


  <script src="js/vue.js"></script>
  <script src="js/chart.js"></script>
  <script src="js/vuechat2.js"></script>
  <script src="js/axios.min.js"></script>
    <script type="text/javascript" src="js/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/element-ui/2.15.13/theme-chalk/index.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/element-ui/2.15.13/index.js"></script>


</head>

<style>
    body {
    font-family: Arial, sans-serif; /* 設定全站字體為 Arial 或無襯線字體 */
    background-color: #ffffff; /* 設定背景顏色為深藍灰色 */
    color: #000000; /* 設定全站文字顏色為淺灰白色 */
    display: flex; /* 使用 Flexbox 讓內容置中 */
    justify-content: center; /* 讓內容在水平方向置中 */
    align-items: center; /* 讓內容在垂直方向置中 */
   
    margin: 0; /* 移除預設外邊距 */
    overflow: hidden; /* 防止 body 出現滾動條 */

}

#app {
  height: auto; /* 高度自适应 */
    background: #0b69c702; /* 背景顏色幾乎透明 */
    padding: 10px; /* 設定內邊距為 20px */
    border-radius: 10px; /* 設定圓角為 10px */
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); /* 添加陰影效果 */
    overflow: hidden; /* 防止 body 出現滾動條 */

}

.right-content {
    text-align: center; /* 內容文字置中 */
    height: auto; /* 高度自适应 */
    max-height: 70vh; /* 最大高度为视口高度，确保在页面超出时可以滚动 */
    flex-wrap: wrap; /* 允許內容自動換行 */
    justify-content: space-between; /* 讓內容平均分布 */
    align-items: center; /* 內容垂直置中 */
    overflow: auto; /* 若內容超出則允許滾動 */
}

header {
    font-size: 25px; /* 設定字體大小 */
    font-weight: bold; /* 設定字體加粗 */
    margin-bottom: 15px; /* 設定底部外邊距 */
    border-bottom: 2px solid #ecf0f1; /* 設定底部邊框顏色 */
    padding-bottom: 8px; /* 設定底部內邊距 */
    width: 100%; /* 讓標題寬度填滿容器 */
    text-align: center; /* 讓標題置中 */
}

.info-container {
    display: flex; /* 使用 Flexbox 來對齊內容 */
    flex-wrap: wrap; /* 允許內容自動換行 */
    gap: 10px; /* 設定內容之間的間距 */
    justify-content: center; /* 讓內容在水平方向置中 */
    align-items: center; /* 讓內容在垂直方向置中 */
    width: 100%; /* 設定寬度為 100% */
}

label {
    font-size: 14px; /* 設定標籤的字體大小 */
    background: transparent; /* 設定背景為透明 */
    padding: 5px 10px; /* 設定內邊距 */
    border-radius: 0; /* 移除圓角 */
    text-align: center; /* 讓文字置中 */
    min-width: 100px; /* 設定最小寬度，確保標籤大小一致 */
    border: none; /* 移除邊框 */
}

button {
    background-color: #e2e6e7; /* 淺灰色背景 */
    color: #000000; /* 深灰文字 */
    border: 2px solid #000000; /* 黑色實線邊框 */
    padding: 5px 10px;
    font-size: 12px;
    font-weight: bold;
    cursor: pointer;
    border-radius: 6px;
    transition: all 0.2s ease;
}

button:hover {
    background-color: #aeb6bf; /* 滑過時變深一點的灰色 */
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
}

button:active {
    background-color: #99a3a4; /* 按下時再深一點 */
    transform: translateY(1px);
    box-shadow: none;
}

  /* 限制表格容器的最大高度，當內容超出時啟用水平滾動條 */
.table-container {
    overflow-x: auto; /* 啟用橫向滾動條 */
    max-height: 400px; /* 最大高度 400px，超過則滾動 */
}

/* 設定表格及 Element UI 的 .el-table 樣式 */
table, .el-table {
    width: 100%; /* 讓表格寬度撐滿容器 */
    border-collapse: collapse; /* 合併邊框，避免雙邊框 */
    margin-top: 5px; /* 與上方元素間距 10px */
    font-size: 14px; /* 預設字體大小 12px */
    min-width: 1200px; /* 設定最小寬度，避免表格太窄 */
    background: #ffffff; /* 背景色為深藍色 */
    border-radius: 5px; /* 讓表格四角略微圓滑 */
}

/* 設定表格標題的樣式 */
caption {
    font-size: 16px; /* 標題字體大小 16px */
    font-weight: bold; /* 加粗字體 */
    margin-bottom: 5px; /* 與表格間距 5px */
}

/* 設定表格內的標題 (th) 和單元格 (td) 樣式 */
th, td, .el-table th, .el-table td {
    border: 2px solid #ddd;
    padding:0px !important; /* 內邊距 8px */
    font-size: clamp(2px, 1vw, 14px); /* 響應式字體大小，最小 2px，最大 14px */
    white-space: nowrap; /* 禁止換行 */
    overflow: hidden; /* 超出部分隱藏 */
    text-overflow: ellipsis !important; /* 超出顯示省略號 */
    text-align: center; /* 內容置中 */

    vertical-align: middle; /* 垂直置中 */
}

/* 設定表格標題 (th) 背景色 */
th, .el-table th {
    background: #6b675d !important; /* 設定橘黃色背景 */
    color: rgb(255, 255, 255); /* 文字顏色為黑色 */
    padding: 0px !important; /* 內邊距 8px */
}

/* 設定表格內容 (td) 背景色 */
td, .el-table td {
    background: #ffffff; /* 深藍灰色背景 */
    color: rgb(0, 0, 0); /* 文字顏色為黑色 */
    padding:0px !important; /* 內邊距 8px */
    text-align: center; /* 內容置中 */
    vertical-align: middle; /* 垂直置中 */

}

/* 設定輸入框 (Element UI 的 .el-input 內部樣式) */
.el-input__inner, .el-select {
    background: transparent !important; /* 透明背景 */
    color: #000000 !important; /* 黑色文字 */
    border: none !important; /* 移除邊框 */
    text-align: center !important; /* 文字置中 */
    vertical-align: middle !important; /* 垂直置中 */
    font-size: 14px;
    padding: 0 !important; /* 移除內邊距 */
    height: auto !important; /* 自適應高度 */
    line-height: 1 !important; /* 調整行高，避免額外空間 */
    

}

/* 設定選擇下拉選單內的選項樣式 */
.el-select-dropdown__item {
    
    color: #333 !important; /* 文字顏色為深灰色 */
    padding: 8px; /* 內邊距 8px，讓選項更好點擊 */
}

/* 編輯模式 (當使用者編輯表格時的邊框效果) */
.edit-mode {
    border: 2px solid #000 !important; /* 黑色邊框 */
    border-radius: 4px; /* 輕微圓角，使邊框不會太生硬 */
    transition: all 0.3s ease-in-out; /* 平滑動畫效果 */
}

/* 滑鼠懸停在編輯模式時的效果 */
.edit-mode:hover {
    border-color: #444; /* 邊框顏色變為深灰色 */
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.2); /* 加點淡淡的陰影，讓它更有立體感 */
}
.el-table tr:hover > td {
    background-color: transparent !important; /* 透明，保持原背景 */
    color: inherit !important; /* 文字顏色不變 */
}

/* 禁止 el-table 在 hover 時改變背景顏色 */
.el-table__body tr:hover > td {
    background-color: #ffffff !important; /* 設定與原本相同的背景色 */
    color: rgb(0, 0, 0) !important; /* 保持文字顏色 */
}

/* 針對 .el-table__row 修正 hover 問題 */
.el-table__row:hover {
    background-color: #34495e !important;
}
/* 修改合計行 (summary row) 的背景顏色及文字顏色 */
.el-table__footer-wrapper td {
    background: #6b675d !important; /* 橘黃色背景 */
    color: rgb(255, 255, 255) !important; /* 文字顏色改為黑色，確保可讀性 */
    font-weight: bold; /* 讓合計行的文字更突出 */
    text-align: center !important; /* 文字置中 */
}

.compact-row .el-table__cell {
  padding: 4px 0 !important; /* 減小上下間距 */
  height: 30px !important; /* 控制高度 */
}

.edit-mode-row .el-table__cell {
  padding: 10px 0 !important; /* 編輯模式時正常間距 */
}
/* 讓 span 內的文字強制置中 */
span {
            display: block;
            text-align: center;
            font-size: 12px;
            padding: 0 !important; /* 移除內邊距 */
    height: auto !important; /* 自適應高度 */
    white-space: nowrap;

        }
/* 設定 el-switch 的間距 */
.el-switch {
    margin-right: 10px; /* 右邊間距 */
}

/* 調整 el-switch 與文字的對齊 */
.el-switch .el-switch__label {
    font-size: 14px; /* 文字大小 */
    color: #333; /* 文字顏色 */
}

/* 設定開關的大小 */
.el-switch .el-switch__core {
    width: 40px !important; /* 調整開關的寬度 */
    height: 20px !important; /* 調整開關的高度 */
}

/* 自定義開關開啟時的顏色 */
.el-switch.is-checked .el-switch__core {
    background-color: #409EFF !important; /* 例如藍色 */
}

/* 自定義開關關閉時的顏色 */
.el-switch .el-switch__core {
    background-color: #ccc !important; /* 灰色 */
}


.eff-label {
  font-weight: bold;
  color: #333;
}
.logo {
      height: 30px;
      margin-right: 10px;
    }
    .short-input {
    width: 8ch;        /* 約可容納 4 個數字 + 一點間距 */
    padding: 2px 4px;  /* 避免過高或太寬 */
    font-size: 14px;
    box-sizing: border-box;
  }
  .header-select-white .el-input__inner {
  color: white !important;
  background-color: transparent;
  border-color: white;
}

.white-input .el-input__inner {
  color: white !important;
  background-color: transparent;
  border-color: white;
  font-size: 14px;
}
.modal {
  display: flex;
  justify-content: center;
  align-items: center;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
}
.modal-content {
  background-color: #fefefe;
  padding: 20px;
  border-radius: 8px;
  width: 300px;
  text-align: center;
}
</style>
<style scoped>
    @keyframes blink {
      0% { background-color: red; }
      50% { background-color: transparent; }
      100% { background-color: red; }
    }
    
    .low-efficiency {
   /*  animation: blink 5s infinite; */
      background-color: red;
      padding: 2px 5px;
      border-radius: 4px;
      color: #ffffff;
    }
    .text-danger {
   /*  animation: blink 5s infinite; */
      background-color: red;
      padding: 2px 5px;
      border-radius: 4px;
      color: #ffffff;
    }
    </style>

<body>  
<div id="app">
    <header>
        <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">

          <div id="dvi" style="flex: 0 1 auto;"> <!-- DVI 靠左 -->
            <img src="logo.png" alt="Logo" class="logo">
            <label>{{ translatedText.area }}:</label>
            <select id="areaSelect" v-model="selectedArea" @change="handleInputChange">
              <option value="ZH">ZH</option>
              <option value="TC">TC</option>
              <option value="VN">VN</option>
              <option value="TW">TW</option>
            </select>
          <label>{{ translatedText.部門 }}:</label>
          <select id="DSelect" v-model="selectedD" @change="handleInputChange">
            <option value="1">1</option>                                                      
            <option value="2">2</option>                                                                                 
            <option value="3">3</option> 
            <option value="4">4</option>
            <option value="6">6</option>
          </select>
          <label>{{ translatedText.D }}</label>
          <select id="SSelect" v-model="selectedS" @change="handleInputChange">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
          </select>
          <label>{{ translatedText.S }}</label>
          <select id="CSelect" v-model="selectedC" @change="handleInputChange">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
            <option value="11">11</option>
            <option value="12">12</option>
            <option value="13">13</option>
            <option value="S1">S1</option>
            <option value="S2">S2</option>
            <option value="S3">S3</option>
            <option value="S4">S4</option>
            <option value="S5">S5</option>
            <option value="S6">S6</option>
          </select>
          <label>{{ translatedText.C }}</label>
          <select id="LSelect" v-model="selectedL" @change="handleInputChange">
            <option value=""></option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
          </select>
          <label>{{ translatedText.L }}</label>
          
        </div>
    
        <div style="flex: 0 1 auto;">
            <label for="language-select">Language:</label>
            <select id="language-select" @change="changeLanguage">
                <option value="zh">中文</option>
                <option value="en">English</option>
                <option value="vi">Tiếng Việt</option>
            </select>
        </div> 
    </div>
    <div id="header" v-if="showCLASS" style="flex: 1; text-align: center;"> <!-- HEADER 置中 -->
        {{ translatedText.在線生產看板 }}
      </div>
      <el-button type="warning" @click="staff_mange" style="float: left;">
        {{ translatedText.人員管理 }}
    </el-button>
    <el-button type="warning" @click="fqc_mange" style="float: left;">
      {{ translatedText.完工數量 }}
    </el-button>
          
      <div v-if="onlineData.length === 0"  >
          <label>{{ translatedText.在線人數 }}: 0</label>
      </div>
        <div v-else v-for="item in onlineData" :key="item.id" class="info-container">          
          <label >{{ translatedText.應出席人數 }}: {{ item.應出席人數 !== undefined ? item.應出席人數 : 0  }}</label>
          <label>{{ translatedText.實際出席人數 }}: {{ item.實際出席 }}</label>
          <label >{{ translatedText.請假人數 }}: {{ item.請假人數 !== undefined ? item.請假人數 : 0 }}</label>
          <label >{{ translatedText.流水線在線人數 }}: {{ item.在線人數 !== undefined ? item.在線人數 : 0 }}</label>
          <label >{{ translatedText.借入人數 }}: {{ item.借入人數 !== undefined ? item.借入人數 : 0 }}</label>
          <label >{{ translatedText.借出人數 }}: {{ item.借出人數 !== undefined ? item.借出人數 : 0 }}</label>
          <button @click="RESET" style="float: right;">RESET</button>
          <div  v-if="EFFOVER">
    
        <div class="eff-item">
              <label class="eff-label" :class="{ 'text-danger': Number(EFFOVER.EFF) < 90 }">
                {{ translatedText.本月效率 }}: 
                {{ isNaN(Number(EFFOVER.EFF)) ? '0.00' : Number(EFFOVER.EFF).toFixed(2) }}%
              </label>
              <label class="eff-label" :class="{ 'text-danger': Number(EFFOVER.OVERQ) > 2 }">
                {{ translatedText.本月溢領 }}: 
                {{ isNaN(Number(EFFOVER.OVERQ)) ? '0.00' : Number(EFFOVER.OVERQ).toFixed(2) }}%
              </label>
              <label class="eff-label">
                {{ translatedText.未結工單 }}: 
                {{ isNaN(Number(EFFOVER.WOCOUNT)) ? '0' : Number(EFFOVER.WOCOUNT) }}
              </label>
              <label
              class="eff-label"
              :class="{ 'text-danger': Number(EFFOVER.WO6COUNT) > 0 }"
            >
              {{ translatedText.逾期工單 }}: 
              {{ isNaN(Number(EFFOVER.WO6COUNT)) ? '0' : Number(EFFOVER.WO6COUNT) }}
            </label>
            </div> 
            
            
          </div>
    
    
        </div>
  
      </header>
<div class="right-content" v-if="showRealTimeContent">



  <hr></hr>

  <template >
    <div style="margin-bottom: 10px;">
      <el-button type="warning" @click="toggleEditMode" style="float: left;">
        {{ editMode ?  translatedText.完成  :   translatedText.調整   }}

  </el-button>
  <!-- 合併欄位開關 -->
  <el-switch
    v-model="isMergeEnabled"
    :active-text="translatedText.欄位合併" /></el-switch> 
  <el-switch v-model="showline" :active-text="translatedText.做線"></el-switch>
  <el-switch v-model="showdefectForming" :active-text="translatedText.成型S"></el-switch>
  <el-switch v-model="showDefectWelding" :active-text="translatedText.焊接"></el-switch>

      <el-switch v-model="table01" :active-text="translate(selectedProcess1)"></el-switch>  
      <el-switch v-model="table02" :active-text="translate(selectedProcess2)"></el-switch>  
      <el-switch v-model="table03" :active-text="translate(selectedProcess3)"></el-switch>  
      <el-switch v-model="table04" :active-text="translate(selectedProcess4)"></el-switch>  
      <el-switch v-model="table05" :active-text="translate(selectedProcess5)"></el-switch>  
      <el-switch v-model="table06" :active-text="translate(selectedProcess6)"></el-switch>  

  </div>

<!--<el-table :data="tableData" border style="width: 100%; margin-top: 10px;" :span-method="mergeTable">-->
  <el-table :data="tableData" border  :span-method="mergeTable" :summary-method="getSummaries" show-summary  :row-class-name="tableRowClassName">



      <el-table-column v-if="editMode" label="操作"    min-width="40px"  >
          <template slot-scope="scope">
              <el-button type="danger" icon="el-icon-delete" size="mini" @click="removeRow2(scope.row,scope.$index)"></el-button>
          </template>
      </el-table-column>
      <el-table-column  prop="time" id="time"  min-width="100px"  >
        <template slot="header"  >
          <span >時段<br> thời gian</span>
      </template>
          <template slot-scope="scope">
              <el-select v-model="scope.row.time" :disabled="!editMode"  @input="resetExpected(scope.row, scope.$index)"style="width: 100%;" :class="{ 'edit-mode': editMode }" >
                  <el-option 
                      v-for="[label, value] in Object.entries(timeOptions)" 
                      :key="label" 
                      :label="label" 
                      :value="label">
                  </el-option>
              </el-select>
          </template>
      </el-table-column>

      <el-table-column   prop="people" id="people"   min-width="60px">
        <template slot="header">
          <span width="10px">人數<br><small>Số người</small></span>
      </template>
          <template slot-scope="scope">
              <el-input  v-model.number="scope.row.people"  @input="resetExpected(scope.row, scope.$index)" :disabled="!editMode || !scope.row.time" type="number" min="1"  :class="{ 'edit-mode': editMode } "   ></el-input>
          </template>
      </el-table-column>
  
  
      <el-table-column  prop="wohourse" id="wohourse"   min-width="60px" align="center">
        <template slot="header">
          <span>總時數<br><small>Tổng số giờ</small></span>
      </template>
          <template slot-scope="scope">
            {{ (calculateHours(scope.row)).toFixed(2) }}
          </template>
      </el-table-column>
  
      <el-table-column prop="product" id="product"  min-width="150px">
        <template slot="header">
          <span>品名<br>Tên sản phẩm</span>
      </template>
        <template slot-scope="scope">
            <el-select v-model="scope.row.product" :disabled="!editMode" style="width: 100%;"  @input="resetExpected(scope.row, scope.$index)":class="{ 'edit-mode': editMode }" style="width: 100%;">
                <el-option 
                    v-for="item in productOptions" 
                    :key="item.value" 
                    :label="item.label" 
                    :value="item.value">
                </el-option>
            </el-select>
        </template>
    </el-table-column>

      <el-table-column  prop="workhorse" id="workhorse" min-width="80px">
        <template slot="header">
          <span>輸入工時<br>Nhập giờ<br>làm việc</span>
      </template>
          <template slot-scope="scope">
              <el-input 
              v-model.number="scope.row.workhorse"  
              @input="resetExpected(scope.row, scope.$index)" 
              @blur="formatDecimal(scope.row, 'workhorse')" 
              :disabled="!editMode" 
              type="number" 
              step="0.1" 
              min="0.0"
              :class="{ 'edit-mode': editMode }">
          </el-input>
          </template>
      </el-table-column>

      <!-- <el-table-column label="預期產量">
          <template slot-scope="scope">
              {{ calculateExpected(scope.row, scope.$index) }}
          </template>
      </el-table-column>-->
  
      <el-table-column   prop="expected" id="expected" min-width="80px">
        <template slot="header">
          <span>標準產能<br>Số lượng <br>tiêu chuẩn</span>
      </template>
          <template slot-scope="scope">
              <!-- 使用 v-model 綁定 scope.row.expected，並觸發 @blur 檢查手動修改 -->
              <el-input 
                  v-model.number="scope.row.expected" 
                  :disabled="true" 
                  type="number" 
                  min="0" 
                  @blur="updateExpected(scope.row,scope.$index)"
                  :class="{ 'edit-mode': editMode }">
              </el-input>
          </template>
      </el-table-column>
      <el-table-column  prop="actual" id="actual" min-width="100px">
        <template slot="header">
          <span>實際產出<br>Số lượng<br>thực tế</span>
      </template>
          <template slot-scope="scope">
              <el-input v-model.number="scope.row.actual" :disabled="!editMode" type="number" min="0" :class="{ 'edit-mode': editMode }"></el-input>
          </template>
      </el-table-column>
      <el-table-column prop="efficiency" id="efficiency" min-width="70px">
        <template slot="header">
          <span class="nowrap-text">效率<br>hiệu quả</span>
        </template>
        <template slot-scope="scope">
          <span :class="{
            'low-efficiency': Number(calculateEfficiency(scope.row)) < 90 
          }">
            {{ calculateEfficiency(scope.row) }}%
          </span>
        </template>
      </el-table-column>  
      <el-table-column  prop="NG" id="NG"  min-width="70px" >
        <template slot="header">
          <span>不良品<br>Hàng NG</span>
      </template>
          <template slot-scope="scope">
              <el-input v-model.number="scope.row.NG" :disabled="!editMode" type="number" min="0" :class="{ 'edit-mode': editMode }"></el-input>
          </template>
      </el-table-column>
      <el-table-column  prop="line" id="line"  min-width="70px" class="no-space"  v-if="showline">
        <template slot="header">
          <span  class="nowrap-text">做線<br>làm dây</span>
      </template>
          <template slot-scope="scope">
              <el-input v-model="scope.row.line" :disabled="!editMode" type="number" min="0" :class="{ 'edit-mode': editMode }"></el-input>
          </template>
      </el-table-column>
         <!-- 根據開關狀態顯示/隱藏 -->
      <el-table-column  prop="defectForming" id="defectForming"  min-width="70px" v-if="showdefectForming">
          <template slot="header">
            <span>成型<br>thành hình</span>
        </template>
          <template slot-scope="scope">
              <el-input v-model.number="scope.row.defectForming" :disabled="!editMode" type="number" min="0" :class="{ 'edit-mode': editMode }"></el-input>
          </template>
      </el-table-column>
      <el-table-column prop="defectWelding" id="defectWelding"  min-width="70px" v-if="showDefectWelding">
        <template slot="header"  >
          <span>焊接<br>Hàn</span>
      </template>
          <template slot-scope="scope">
              <el-input v-model.number="scope.row.defectWelding" :disabled="!editMode" type="number" min="0" :class="{ 'edit-mode': editMode }"></el-input>
          </template>
      </el-table-column>


      <el-table-column
      :render-header="renderHeaderWithSelect1"
      v-if="table01"
      min-width="70px"
      prop="other1"
    >
      <template slot-scope="scope">
        <el-input
          v-model="scope.row.other1"
          :disabled="!editMode"
          type="number"
          min="0"
          :class="{ 'edit-mode': editMode }"
        ></el-input>
      </template>
    </el-table-column>
    
    <el-table-column
      :render-header="renderHeaderWithSelect2"
      v-if="table02"
      min-width="70px"
      prop="other2"
    >
      <template slot-scope="scope">
        <el-input
          v-model.number="scope.row.other2"
          :disabled="!editMode"
          type="number"
          min="0"
          :class="{ 'edit-mode': editMode }"
        ></el-input>
      </template>
    </el-table-column>
    
    <el-table-column
      :render-header="renderHeaderWithSelect3"
      v-if="table03"
      min-width="70px"
      prop="other3"
    >
      <template slot-scope="scope">
        <el-input
          v-model.number="scope.row.other3"
          :disabled="!editMode"
          type="number"
          min="0"
          :class="{ 'edit-mode': editMode }"
        ></el-input>
      </template>
    </el-table-column>
    <el-table-column
    :render-header="renderHeaderWithSelect4"
    v-if="table04"
    min-width="70px"
    prop="other4"
  >
    <template slot-scope="scope">
      <el-input
        v-model.number="scope.row.other4"
        :disabled="!editMode"
        type="number"
        min="0"
        :class="{ 'edit-mode': editMode }"
      ></el-input>
    </template>
  </el-table-column>
  <el-table-column
  :render-header="renderHeaderWithSelect5"
  v-if="table05"
  min-width="70px"
  prop="other5"
>
  <template slot-scope="scope">
    <el-input
      v-model.number="scope.row.other5"
      :disabled="!editMode"
      type="number"
      min="0"
      :class="{ 'edit-mode': editMode }"
    ></el-input>
  </template>
</el-table-column>
<el-table-column
:render-header="renderHeaderWithSelect6"
v-if="table06"
min-width="70px"
prop="other6"
>
<template slot-scope="scope">
  <el-input
    v-model.number="scope.row.other6"
    :disabled="!editMode"
    type="number"
    min="0"
    :class="{ 'edit-mode': editMode }"
  ></el-input>
</template>
</el-table-column>

  
  
  
  
  
  </el-table>
  
  <el-collapse v-model="activeCollapse" class="mt-3" v-if="Object.keys(productSummary).length > 0">
    <el-collapse-item :title="translatedText.依產品分類加總資料" name="1">
      <el-table :data="Object.entries(productSummary)" border size="mini">
        <el-table-column :label="translatedText.品名"  align="center">
          <template slot-scope="scope">
            {{ scope.row[0] }}
          </template>
        </el-table-column>

        <el-table-column :label="translatedText.輸入工時" align="center">
          <template slot-scope="scope">
            {{ scope.row[1].workhorse.toFixed(2) }}
          </template>
        </el-table-column>
        <el-table-column :label="translatedText.標準產能"  align="center">
          <template slot-scope="scope">
            {{ scope.row[1].expected }}
          </template>
        </el-table-column>
        <el-table-column :label="translatedText.實際產出" align="center">
          <template slot-scope="scope">
            {{ scope.row[1].actual }}
          </template>
        </el-table-column>
        <el-table-column :label="translatedText.不良品" align="center">
          <template slot-scope="scope">
            {{ scope.row[1].NG }}
          </template>
        </el-table-column>
        <el-table-column :label="translatedText.不良率" align="center">
          <template slot-scope="scope">
            <span :class="{
              'low-efficiency': Number((scope.row[1].NG / scope.row[1].actual) * 100)  >= 3 
            }">
              {{
                scope.row[1].actual > 0
                  ? ((scope.row[1].NG / scope.row[1].actual) * 100).toFixed(2) + '%'
                  : '0.00%'
              }}
            </span>
          </template>
        </el-table-column>
        
        <el-table-column :label="translatedText.效率" align="center">
          <template slot-scope="scope">
            <span :class="{
              'low-efficiency': Number(scope.row[1].efficiency) < 90 
            }">
              {{ scope.row[1].efficiency }}%
            </span>
            

          </template>
        </el-table-column>
      </el-table>
    </el-collapse-item>
  </el-collapse>
  
  
  <el-button v-if="editMode" type="primary" icon="el-icon-plus" @click="addRow" style="margin-top: 10px;">{{ translatedText.New }}</el-button>
    </template>
    

 
      


  <table>
      <caption >
        <el-button type="warning" @click="wo_mange" style="float: left;">
            {{ translatedText.工單管理 }}
    
        </el-button>{{ translatedText.工單列表 }}</caption>
      <thead>
        <tr>
          <th>{{ translatedText.ID }}</th>
          <th>{{ translatedText.工單 }}</th>
          <th>{{ translatedText.品名 }}</th>
          <th>{{ translatedText.數量 }}</th>
          <th>{{ translatedText.標準工時 }}</th>
          <th>{{ translatedText.執行工時 }}</th>
          <th>{{ translatedText.當前效率 }}</th>
          <th>{{ translatedText.過往效率 }}</th>
          <th>{{ translatedText.做線 }}</th>
          <th>{{ translatedText.焊接 }}</th>
          <th>{{ translatedText.成型 }}</th>
          <th>{{ translatedText.已完成數量 }}</th>
          <th>{{ translatedText.ERP入庫數量 }}</th>


        </tr>
      </thead>
    
      <tbody>
        <template v-for="(item, index) in realTimeData">
         <!--  <template v-if="(index === 0 || item.NFC_CODE !== realTimeData[index - 1].NFC_CODE) "> -->
          <template v-if="(index === 0 || item.NFC_CODE !== realTimeData[index - 1].NFC_CODE) || (item.NFC_CODE == realTimeData[index - 1].NFC_CODE && realTimeData[index - 1].Trans_id == 'LOT_PAUSE')">

            <!-- 只在編號的第一行渲染 -->
            <tr :key="item.WO_ID" v-if="item.Trans_id !== 'LOT_PAUSE'">
              <td :rowspan="getRowSpan(index)" :style="{ backgroundColor: getBackgroundColor(item.NFC_CODE), textAlign: 'center', verticalAlign: 'middle' }">{{ item.NFC_CODE }}</td>
              <td :style="{ backgroundColor: getBackgroundColor(item.NFC_CODE), textAlign: 'center', verticalAlign: 'middle' }">{{ item.WO_ID }}</td>
              <td >{{ item.PART_DESC }}</td>
              <td>{{ item.qty }}</td>
              <td>{{ item.std }}</td>
              <td v-if="item.time > 0">{{ item.time.toFixed(2) }}</td>
              <td v-else>{{ translatedText.未生產 }}</td>
              <!--  <td v-if="item.time > 0">{{ (item.std / item.time * 100).toFixed(2) }}%</td>
              <td v-else></td>-->
              <td v-if="item.FQC > 0">{{ (((item.FQC / item.time )/(item.qty/item.std))*100).toFixed(2) }}%</td>
              <td v-else></td>
              <td v-if="item.PasstEFF > 0 ">{{ (item.PasstEFF * 100).toFixed(2) }}%</td>
              <td v-else>近一年無生產</td>
              <td v-if="index === 0" :rowspan="realTimeData.length">{{ item.LINE }}</td>
              <td v-if="index === 0" :rowspan="realTimeData.length">{{ item.WELD }}</td>
              <td v-if="index === 0" :rowspan="realTimeData.length">{{ item.MD }}</td>
              <td v-if="item.FQC > 0">{{ item.FQC}}</td>
              <td v-else></td>
              <td v-if="item.ship_qty > 0">{{ item. ship_qty }}</td>
              <td v-else></td>

            </tr>
          </template>
          <template v-else>
            <!-- 編號相同的其他行 -->
            <tr :key="item.WO_ID"  v-if="item.Trans_id !== 'LOT_PAUSE'">
              <td :style="{ backgroundColor: getBackgroundColor(item.NFC_CODE), textAlign: 'center', verticalAlign: 'middle' }">{{ item.WO_ID }}</td>
              <td >{{ item.PART_DESC }}</td>
              <td>{{ item.qty }}</td>
              <td>{{ item.std }}</td>
              <td v-if="item.time > 0">{{ item.time.toFixed(2) }}</td>
              <td v-else>未生產</td>
              <td v-if="item.FQC > 0">{{ (((item.FQC / item.time )/(item.qty/item.std))*100).toFixed(2) }}%</td>
              <td v-else></td>
              <td v-if="item.PasstEFF > 0 ">{{ (item.PasstEFF * 100).toFixed(2) }}%</td>
              <td v-else>近一年無生產</td>
              <td v-if="item.FQC > 0">{{ item.FQC}}</td>
              <td v-else></td>
              <td v-if="item.ship_qty > 0">{{ item. ship_qty }}</td>
              <td v-else></td>
            </tr>
          </template>
        </template>
      </tbody>
  </table>
    


        <table>
          <caption>{{ translatedText.工站列表 }}</caption>
          <thead>
            <tr>
              <th>{{ translatedText.設備 }}</th>
              <th>{{ translatedText.姓名 }}</th>
              <th>{{ translatedText.工時 }}</th>
              <th>{{ translatedText.工站 }}</th>
              <th>{{ translatedText.座位 }}</th>
              <th>{{ translatedText.工站 }}</th>
              <th>{{ translatedText.工時 }}</th>
              <th>{{ translatedText.姓名 }}</th>
              <th>{{ translatedText.設備 }}</th>


            </tr>
          </thead>
          <tbody>
              <tr v-for="item in QUERRYTIME" :key="item.seatID" v-show="item.l_NameID !== '' || item.r_NameID !== ''">
                <td   >{{ item.l_Machine }}</td>
                <td :title="'工時:'+ ''+  item.l_PT" :style="{ backgroundColor: (item.l_WoID === '' && item.l_NameID !== '') ? 'red' : getBackgroundColor(item.l_NfcCode), textAlign: 'center', verticalAlign: 'middle' }">{{ item.l_NameID }}</td>
                <td>{{ (item.l_PT * 1).toFixed(2) }}/hr</td>
                <td
                :style="
                  item.l_WorkContent === '做線'
                    ? 'color: rgb(255, 211, 6); font-weight: bold;'
                    : item.l_WorkContent === '焊接'
                    ? 'color: blue; font-weight: bold;'
                    : item.l_WorkContent === '成型'
                    ? 'color: purple; font-weight: bold;'
                    : item.l_WorkContent === '成型S'
                    ? 'color: purple; font-weight: bold;background-color: rgb(187, 255, 187);'
                     : item.l_WorkContent === '做線S'
                    ? 'color: rgb(255, 211, 6); font-weight: bold; bold;background-color: rgb(187, 255, 187);'
                    : item.l_WorkContent === '焊接S'
                    ? 'color: blue; font-weight: bold; bold;background-color: rgb(187, 255, 187);'
                    : 'color: black;'
                "
              >
                {{ translatedText[item.l_WorkContent] }}
              </td>
              
                <td>{{ item.seatID }}</td>
                <td
                :style="
                      item.r_WorkContent === '做線'
                    ? 'color: rgb(255, 211, 6); font-weight: bold;'
                    : item.r_WorkContent === '焊接'
                    ? 'color: blue; font-weight: bold;'
                    : item.r_WorkContent === '成型'
                    ? 'color: purple; font-weight: bold;'
                    : item.r_WorkContent === '成型S'
                    ? 'color: purple; font-weight: bold;background-color: rgb(187, 255, 187);'
                     : item.r_WorkContent === '做線S'
                    ? 'color: rgb(255, 211, 6); font-weight: bold; bold;background-color: rgb(187, 255, 187);'
                    : item.r_WorkContent === '焊接S'
                    ? 'color: blue; font-weight: bold; bold;background-color: rgb(187, 255, 187);'
                    : 'color: black;'
                "
              >
                {{ translatedText[item.r_WorkContent] }}
              </td>
                <td>{{ (item.r_PT * 1).toFixed(2) }}/hr</td>
                <td :title="'工時:'+ ''+  item.R_PT"  :style="{ backgroundColor: (item.r_WoID === '' && item.r_NameID !== '') ? 'red' : getBackgroundColor(item.r_NfcCode), textAlign: 'center', verticalAlign: 'middle' }">{{ item.r_NameID }}</td>
                <td >{{ item.r_Machine }}</td>
           
              </tr>
            </tbody>
        </table>


</div>
<div class="right-content" v-if="wo_mangeContent">
{{ translatedText.工單管理 }}
<br></br>
    <table>
        <caption >
        <el-button type="warning" @click="showRealTime" style="float: left;">
            {{ translatedText.在線生產看板 }}
    
        </el-button>{{ translatedText.工單列表 }}
    </caption>

      <thead>
        <tr>
          <th>{{ translatedText.ID }} </th>
          <th>{{ translatedText.工單 }} </th>
          <th>{{ translatedText.品名 }}</th>
          <th>{{ translatedText.數量 }} </th>
          <th>{{ translatedText.標準工時 }} </th>
          <th>{{ translatedText.過往效率 }} </th>
          <th>{{ translatedText.功能 }}</th>
          <th>{{ translatedText.日期 }}</th>

        </tr>
      </thead>
      <tbody>
<template v-for="(item, index) in realTimeData">
    <template v-if="index === 0 || item.NFC_CODE !== realTimeData[index - 1].NFC_CODE || (item.NFC_CODE == realTimeData[index - 1].NFC_CODE && realTimeData[index - 1].Trans_id == 'LOT_PAUSE') ">
        <tr  :key="item.WO_ID"  v-if="item.Trans_id !== 'LOT_PAUSE'"  >
            <td  :rowspan="getRowSpan(index)" :style="{ backgroundColor: getBackgroundColor(item.NFC_CODE)}">{{ item.NFC_CODE }}</td>
          <td>{{ item.WO_ID }}</td>
          <td>{{ item.PART_DESC }}</td>
          <td>{{ item.qty }}</td>
          <td>{{ item.std }}</td>
          <td v-if="item.PasstEFF > 0 ">{{ (item.PasstEFF * 100).toFixed(2) }}%</td>
          <td v-else>近一年無生產</td>
          <td  :rowspan="getRowSpan(index)" >
            <button @click="completeTask(item.WO_ID, item.NFC_CODE)">{{ translatedText.完成 }}</button>
            <button @click="showRemarkSelect(item.WO_ID, item.NFC_CODE)"> {{ translatedText.暫停 }}</button>
          </td>
        </tr>
        <tr v-else>            
          <td>{{ item.NFC_CODE }}</td>
          <td >{{ item.WO_ID }}</td>
          <td>{{ item.PART_DESC }}</td>
          <td>{{ item.qty }}</td>
          <td>{{ item.std }}</td>
          <td v-if="item.PasstEFF > 0 ">{{ (item.PasstEFF * 100).toFixed(2) }}%</td>
          <td v-else>近一年無生產</td>
          <td >
            <button :disabled="isButtonDisabled" @click="REWORK(item)">{{ translatedText.復工 }}</button>
          </td>
          <td>{{ item.rework_date }}
            <button
              :disabled="isButtonDisabled"
              @click="openDateDialog(item.ID)"
            >
              {{ translatedText.調整 }}
            </button>
          </td>
        </tr>
    </template>
 <template v-else>
    <tr  :key="item.WO_ID"  v-if="item.Trans_id !== 'LOT_PAUSE'  "  >
      <td >{{ item.WO_ID }}</td>
      <td>{{ item.PART_DESC }}</td>
      <td>{{ item.qty }}</td>
      <td>{{ item.std }}</td>
      <td v-if="item.PasstEFF > 0 ">{{ (item.PasstEFF * 100).toFixed(2) }}%</td>
      <td v-else>N/A</td>
    </tr>
    <tr v-else>            
      <td >{{ item.WO_ID }}</td>
      <td>{{ item.PART_DESC }}</td>
      <td>{{ item.qty }}</td>
      <td>{{ item.std }}</td>
      <td v-if="item.PasstEFF > 0 ">{{ (item.PasstEFF * 100).toFixed(2) }}%</td>
      <td v-else>近一年無生產</td>
      <td >
        <button :disabled="isButtonDisabled" @click="REWORK(item)">{{ translatedText.復工 }}</button>
      </td>
    </tr>

</template>
</template>
      </tbody>
    </table>
    <hr></hr>
    <hr></hr>
    <label for="ERP">{{ translatedText.輸入工單 }}</label>
    <input id="ERP" type="text" v-model="selectedERP"  @keydown.enter="checkAndSelectERP" >

    <button type="button" @click="checkAndSelectERP" :disabled="isButtonDisabled" @keydown.enter="checkAndSelectERP">
      {{ translatedText.查詢 }}
    </button>
    <label>
      <input type="radio" v-model="Stickers" value="GEN">
      N/A
    </label>
    <label>
      <input type="radio" v-model="Stickers" value="TZ">
      {{ translatedText.貼紙班 }} 
    </label>
    <label>
      <input type="radio" v-model="Stickers" value="CD">
      {{ translatedText.裁剝班 }} 
    </label>
    


    <label >  {{ translatedText.workOrder1 }}</label>


    <hr></hr>
    <table>
        <caption style="font-size: 18px;">{{ translatedText.設定工單列表 }}</caption>
      <thead>
        <tr>

          <th>{{ translatedText.工單 }}</th>
          <th>{{ translatedText.料號 }}</th>
          <th>{{ translatedText.品名 }}</th>
          <th>{{ translatedText.數量 }}</th>
          <th>{{ translatedText.標準工時 }}</th>
          <th>{{ translatedText.過往效率 }}</th>
          <th>{{ translatedText.功能 }}</th> <!-- 新添加的列标题 -->
       
        </tr>
      </thead>
      <tbody>
        <tr v-for="item in ERPDATA" :key="item.wadoco" >
          <td >{{ item.wadoco }}</td>
          <td>{{ item.walitm }}</td>
          <td>{{ item.wadl01 }}</td>
          <td>{{ item.wauorg }}</td>
          <td>{{ item.wlrunl_sum }}</td>
          <td>{{ (item.avgStdEff * 100).toFixed(2)}}%</td>
          <td><button @click="removeRow(item)">{{ translatedText.移除 }}</button></td> <!-- 新添加的移除按钮 -->
        </tr>
        <tr>
            <td colspan="3">{{ translatedText.總和 }}</td>
            <td>{{ calculateTotal('wauorg') }}</td>
            <td>{{ calculateTotal('wlrunl_sum').toFixed(2) }}</td>
          </tr>
      </tbody>
    </table>

    <template>
      <div>
        <!-- 彈出視窗 -->
        <div v-if="showSelect" class="modal">
          <div class="modal-content">
            <span class="close" @click="closeModal">&times;</span>
            <h3>請選擇暫停原因</h3>
            <select v-model="selectedRemark" style="margin-top: 10px; width: 100%;">
              <option disabled value=""></option>
              <option value="生管通知暂停">生管通知暂停</option>
              <option value="物料欠料(工單欠料)">物料欠料(工單欠料)</option>
              <option value="物料欠料(益領欠料)">物料欠料(益領欠料)</option>
              <option value="物料異常">物料異常</option>
              <option value="不良品無法出理">不良品無法出理</option>
              <option value="模製具異常">模製具異常</option>
              <option value="設備異常">設備異常</option>
            </select>
          <!--   <h3>預計復工日期</h3>
            <input
              type="date"
              v-model="selectedpauseDate"
              style="margin-top: 10px; width: 100%;"
            />-->
            <div style="margin-top: 15px;">
              <button @click="closeModal" style="margin-right: 10px;">取消</button>
              <button @click="pauseTask">確認</button>
            </div>
          </div>
        </div>
      </div>
    </template>

  <!-- 日期選擇對話框 -->
  <div v-if="showDialog" class="modal">
    <div class="modal-content">
      <h3>選擇日期</h3>
      <input
        type="date"
        v-model="selectedDate"
      />
      <div style="margin-top: 15px;">
        <button @click="updateReworkDate">確定</button>
        <button @click="closeDialog">取消</button>
      </div>
    </div>
  </div>

    <hr></hr>
    <label for="dpSelect">{{ translatedText.choose }}:</label>
    <select id="dpSelect" v-model="selectednfccode" >
      <option v-for="dpOption in dpOptions" :key="dpOption" :value="dpOption">{{ dpOption }}</option>
    </select>
    <button  @click="uploadData">{{ translatedText.提交 }}</button>
    <br>

    <div v-if="showShopFloor">
      <label for="ERP">{{ translatedText.輸入開始序號 }}</label>
      <input id="ERP" type="text" />
      <hr></hr>
      <table>
          <caption style="font-size: 18px;">{{ translatedText.工站管理 }}</caption>
          <thead>
              <tr>
                  <th>{{ translatedText.工站編號 }}</th>
                  <th>{{ translatedText.工站名稱 }}</th>
                  <th>{{ translatedText.綁定工站 }}</th>
                  <th>{{ translatedText.測試工站 }}</th>
              </tr>
          </thead>
          <tbody>
              <tr v-for="item in sfoperator" :key="item.OPERATION_NO">
                  <td>{{ item.OPERATION_NO }}</td>
                  <td>{{ item.OPERATION_DESC }}</td>
                  <td>{{ item.LINK }}</td>
                  <td>{{ item.TEST }}</td>
              </tr>
          </tbody>
      </table>
  </div>
</div>
<div class="right-content" v-if="staff_mangeContent">

    <el-button type="warning" @click="showRealTime" style="float: left;">
        {{ translatedText.在線生產看板 }}

    </el-button>

  <header >{{ translatedText.人員管理 }}</header>
  <br></br>
   <button @click="new_staff" >{{ translatedText.New }}</button>
   <button @click="show_delete" >{{ translatedText.delete }}</button>
   <button @click="show_UPDATE" >{{ translatedText.修改 }}</button>
   <button @click="show_CANCLE" >{{ translatedText.取消 }}</button>
   <div v-if="showForm">
    <form @submit.prevent="addNewStaff">
      <label>{{ translatedText.部門 }}</label>
      <input v-model="newStaff.department"  required />

      <label>{{ translatedText.工號 }}</label>
      <input v-model="newStaff.jobnumber" required />

      <label>{{ translatedText.姓名 }}</label>
      <input v-model="newStaff.username" required />

      <label>{{ translatedText.工作拉 }}</label>
      <input v-model="newStaff.work_department"  />


      <button type="submit">{{ translatedText.完成 }}</button>
    </form>
  </div>
    <table>
        <thead>
          <tr>
            <th  class="number-column"> {{ translatedText.ID }}  </th>
            <th  class="number-column">{{ translatedText.出勤 }}</th>
            <th class="number-column">{{ translatedText.部門 }}</th>
            <th class="number-column">{{ translatedText.工作拉 }}</th>
            <th class="number-column">{{ translatedText.工號 }}</th>
            <th class="number-column">{{ translatedText.姓名 }}</th>
            <th class="number-column">{{ translatedText.備註 }}</th>
            <th v-if="!showActions">{{ translatedText.Status }}</th>
            <th class="number-column" v-if="!showActions">{{ translatedText.工作部門 }}</th>
            <th v-if="!showActions">{{ translatedText.事由 }}</th>
            <th v-if="showActions">{{ translatedText.功能 }}</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="(item, index) in staffData" :key="item.id">
            <td :style="item.online === '01' ? (item.out_department.length > 9 ? { backgroundColor: 'red' } : { backgroundColor: '#19f032' }) : {}">
              {{ index + 1 }}
            </td> 
            <td> <input type="checkbox" :checked="item.show === 'T'" @change="toggleStatus(item.id,item.show)"></td> 
            <td>
              <template v-if="item.editable">
                <input v-model="item.department" required>
              </template>
              <template v-else>
                {{ item.department }}
              </template>
            </td>
            <td>
              <template v-if="item.editable">
                <input v-model="item.work_department" required>
              </template>
              <template v-else>
                {{ item.work_department }}
              </template>
            </td>
            <td>
              <template v-if="item.editable">
                <input v-model="item.jobnumber" required>
              </template>
              <template v-else>
                {{ item.jobnumber }}
              </template>
            </td>
            <td class="number-column">
              <template v-if="item.editable">
                <input v-model="item.username" required>
              </template>
              <template v-else>
                {{ item.username }}
              </template>
            </td>
            <td class="number-column">
              <template v-if="item.editable">
                <input v-model="item.remark" required>
              </template>
              <template v-else>
                {{ item.remark }}
              </template>
            </td>
            <td class="number-column" v-if="!showActions">
              <span v-if="item.status === '年休' || item.status === '請假' || item.status === '哺乳假' || item.status === '工傷' || item.status === '工傷陪護' || item.status === '借出' || item.status === '新進員工' || item.status === '夜班'|| item.status === '備註'">       
                {{ translatedText[item.status] }}，({{ translatedText.應報考勤 }}:{{ item.hr_time }}/hr) <button @click="delete_hr(item.id)" >{{ translatedText.取消 }}</button>
            </span>
            <span v-else>
                <button @click="updateStatus(item.jobnumber, '年休')">{{ translatedText.年休 }}</button>
                <button @click="updateStatus(item.jobnumber, '請假')">{{ translatedText.請假 }}</button>
                <button @click="updateStatus(item.jobnumber, '哺乳假')">{{ translatedText.哺乳假 }}</button>
                <button @click="updateStatus(item.jobnumber, '工傷')">{{ translatedText.工傷 }}</button>
                <button @click="updateStatus(item.jobnumber, '工傷陪護')">{{ translatedText.工傷陪護 }}</button>
                <button @click="updateStatus(item.jobnumber, '借出')">{{ translatedText.借出 }}</button>
                <button @click="updateStatus(item.jobnumber, '夜班')">{{ translatedText.夜班 }}</button>
                <button @click="updateStatus(item.jobnumber, '備註')">{{ translatedText.備註 }}</button>
            </span>
            </td>
            <td v-if="!showActions && item.department.substring(0, 6) !== item.out_department">
              {{ item.out_department }}
            </td>
            <td v-else="!showActions">
            
            </td>
            <td v-if="!showActions">{{ item.note }}</td>
            <td  v-if="showActions" > 
              <template v-if="item.editable">
                <button @click="UPDATE_staffData(item)">{{ translatedText.完成 }}</button>
              </template>
              <template v-else>
                <button @click="delete_staffData(item.id)">{{ translatedText.delete }}</button>
              </template>
     
            </td>
          </tr>
        </tbody>
      </table>
      

</div>
<div class="right-content" v-if="fqc_mangeContent">
  <header >  <el-button type="warning" @click="showRealTime" style="float: left;">
    {{ translatedText.在線生產看板 }}
</el-button>{{translatedText.完工數量}}</header>

  <br></br>
  <table>

    <thead>
      <tr>
        <th>{{translatedText.工單}}</th>
        <th>{{translatedText.品名}}</th>
        <th>{{translatedText.數量}}</th>
        <th>{{translatedText.標準工時}}</th>
        <th>{{translatedText.執行工時}}</th>
        <th>{{translatedText.已完成數量}}</th>
        <th>{{translatedText.功能}}</th> <!-- 新增的列 -->

      </tr>
    </thead>
    <tbody>
      <template v-for="(item, index) in realTimeData">

        <!-- 只在編號的第一行渲染 -->
        <tr :key="item.WO_ID" v-if="item.Trans_id !== 'LOT_PAUSE'">
          <td :style="{ backgroundColor: getBackgroundColor(item.NFC_CODE), textAlign: 'center', verticalAlign: 'middle' }">{{ item.WO_ID }}</td>
          <td>{{ item.PART_DESC }}</td>
          <td>{{ item.qty }}</td>
          <td>{{ item.std }}</td>
          <td v-if="item.time > 0">{{ item.time.toFixed(2) }}</td>
          <td v-else>未生產</td>
          <td>
      
            <input type="number" v-model="item.FQC" @change="validateInput(item)">
      
            <br>
             <span v-if="item.inputError" style="color: red;">{{translatedText.fqcer1}}</span>
             <span v-if="item.inputError2" style="color: red;">{{translatedText.fqcer2}}</span>
          </br>
          </td>
          <td>
            <button @click="completeWorkOrder(item.WO_ID, item.FQC)">{{translatedText.提交}}</button>
          </td>
        </tr>
      </template>
    </tbody>


  </table>
  <br></br>
  <button style="float: right;" @click="updateAllRatings">{{ translatedText.提交 }}</button>  
  <table>
    <thead>
      <tr>
        <th>{{translatedText.日期}}</th>
        <th>{{translatedText.工號}}</th>
        <th>{{translatedText.姓名}}</th>
        <th>{{translatedText.工站}}</th>
        <th>{{translatedText.執行工時}}/H</th>
        <th>08-10</th>
        <th>10-12</th>
        <th>13-15</th>
        <th>15-17</th>
        <th>17-20</th>
        <th>{{translatedText.已完成數量}}</th>
    <!--    <th>{{translatedText.功能}}</th>  新增的列 -->

      </tr>
    </thead>
    <tbody>
      <template v-for="(item, index) in RATING_data">

        <!-- 只在編號的第一行渲染 -->
        <tr >
          <td>{{ item.MFG_DAY }}</td>
          <td>{{ item.JOB_NUMBER }}</td>
          <td>{{ item.USER_NAME }}</td>
          <td>{{ item.WORK_CONTENT }}</td>
          <td>{{ item.DATE_MINUTE }}</td>
    <!-- 各时间段的输入框 -->
    <td > <input type="number"  v-model="item.COMPLETED_QTY_1"  class="short-input"> </td>
    <td> <input type="number"  v-model="item.COMPLETED_QTY_2"  class="short-input"> </td>
    <td> <input type="number"  v-model="item.COMPLETED_QTY_3"  class="short-input"> </td>
    <td> <input type="number"  v-model="item.COMPLETED_QTY_4"  class="short-input"> </td>
    <td> <input type="number"  v-model="item.COMPLETED_QTY_5"  class="short-input"> </td>

    <!-- 已完成数量为五个时间段的总和 -->
    <td>{{ calculateTotalCompletedQty(item) }}

      <br>
      <span v-if="item.inputError" style="color: red;">{{translatedText.fqcer1}}</span>
      <span v-if="item.inputError2" style="color: red;">{{translatedText.fqcer2}}</span>
      </br>
    </td>

        <!--      <td>
            <button @click="updateRATINGDate(item.id, item.COMPLETED_QTY_1,item.COMPLETED_QTY_2,item.COMPLETED_QTY_3,item.COMPLETED_QTY_4,item.COMPLETED_QTY_5,   calculateTotalCompletedQty(item))">{{translatedText.提交}}</button>
          </td>-->
        </tr>
      </template>
    </tbody>
  </table>
</div>


<script>

  new Vue({
  
  el: '#app',
  data: {
    isMergeEnabled: true, // ✅ 這是開關，true=合併、false=不合併
    selectedProcess1: '欄位1',
    selectedProcess2: '欄位2',
    selectedProcess3: '欄位3',
    selectedProcess4: '欄位4',
    selectedProcess5: '欄位5',
    selectedProcess6: '欄位6',
      processSwitch: {

        前處理:false,
        插件:false,
        组装:false,
        ATE:false,
        打扭:false,
        套套管:false,
        內模:false,
        外模: false,
        CRY1:false,
        CRY2:false,
        外觀: false,
        待包裝:false,
        打端子:false,


      },
    activeCollapse: ['1'],  // 折疊開關（預設展開）
    showSummaryTable: false, // 開關控制加總表格
    summaryData: [],
    tableDataRaw: [],  
    EFFOVER:[],
    summaryByProductRows:[],
     isOpen: true,
    editMode: false,
    currentSheet: 0, // 預設顯示第1個工作表
      sheets: [
        { name: '二部績效' },
        { name: '三部績效' },
        { name: 'PP工單' },
        { name: '主管績效' },
        { name: '員工績效獎' },
        { name: '產線外人員績效' },
        { name: '效率大於120' },
             ],
    currentLanguage: 'zh',
    translatedText: {
      依產品分類加總資料:'依產品分類加總資料',
      欄位合併:'欄位合併',
      輸入工時:'輸入工時',
      標準產能:'標準產能',
      實際產出:'實際產出',
      不良品:'不良品',
      不良率:'不良率',
      打端子:'打端子',
      效率:'效率',
      前處理:'前處理',
        插件:'插件',
        组装:'组装',
                   打扭:'打扭',
                  套套管:'套套管',
                  內模:'內模',
                  外模:'外模',
                  外觀:'外觀',
                  待包裝:'待包裝',
                  總數量:'總數量',
                本月效率:'本月效率',
                本月溢領:'本月溢領',
                未結工單:'未結工單',
                逾期工單:'逾期工單',
                總數量:'總數量',
                一般:'一般',
                焊接:'焊接',
                成型:'成型',
                做線:'做線',
                焊接S:'焊接',
                成型S:'成型',
                做線S:'做線',
                在線生產看板: '在線生產看板',
                每日生產看版:'每日生產看版',
                星級完成數量:'重點工站完成數量',
                工單管理: '工單管理',
                工單查詢: '工單查詢',
                工站管理: '工站管理',
                工站設定:'工站設定',
                人員管理: '人員管理',
                考勤異常: '考勤異常',
                生產看版: '生產看版',
                工單分析圖表: '工單分析圖表',
                未結工單: '未結工單',
               完工數量:'完工數量',
                生產日報:'生產日報',
                產能日報:'產能日報',
                卡片設定:'卡片設定',
                考勤日報:'考勤日報',
                登入:'登入',
                NFC_SYSTEAM:'NFC 系統',
                考勤系統:'考勤系統',
                生產數據:'生產數據',
                area:'廠區',
                部門:'部門',
                D:'部',
                S:'課',
                C:'班',
                L:'拉',
                在線人數:'在線人數',
                應出席人數:'應出席人數',
                實際出席人數:'實際出席人數',
                請假人數:'請假人數',
               流水線在線人數:'流水線在線人數',
                借入人數:'借入人數',
                借出人數:'借出人數',
                工單列表:'工單列表',
                ID:'編號',
                工單:'工單',
                品名:'品名',
                數量:'數量',
                標準工時:'標準工時',
                執行工時:'執行工時',
                當前效率:'當前效率',
                過往效率:'過往效率',
                已完成數量:'已完成數量',
                設備:'設備',
                姓名:'姓名',
                工時:'工時',
                工站:'工站',
                座位:'座位',
                工站列表:'工站列表',
                功能:'功能',
                fqcer1:'輸入值不能小於原值',
                fqcer2:'輸入值不能大於工單數量',
                完成:'完成',
                暫停:'暫停',
                復工:'復工',
                輸入工單:'輸入工單',
                查詢:'查詢',
                提交:'提交',
                workOrder1:'100:試產工單, 200:來料全檢, 400:重工,700 物料員工時',
                貼紙班:'貼紙班',
                裁剝班:'裁線班',
                料號:'料號',
                設定工單列表:'設定工單列表',
                移除:'移除',
                總和:'總和',
                choose:'選擇NFC_CODE',
                修改:'修改',
                取消:'取消',
                增加座位:'增加座位',
                刪除座位:'刪除座位',
                卡機號:'卡機號',
                工站名稱:'工站名稱',
                insert:'插入',
                delete:'刪除',
                New:'新增',
                出勤:'出勤',
                工作拉:'工作拉',
                工號:'工號',
                Status:'狀態',
                事由:'事由',
                年休:'年休',
                請假:'請假',
                哺乳假:'哺乳假',
                工傷:'工傷',
                工傷陪護:'工傷陪護',
                借出:'借出',
                新進員工:'新進員工',
                夜班:'夜班',
                考勤日報:'考勤日報',
                show:'顯示',
                出勤人數:'出勤人數',
                實際掛卡工時:'實際掛卡工時',
                總共考勤工時:'總共考勤工時',
                回報管理部考勤工時:'回報管理部考勤工時', 
                差異:'差異', 
                原因:'原因',
                輸入卡機:'輸入卡機',
                NFC卡號:'NFC卡號',
                NFC_CODE:'NFC_CODE',
                刷新:'刷新',
                在線工單:'在線工單',
                平均效率:'平均效率',
                低於90工單數:'低於90%工單數',
                已完成工單:'已完成工單',
                未結案工單:'未結案工單',
                無效工時:'無效工時(hrs)',
                本日:'本日',
                本月:'本月',
                上月:'上月',
                pd1:'備註：(本月、上月)資料來源ERP',
                應報考勤:'應報考勤',
                加總:'加總',
                導出:'導出',
                系統計算考勤工時:'系統計算考勤工時',
                增加有效考勤工時:'增加有效考勤工時',
                正班工時:'正班工時',
                加班工時:'加班工時',
                假別:'假別',
                更新完成:'更新完成',
                更新失敗:'更新失敗',
                重複輸入:'输入值重复，请重新输入！',
                查無卡號:'查無卡號',
                工單已存在:'该工單號已存在于表格中。',
                未添加工單:'未添加工單',
                查無工單:'查無工單，是否手動增加？',
                請輸暫停理由:'請輸暫停理由：',
                未生產:'未生產',
                調整:'調整',
                忘記設定:'忘記設定',
                忘記設定狀態:'忘記設定狀態',
                工作部門:'工作部門',
                備註:'備註',
                考勤調整確認:'考勤調整確認',
                日期:'日期',
                班別管理:'班別管理',
                工單狀態與ERP對比報表:'工單狀態與ERP對比報表',
                ERP入庫數量:'ERP入庫數量',
                過站管理:'過站管理',
                序號管理:'序號管理',
                序號查詢:'序號查詢',
                出貨序號表:'出貨序號表',
                不良品紀錄查詢:'不良品紀錄查詢',
                工站編號:'工站編號',
                綁定工站:'綁定工站',
                測試工站:'測試工站',
                輸入開始序號:'輸入開始序號',
  
  
            },
            showShopFloor: false,  // 控制是否显示 label, input 和 table
            Stickers:false,
            eff_performance_ppwodata: [],
            eff_performance_eff120data: [],
            eff_stff_bonus:[],
            eff_performance_data: [],
            RATING_data:[],
           eff_performance_dates: [],
           eff_performance_groupedData: {},
           DEP_eff_performance_data: [],
           DEP_eff_performance_dates: [],
           DEP_eff_performance_groupedData: {},
           QCDEP_eff_performance_data: [],
           QCDEP_eff_performance_dates: [],
           QCDEP_eff_performance_groupedData: {},
           ZHDEP_eff_performance_data: [],
           ZHDEP_eff_performance_dates: [],
           ZHDEP_eff_performance_groupedData: {},
           sfoperator: [
            // 示例数据
            { OPERATION_NO: '0', OPERATION_DESC: '重工', LINK: 'N', TEST: 'N' },
            { OPERATION_NO: '10', OPERATION_DESC: '萬用表測試', LINK: 'N', TEST: 'T' },
            { OPERATION_NO: '20', OPERATION_DESC: '標籤綁定', LINK: 'T', TEST: 'N' },
            { OPERATION_NO: '30', OPERATION_DESC: '外觀檢查', LINK: 'N', TEST: 'T' },
            { OPERATION_NO: '40', OPERATION_DESC: '最終測試', LINK: 'N', TEST: 'T' },
        ],
        isAuthenticated: false,
        user: {permissions: []},
        credentials: {
          username: '',
          password: '',
        },
        showline:true,
        showdefectForming: true,   // 控制「成形」顯示/隱藏
        showDefectWelding: true,   // 控制「焊接」顯示/隱藏
        table01: false,   // 控制「焊接」顯示/隱藏
        table02: false,   // 控制「焊接」顯示/隱藏
        table03: false,   // 控制「焊接」顯示/隱藏
        table04: false,   // 控制「焊接」顯示/隱藏
        table05: false,   // 控制「焊接」顯示/隱藏
        table06: false,   // 控制「焊接」顯示/隱藏
                productOptions: [], // **存放品名列表**
        tableData: [  {            
          ID: "",
          AREA: "",
          MFG_DAY: "",
          DEPARTMENT: "",
          people: "",
          time: "",
          product: "",
          expected: "",
          actual: "",
          line: "",
          defectForming: "",
          defectWelding: "",
          NG: "",
          other1: "",
          other2: "",
          other3: "",
          other4: "",
          other5: "",
          other6: ""
        }
                ],
                timeOptions: {
        },
        showSelect: false,        // 控制下拉選單的顯示
      selectedRemark: "",       // 暫停原因
      selectedpauseDate: "",
      currentWoId: null,        // 存儲當前的工單ID
      currentNfcCode: null,     // 存儲當前的NFC代碼
     sfsnData: null , // 存储 API 响应的所有数据
    scanContent: '',
    deviceSerial:'',
    displayContent: '',
     settingsOpen: false, // 新增状态用来控制是否展开设置
     performance: false,
     CHECHED: true,
     selectAll: false,
     WOselectAll: false,
     ighlight: false,
    showActions: false, // 控制功能列的显示与隐藏        
    loading: false,
     initialSerialNumber: "",
      count: 0,
      woId: "",
      responseMessage: null,
    showyear : false,
    showCLASS: true,
    showDemoContent: false,
    REWOID:false,
    woderpreport:false,
    iframeHeight:500,
    isButtonDisabled: false,
    selectednfccode:'',
    currentTime: '',
    SHOW_PD_VERSON: false,
    SHOW_WO_VERSON: false,
    SHOW_eff_performance: false,
    SHOW_overflow_performance:false,
    showRealTimeContent: true,
    showPDRealTimeContent: false,
    SHOPSTcontent:false,
   SHOW_RATING_VERSON: false,
   SF_SN_MG:false,
    SNLISTcontent:false,
    PDSNLISTcontent: false,
    FAILSNLISTcontent:false,
    wo_mangeContent:false,
    wo_selectment:false,
    fqc_mangeContent :false,
    seat_mangeContent:false,
    staff_mangeContent:false,
    ATT_timeContent:false,
    ATT_AbnormalContent:false,
    CARD_mangeContent:false,
    shift_mangeContent:false,
    oldPassword: "", // 舊密碼綁定
    newPassword: "", // 新密碼綁定
    showForm: false,
    stff_show2: false,
    ATT_ADJ_confirm:false,
    selectedmachine:'',
    selectedyear:'',
    selectedmonth:'',
    selectedYear:'',
    selectedMonth:'',
    selectedArea: '',
    SFselectedWO: '',
    selectedText:'',
    selectedLINK:'',
    selectedDESC1:'',
    selectedDESC2:'',
    TRANS1_LIMIT:0,
    TRANS2_LIMIT:0,
    SFselectedOPERATOR:'',
    selectedD:'',
    selectedS:'',
    selectedC:'',
    selectedL:'',
    userIp: '',
    inputValue: 0 ,
    snInput: '',  // 用戶輸入的 SN
      snList: [],   // API 返回的數據列表
      SFoperations:[],
    selectedDepartment: 'DSC',
    productionData: [], // 用于存储从 API 获取的数据
    dpOptions: [],
    CAEDoptions: [],
      selectedUsername: '',
      machine_card: null,
    realTimeData: [],
    shiftdata:[],
    QUERRYTIME: [],
    ERPDATA:[],
    ATT_time_ADJ_data:[],
    selectedERP:'',
    selectedpart:'',
    onlineData: [],
    seatData: [],
    staffData: [],
    sfHLinkList: [],    
    SFPDSNLINK:[],  // SF_H_LINK API 返回的數據
    SFPDSNLINKqty:[],  // SF_H_LINK API 返回的數據
    newStaff:[],
    newSHIFT:[],
    newSeat:[],
    PDVERSON:[],
    woderpdata:[],
    erpdata1:[],
    erpdata2:[],
    erpdata3:[],
    erpdata4:[],
    erpdata5:[],
    erpdata6:[],
    WOVERSON:[],
    transResponse:[],
    WO_SUM_VERSON:[],
    RATING_SUM_VERSON:[],
    RATINGVERSON:[],
    PDTOVERSON:[],
    HOSTMACHINE:[],
    ATT_Abnormal_d: [],
    ATT_time_data:[],
    ATT_time_SUM_data:[],
    attendanceData: [], // Data fetched from the API
    selectedJobNumber: '', // Selected job number
    selectedName: '', // Selected name
  // Your condition to show rows
    fqc:[],
    MFG_D:'',
    isLoggedIn:false,
    repasswords:false,
    showADJs:false,
    username:'',
    password:'',
    power:'',
    showInSecondTable: {
        // 设置部门对应的初始状态为 true
        '2D1S1C': false 
      },
    dynamicHeaders: [], // 存儲動態列名（MFG_DAY）
    firstResult: [], // 存儲第一個查詢的數據
    chartInstance: null, // 保存图表实例
        secondResult: [],
        selectedItemDesc: '',
        selectedItemNum: '',
    selectedDate: '',
    selectedDate2: '',
    PDTYPESelect:'',
    selectedColor: '#00bfff',
    seateditMode:false,
    seathostid:'',
     showseatForm:false,
      scanContent: '',
      displayContent: '',
      showModal: false,
      modalMessage: '',
      adjWOValue: 0.00,
      showDialog: false,
      adjustmentValue: 0,
      selectedreson: '',
      resons: ['忘記掛卡/取卡', '掛卡異常', '網路異常', '斷電', '自離', '新員工', '重複掛卡','忘記設定狀態','掛錯卡', '狀態設定錯誤','其他'], // Example job orders
      currentItem: null,
      ATTSUMdata:[],
      ATTSUMdata2:[],
      WOSUMdata:[],
      WOSUMdata2:[],
      machines: ['01', '02', '03', '04'], // 機器編號陣列
      employmentTime: [
          { name: 'John Doe', STAR: 'Finance', END: 'Finance' },
          { name: 'Jane Smith', STAR: 'Finance', END: '2Finance' },
          { name: 'Michael Johnson', STAR: 'Finance', END: 'Finance' }
          // Add more employment time data here
        ],
        employees: [
          { name: 'John Doe', age: 30, department: 'IT' },
          { name: 'Jane Smith', age: 25, department: 'HR' },
          { name: 'Michael Johnson', age: 35, department: 'Finance' }
          // Add more employees here
        ],
  
  },
  watch: {

      adjustmentValue(value) {
        if (value % 0.5 !== 0) {
          this.adjustmentValue = Math.round(value * 2) / 2;
        }
  },
  selectAll(value) {
      this.ATT_time_ADJ_data.forEach(item => {
        item.selected = value;
      });
    },
  
   sfsnData(newVal) {
     /* this.$nextTick(() => {
        if (newVal && newVal.NEXTOPNO === this.SFselectedOPERATOR && newVal.LINK === 'T' && newVal.RESULT === 'Pass') {
          this.$refs.nexInputY.focus();
        }
        if (newVal && 
          ((newVal.NEXTOPNO === this.SFselectedOPERATOR && newVal.LINK === 'N' && newVal.RESULT === 'Pass') || 
           (newVal.RESULT === 'Fail' && this.SFselectedOPERATOR === '0'))) {
          this.$nextTick(() => {
            this.$refs.passButton.focus();
          });
        }
      });*/
  
      this.$nextTick(() => {
    if (this.selectedLINK === 'N') {
        if (this.$refs.passButton) {
            this.$refs.passButton.focus();
        }
    } else if (this.selectedLINK === 'T' && this.selectedDESC2 !== '') {
        if (this.$refs.nexInputY) {
            this.$refs.nexInputY.focus();
        }
    } else {
        if (this.$refs.nexInputD) {
            this.$refs.nexInputD.focus();
        }
    }
  });
    }
  
  
  },
  
  computed: {
    selectedProcess1Label() {
    return (
      this.languageMap[this.selectedProcess1]?.[this.currentLanguage] ||
      this.selectedProcess1
    );
  },
  productSummary() {
  const summary = {};

  this.tableData.forEach(row => {
    const product = row.product || '未指定品名';
    if (!summary[product]) {
      summary[product] = {
        people: 0,
        workhorse: 0.00,
        wohourse: 0.00,
        actual: 0,
        expected: 0,
        NG: 0,
        defectForming: 0,
        defectWelding: 0,
        other1: 0,
        other2: 0,
        other3: 0,
        other4: 0,
        other5: 0,
        other6: 0,
        efficiency: 0 // 先預設為 0，最後再計算
      };
    }

    const data = summary[product];

    data.people += Number(row.people || 0);
    data.workhorse += Number(row.workhorse || 0);
    data.wohourse += Number(row.wohourse || 0);
    data.actual += Number(row.actual || 0);
    data.expected += Number(row.expected || 0);
    data.NG += Number(row.NG || 0);
    data.defectForming += Number(row.defectForming || 0);
    data.defectWelding += Number(row.defectWelding || 0);
    data.other1 += Number(row.other1 || 0);
    data.other2 += Number(row.other2 || 0);
    data.other3 += Number(row.other3 || 0);
    data.other4 += Number(row.other4 || 0);
    data.other5 += Number(row.other5 || 0);
    data.other6 += Number(row.other6 || 0);
  });

  // 計算效率
  for (const product in summary) {
    const item = summary[product];
    item.efficiency = item.expected > 0 ? ((item.actual / item.expected) * 100).toFixed(2) : "0.00";
  }

  return summary;
},

  totalZHFinalBonus() {
    return Object.keys(this.ZHDEP_eff_performance_groupedData).reduce((total, erpCode1) => {
      const date = this.ZHDEP_eff_performance_dates[this.ZHDEP_eff_performance_dates.length - 1]; // 使用最後的日期
      const bonus = parseFloat(this.ZHDEP_eff_performance_getValue(erpCode1, date, '考績獎金')) || 0;
      const extraBonus = parseFloat(this.ZHDEP_eff_performance_getValue(erpCode1, date, '額外考績獎金')) || 0;
      const managementFund = parseFloat(this.ZHDEP_eff_performance_getValue(erpCode1, date, 'A15拉管理福利金')) || 0;
      return total + bonus + extraBonus + managementFund;
    }, 0); // 兩位小數
  },
  totalQCFinalBonus() {
    return Object.keys(this.QCDEP_eff_performance_groupedData).reduce((total, erpCode1) => {
      const date = this.QCDEP_eff_performance_dates[this.QCDEP_eff_performance_dates.length - 1]; // 使用最後的日期
      const bonus = parseFloat(this.QCDEP_eff_performance_getValue(erpCode1, date, '考績獎金')) || 0;
      const extraBonus = parseFloat(this.QCDEP_eff_performance_getValue(erpCode1, date, '額外考績獎金')) || 0;
      const managementFund = parseFloat(this.QCDEP_eff_performance_getValue(erpCode1, date, 'A15拉管理福利金')) || 0;
      return total + bonus + extraBonus + managementFund;
    }, 0); // 兩位小數
  },
  totalFinalBonus() {
      const lastDate = this.DEP_eff_performance_dates[this.DEP_eff_performance_dates.length - 1];
      return Object.keys(this.DEP_eff_performance_groupedData).reduce((total, erpCode1) => {
        const bonus = parseFloat(this.DEP_eff_performance_getValue(erpCode1, lastDate, '最終獎金')) || 0;
        return total + bonus;
      }, 0); // 四捨五入到小數點兩位
    },
  totalSWH() {
    return this.eff_performance_ppwodata
      .reduce((total, item) => total + Number(item.SWH), 0)
      .toFixed(2);
  },
  totalAWH() {
    return this.eff_performance_ppwodata
      .reduce((total, item) => total + Number(item.AWH), 0)
      .toFixed(2);
  },
  groupedByShift() {
      // 根據 SHIFT 分組
      return this.eff_stff_bonus.reduce((acc, item) => {
        if (!acc[item.SHIFT]) {
          acc[item.SHIFT] = [];
        }
        acc[item.SHIFT].push(item);
        return acc;
      }, {});
    },
    totalBonus() {
      // 計算實際獎金總計
      return this.eff_stff_bonus.reduce((total, item) => total + Number(item.實際獎金 || 0), 0);
    },
    processedData() {
      // 1. 使用 reduce 方法对数据进行预处理，合并相同部门的行并计算執行工時总和
      return this.WOVERSON.reduce((acc, item) => {
        // 找到 acc 中是否已存在相同部门的项
        const existingItem = acc.find(i => i.部門 === item.部門 && i.工單 === item.工單 && i.品名 === item.品名 && i.數量 === item.數量 && i.標準工時 === item.標準工時);
        if (existingItem) {
          // 如果已存在，则累加執行工時
          existingItem.執行工時 += item.執行工時;
        } else {
          // 如果不存在，则加入新的项
          acc.push({
            ...item,
            total執行工時: item.執行工時, // 新增 total執行工時 字段来显示合并后的執行工時
            uniqueKey: `${item.部門}_${item.工單}_${item.品名}_${item.數量}_${item.標準工時}` // 使用 uniqueKey 来确保每行的唯一性
          });
        }
        return acc;
      }, []);
    }
  },
  
  methods: { 
    translate(text) {
    return this.translatedText[text] || text;
  },
    renderHeaderWithSelect1(h) {
    return this.renderHeaderSelect(h, this.selectedProcess1, val => this.selectedProcess1 = val);
  },
  renderHeaderWithSelect2(h) {
    return this.renderHeaderSelect(h, this.selectedProcess2, val => this.selectedProcess2 = val);
  },
  renderHeaderWithSelect3(h) {
    return this.renderHeaderSelect(h, this.selectedProcess3, val => this.selectedProcess3 = val);
  },
  renderHeaderWithSelect4(h) {
    return this.renderHeaderSelect(h, this.selectedProcess4, val => this.selectedProcess4 = val);
  },
  renderHeaderWithSelect5(h) {
    return this.renderHeaderSelect(h, this.selectedProcess5, val => this.selectedProcess5 = val);
  },
  renderHeaderWithSelect6(h) {
    return this.renderHeaderSelect(h, this.selectedProcess6, val => this.selectedProcess6 = val);
  },
  
  renderHeaderSelect(h, selectedValue, onInput) {

    
  return h('div', [
    // 下拉選單本體
    h('el-select', {
      class: 'header-select-white',
      props: {
        value: selectedValue,
        placeholder: '選擇流程',
        size: 'mini'
      },
      on: {
        input: onInput
      }
    }, Object.keys(this.processSwitch).map(key =>
      h('el-option', {
        props: {
          label: this.translatedText[key] || key,
          value: key
        }
      })
    )),

    // 條件顯示說明區塊
    selectedValue === '打扭'
      ? h('span', { style: { fontSize: '11px', display: 'block', marginTop: '2px' } }, [
          h('small', 'xoắn dây')
        ])
      : selectedValue === '套套管'
      ? h('span', { style: { fontSize: '11px', display: 'block', marginTop: '2px' } }, [
          h('small', 'lồng vỏ bọc')
        ])
      : selectedValue === '打端子'
      ? h('span', { style: { fontSize: '11px', display: 'block', marginTop: '2px' } }, [
          h('small', 'Dập đầu sắt')
        ])
      : selectedValue === '內模'
      ? h('span', { style: { fontSize: '11px', display: 'block', marginTop: '2px' } }, [
          h('small', 'khuôn trong')
        ])
      : selectedValue === '外模'
      ? h('span', { style: { fontSize: '11px', display: 'block', marginTop: '2px' } }, [
          h('small', 'khuôn ngoài')
        ])
      : selectedValue === '外觀'
      ? h('span', { style: { fontSize: '11px', display: 'block', marginTop: '2px' } }, [
          h('small', 'ngoại quan')
        ])
      :selectedValue === '待包裝'
      ? h('span', { style: { fontSize: '11px', display: 'block', marginTop: '2px' } }, [
          h('small', 'Chờ đóng gói')
        ])
      : null
  ]);
  
},
  
getEFFData() {
      const today = new Date();
  const year = today.getFullYear();
  const month = String(today.getMonth() + 1).padStart(2, '0'); // 補零
  const day = String(today.getDate()).padStart(2, '0'); // 補零
  const formattedDate = `${year}${month}`; // YYYYMMDD
  this.EFFOVER=[];
      if (this.selectedL) {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + '-' + this.selectedL + 'C';
  } else {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
  }
        axios.get(`http://192.168.209.18:5088/api/C_PDREPORT/SELECEFFOVER?area=${this.selectedArea}&department=${this.selectedDepartment}&mfg_month=${formattedDate}`)
          .then(response => {
            if (response.data.result && response.data.result.length > 0) {
              this.EFFOVER = response.data.result[0]
            }
          })
          .catch(error => {
            console.error('獲取 EFF 資料失敗:', error)
          })
      },
  
  
  
    updateTimeOptions() {
        if (this.selectedD === "3") {
          this.timeOptions = {
            "7:00-8:00": 1.00,
            "8:00-10:00": 2.00,
            "10:00-11:40": 1.67,
            "12:00-12:40": 0.67,
            "12:40-15:00": 2.33,
            "15:00-17:00": 2,
            "17:00-20:00": 3,
            "20:00-21:00": 1,
            "21:00-22:00": 1
          };
        } else if (this.selectedD === "2") {
          this.timeOptions = {
            "7:00-8:00": 1.00,
            "8:00-10:00": 2.00,
            "10:00-11:20": 1.33,
            "11:40-12:20": 0.67,
            "12:20-15:00": 2.66,
            "15:00-17:00": 2,
            "17:00-20:00": 3,
            "20:00-21:00": 1,
            "21:00-22:00": 1
          };
        } else {
          this.timeOptions = {
            "7:00-8:00": 1.00,
            "8:00-10:00": 2.00,
            "10:00-11:10": 1.33,
            "12:20-15:00": 2.67,
            "15:00-17:00": 2,
            "17:00-20:00": 3,
            "20:00-21:00": 1,
            "21:00-22:00": 1
          };
        }
        console.log("Response:", this.selectedD);
      },
    getSummaries(param) {
  const { columns, data } = param;
  const sums = [];
  
  // 確保變數在迴圈外部定義，避免 ReferenceError
  let totalExpected = 0; // 總標準產能
  let totalActual = 0; // 總實際產出
  
  columns.forEach((column, index) => {
    if (index === 0) {
      sums[index] = '總計';
      return;
    }
  
    const prop = column.property;
    if (prop) {
      if ([ 'expected', 'actual', 'line', 'defectForming', 'defectWelding', 'NG', 'other1', 'other2', 'other3','other4', 'other5', 'other6'].includes(prop)) {
        const total = data.reduce((sum, row) => sum + (Number(row[prop]) || 0), 0);
        sums[index] =(total).toFixed(0) ;
  
        // 記錄總標準產能與總實際產出，以計算總體效率
        if (prop === 'expected') totalExpected = total;
        if (prop === 'actual') totalActual = total;
  
      } else if (prop === 'workhorse') {
        sums[index] = data.reduce((sum, row) => sum + (Number(row[prop]) || 0), 0).toFixed(2);
  
      } else if (prop === 'wohourse') {
        sums[index] = data.reduce((sum, row) => sum + (Number(this.calculateHours(row)) || 0), 0).toFixed(2);
  
      } else if (prop === 'efficiency') {
        // 計算總體效率
        sums[index] = totalExpected > 0 ? ((totalActual / totalExpected) * 100).toFixed(2) + '%' : '0%';
  
      } else {
        sums[index] = ''; // 其他欄位不加總
      }
    }
  });
  
  return sums;
  },
 
    toggleMenu() {
      this.isOpen = !this.isOpen;
    },
    async fetchProductOptions() {
  
      const today = new Date();
  const year = today.getFullYear();
  const month = String(today.getMonth() + 1).padStart(2, '0'); // 補零
  const day = String(today.getDate()).padStart(2, '0'); // 補零
  const formattedDate = `${year}${month}${day}`; // YYYYMMDD
      if (this.selectedL) {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + '-' + this.selectedL + 'C';
  } else {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
  }
        try {
         // const apiUrl = `http://192.168.209.18:5088/api/C_PDREPORT/SELECPD?area=${this.selectedArea}&department=${this.selectedDepartment}&&mfg_day=${formattedDate}`;
            let response = await fetch(`http://192.168.209.18:5088/api/C_PDREPORT/SELECTPARTDESC?area=${this.selectedArea}&department=${this.selectedDepartment}&mfg_day=${formattedDate}`);
            let data = await response.json();
            if (data.result && Array.isArray(data.result)) {
                this.productOptions = data.result.map(item => ({
                    label: item.PART_DESC.trim(),  
                    value: item.PART_DESC.trim(),   
                    name: item.PART_DESC.trim(),
                    stdm: item.stdm || 0 
                }));
            }
        } catch (error) {
            console.error("獲取品名失敗:", error);
        }
    },
    tableRowClassName({ row }) {
    return row._isSummary ? 'summary-row' : '';
  },
    resetExpected(row,rowIndex) {
    this.$nextTick(() => {
        // 找出所有屬於相同時段的行
        let mergedRows = this.tableData.filter(r => r.time === row.time);
  
        // 找到該時段的第一行
        let firstRow = mergedRows[0];
  
        // 計算該時段的最大時數 (第一行時數)
        let maxHours = this.calculateHours(firstRow);
  
        // 計算目前所有行的輸入工時總和 (確保數值為數字)
        let totalWorkhorse = mergedRows.reduce((sum, r) => sum + (Number(r.workhorse) || 0), 0);
  
        // 若總和超過最大值，則調整當前輸入的值
        if (totalWorkhorse > maxHours) {
            let excess = totalWorkhorse - maxHours;
            row.workhorse = Math.max(0, (Number(row.workhorse) || 0) - excess);
        }
  
        // 確保數值精確到小數點後兩位
        row.expected = this.calculateExpected(row,rowIndex);
        row.workhorse = parseFloat(row.workhorse.toFixed(2));
    });
  },
    calculateExpected(row, rowIndex) {
    // 找到合併的第一個 row
    let firstRowIndex = rowIndex;
    while (firstRowIndex > 0 && this.tableData[firstRowIndex - 1].time === row.time) {
        firstRowIndex--;
    }
  
    // 取得第一列的 `people`
    let firstRowPeople = this.tableData[firstRowIndex].people;
  
    // 計算預期產量
    let product = this.productOptions.find(p => p.name === row.product);
    let stdm = product ? product.stdm : 0;
    let timeMinutes = this.timeOptions[row.time] || 0;
     return Math.floor(row.workhorse * stdm);
   // return Math.floor(row.workhorse * firstRowPeople * stdm);
  },
  
    calculateHours(row) {
        return (row.people || 0.00) * (this.timeOptions[row.time] || 0.00);
    },
    async fetchTableData() {
  
      const today = new Date();
  const year = today.getFullYear();
  const month = String(today.getMonth() + 1).padStart(2, '0'); // 補零
  const day = String(today.getDate()).padStart(2, '0'); // 補零
  const formattedDate = `${year}${month}${day}`; // YYYYMMDD
      if (this.selectedL) {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + '-' + this.selectedL + 'C';
  } else {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
  }
  
  
  
  
      try {
        const apiUrl = `http://192.168.209.18:5088/api/C_PDREPORT/SELECPD?area=${this.selectedArea}&department=${this.selectedDepartment}&&mfg_day=${formattedDate}`;
        const response = await axios.get(apiUrl);
        console.log("Response:", response.data);
        if (!response.data.result || !Array.isArray(response.data.result)) {
          console.error("API response is invalid:", response.data);
          return;
        }
  
        // 清理數據，把 undefined、空字串 或 "undefined" 轉為空值或 0
        this.tableData = response.data.result.map(item => ({
            ID: item.ID || "",  
          AREA: item.AREA || "",
          MFG_DAY: item.MFG_DAY, // API 回傳沒有 MFG_DAY，從參數取得
          DEPARTMENT: item.DEPARTMENT || "",
          people: item.people || "0",
          time: item.time || "",
          workhorse: item.workhorse || "",
          product: item.product || "",
          expected: item.expected || "0",
          actual: item.actual || "0",
          line: item.line && item.line !== "undefined" ? item.line : "",
          defectForming: item.defectForming && item.defectForming !== "undefined" ? item.defectForming : "0",
          defectWelding: item.defectWelding && item.defectWelding !== "undefined" ? item.defectWelding : "0",
          NG: item.NG && item.NG !== "undefined" ? item.NG : "0",
          other1: item.other1 && item.other1 !== "undefined" ? item.other1 : "0",
          other2: item.other2 && item.other2 !== "undefined" ? item.other2 : "0",
          other3: item.other3 && item.other3 !== "undefined" ? item.other3 : "0",
          other4: item.other4 && item.other4 !== "undefined" ? item.other4 : "0",
          other5: item.other5 && item.other5 !== "undefined" ? item.other5 : "0",
          other6: item.other6 && item.other6 !== "undefined" ? item.other6 : "0",
          other1_desc: item.other1_desc || "",
          other2_desc: item.other2_desc || "",
          other3_desc: item.other3_desc || "",
          other4_desc: item.other4_desc || "",
          other5_desc: item.other5_desc || "",
          other6_desc: item.other6_desc || "",
        }));
      } catch (error) {
        console.error("Error fetching data:", error);
      }
      if (this.tableData.length > 0) {
  const firstRow = this.tableData[0];
  this.selectedProcess1 = firstRow.other1_desc || "";
  this.selectedProcess2 = firstRow.other2_desc || "";
  this.selectedProcess3 = firstRow.other3_desc || "";
  this.selectedProcess4 = firstRow.other4_desc || "";
  this.selectedProcess5 = firstRow.other5_desc || "";
  this.selectedProcess6 = firstRow.other6_desc || "";


}
    },
    async toggleEditMode() { // 確保這裡是 async
    this.editMode = !this.editMode;
    const today = new Date();
  const year = today.getFullYear();
  const month = String(today.getMonth() + 1).padStart(2, '0'); // 補零
  const day = String(today.getDate()).padStart(2, '0'); // 補零
  const formattedDate = `${year}${month}${day}`; // YYYYMMDD
  
    if (!this.editMode) {
      try {
        // 確保所有數據轉成字串
        const formattedData = this.tableData.map(row => ({
       //   AREA: String(row.AREA),
     //     MFG_DAY: String(row.MFG_DAY),
       //   DEPARTMENT: String(row.DEPARTMENT),
          ID: String(row.ID)|| "0",
          AREA: this.selectedArea,
          MFG_DAY: formattedDate,
          DEPARTMENT: this.selectedDepartment,
          PEOPLE: String(row.people),
          TIME: String(row.time),
          PRODUCT: String(row.product),
          WORKHORSE:String(row.workhorse),
          EXPECTED: String(row.expected),
          ACTUAL: String(row.actual),
          LINE: String(row.line),
          DEFECTFORMING: String(row.defectForming),
          DEFECTWELDING: String(row.defectWelding),
          NG: String(row.NG),
          OTHER1: String(row.other1),
          OTHER2: String(row.other2),
          OTHER3: String(row.other3),
          OTHER4: String(row.other4),
          OTHER5: String(row.other5),
          OTHER6: String(row.other6),
          OTHER1_DESC: this.selectedProcess1,
          OTHER2_DESC: this.selectedProcess2,
          OTHER3_DESC: this.selectedProcess3,
          OTHER4_DESC: this.selectedProcess4,
          OTHER5_DESC: this.selectedProcess5,
          OTHER6_DESC: this.selectedProcess6,
        }));
        console.log("送出前的資料:", JSON.stringify(formattedData, null, 2));
  
        console.log("Response:", formattedData);

       const response = await axios.post("http://192.168.209.18:5088/api/C_PDREPORT/InsertOrUpdate", 
     //const response = await axios.post("  https://localhost:5001/api/C_PDREPORT/InsertOrUpdate", 
  formattedData, // 直接傳遞數據
  { headers: { "Content-Type": "application/json" } }
  );
        console.log("Response:", response.data);
        this.$message.success("資料已成功提交！");
  
  
      this.fetchTableData();
  
      } catch (error) {
        console.error("API Error:", error);
        this.$message.error("提交失敗，請稍後再試！");
  
      }
    } else {
      this.fetchProductOptions(); // 在編輯模式開啟時調用
    }
  },
  addRow() {
        this.tableData.push({ ID:0 ,people: 0, time: "", product: "", expected: 0, actual: 0,workhorse:0,line:0,defectForming:0,defectWelding:0,NG:0,other1:0,other2:0,other3:0,other4:0,other5:0,other6:0 });
    },
    async removeRow2(row, index) {
  const deletedId = row.ID; // 取得要刪除的 ID
  console.log("🔹 刪除的 ID:", deletedId);
  if (!deletedId) {
    console.warn("⚠️ ID 為 null，直接刪除前端資料");
    this.tableData.splice(index, 1);
    return;
  }
  try {
    const response = await axios.post(
      "http://192.168.209.18:5088/api/C_PDREPORT/delete",
      { ID: String(deletedId) },
      {
        headers: {
          "Content-Type": "application/json",
        },
      }
    );
  
    console.log("🔹 API Response:", response);
  
    if (response.data && response.data.message === "Record deleted successfully.") {
      this.tableData.splice(index, 1);
    } else {
      alert("刪除失敗：" + (response.data?.message || "未知錯誤"));
    }
  } catch (error) {
    console.error("🔴 刪除時發生錯誤:", error);
    if (error.response) {
      console.error("🔴 伺服器回應:", error.response);
      alert("錯誤：" + (error.response.data?.message || "請求無效"));
    } else {
      alert("無法連線到伺服器，請稍後再試");
    }
  }
  },
  
    calculateEfficiency(row) {
        if (row.expected === 0) return 0;
        return ((row.actual / row.expected) * 100).toFixed(2);
    },
  
    // **合併相同時段的儲存格**
    mergeTable2({ row, column, rowIndex }) {


      
    // 這裡使用 column.id 來判斷需要合併的欄位
    if (["time", "people","wohourse","line","defectForming","defectWelding","NG","other1","other2","other3","other4","other5","other6"].includes(column.property)) { 
        let prevRow = this.tableData[rowIndex - 1];
  
        // 第一行 或者 「時段不同」時，開始合併
        if (rowIndex === 0 || row.time !== prevRow?.time) {
            let count = 1;
            for (let i = rowIndex + 1; i < this.tableData.length; i++) {
                if (this.tableData[i].time === row.time) {
                    count++;
                } else {
                    break;
                }
            }
            return { rowspan: count, colspan: 1 };
        } else {
            return { rowspan: 0, colspan: 0 };
        }
    }
  },
  mergeTable({ row, column, rowIndex }) {
  // 根據部門選擇不同的合併欄位清單
  /*const mergeColumns = (this.selectedDepartment?.toUpperCase() === '3D1S6C')
    ? ["time", "people", "wohourse"]
    : [
        "time", "people", "wohourse", "line",
        "defectForming", "defectWelding", "NG",
        "other1", "other2", "other3", "other4", "other5", "other6"
      ];*/

      const mergeColumns = this.isMergeEnabled
    ? [
        "time", "people", "wohourse", "line",
        "defectForming", "defectWelding", "NG",
        "other1", "other2", "other3", "other4", "other5", "other6"
      ]
    : ["time", "people", "wohourse"];
  // 如果該欄位不在要合併的欄位中，就回傳預設 rowspan:1
  if (!mergeColumns.includes(column.property)) {
    return { rowspan: 1, colspan: 1 };
  }

  const currentTime = row.time;
  const prevRow = this.tableData[rowIndex - 1];

  // 第一列 或時段不同 → 計算 rowspan
  if (rowIndex === 0 || currentTime !== prevRow?.time) {
    let rowspan = 1;
    for (let i = rowIndex + 1; i < this.tableData.length; i++) {
      if (this.tableData[i].time === currentTime) {
        rowspan++;
      } else {
        break;
      }
    }
    return { rowspan, colspan: 1 };
  }

  // 其他重複列不顯示
  return { rowspan: 0, colspan: 0 };
},

    
  
  
    handleTestMachine(machineNumber) {
    this.deviceSerial = machineNumber; // 更新 deviceSerial 為按鈕所對應的編號
    this.$refs.scanInput.focus();
    console.log('Selected device serial:', this.deviceSerial);
  },
    async revise() {
      if (!this.oldPassword || !this.newPassword) {
        alert("請輸入舊密碼和新密碼！");
        return;
      }
  
      try {
        const response = await fetch("http://192.168.209.18:5088/api/LOGIN/Revise", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            Username: this.user.username, // 請替換為目前使用者的用戶名
            Password: this.oldPassword,
            NewPassword: this.newPassword,
          }),
        });
  
        if (response.ok) {
          const result = await response.json();
          alert("密碼修改成功！");
          this.logout();
          this.repasswords=false;
          this.user = { permissions: [] };
        this.credentials = {
          username: '',
          password: '',
        };
        this.oldPassword = ''; // 清空舊密碼輸入框
        this.newPassword = ''; // 清空新密碼輸入框
        } else if (response.status === 401) {
          alert("驗證失敗，舊密碼不正確！");
        } else {
          alert("密碼修改失敗，請稍後重試！");
        }
      } catch (error) {
        console.error("API 呼叫失敗:", error);
        alert("出現錯誤，請稍後再試！");
      }
    },
  
    calculateTotalCompletedQty(item) {
    // 数字相加
    const total = (parseFloat(item.COMPLETED_QTY_1) || 0) + 
                  (parseFloat(item.COMPLETED_QTY_2) || 0) + 
                  (parseFloat(item.COMPLETED_QTY_3) || 0) + 
                  (parseFloat(item.COMPLETED_QTY_4) || 0) + 
                  (parseFloat(item.COMPLETED_QTY_5) || 0);
    return total.toFixed(0); // 保留两位小数
  },
    async fetchOperations() {
      if (!this.SFselectedWO) return;
  
     // const apiUrl = `https://localhost:5001/api/SHOPFLOOR/OPERATION_LIST?WO_ID=${this.SFselectedWO}`;
     const apiUrl = `http://192.168.209.18:5088/api/SHOPFLOOR/OPERATION_LIST?WO_ID=${this.SFselectedWO}`;
      try {
        const response = await fetch(apiUrl);
        if (response.ok) {
          const data = await response.json();
          this.SFoperations = data.result || [];
        } else {
          console.error("API 請求失敗:", response.status);
        }
      } catch (error) {
        console.error("API 請求出錯:", error);
      }
    },
    async fetchSNData() {
      try {
        // 查詢 SN_LIST API
        const snListResponse = await axios.get(`http://192.168.209.18:5088/api/SHOPFLOOR/SN_LIST?sn=${this.snInput}`);
        this.snList = snListResponse.data.result || [];
  
        // 查詢 SF_H_LINK API
        const sfHLinkResponse = await axios.get(`http://192.168.209.18:5088/api/SHOPFLOOR/SN_LIST_LIK?sn=${this.snInput}`);
        this.sfHLinkList = sfHLinkResponse.data.result || [];
      } catch (error) {
        console.error('查詢失敗', error);
      }
    },
    async fetchPDSNData() {
      this.loading = true;
      const date = new Date(this.selectedDate);
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    const formattedDate = `${year}${month}${day}`;
  
    const date2 = new Date(this.selectedDate2);
    const year2 = date2.getFullYear();
    const month2 = (date2.getMonth() + 1).toString().padStart(2, '0');
    const day2 = date2.getDate().toString().padStart(2, '0');
    const formattedDate2 = `${year2}${month2}${day2}`;
      try {
  
        // 查詢 SF_H_LINK API
        const sfHLinkResponse = await axios.get(`http://192.168.209.18:5088/api/SHOPFLOOR/PDSN_TRANS?MFG_DAY1=${formattedDate}&MFG_DAY2=${formattedDate2}&TYPE=${this.PDTYPESelect}`);
        this.SFPDSNLINK = sfHLinkResponse.data.result || [];
        this.loading = false;
      } catch (error) {
        console.error('查詢失敗', error);
        this.loading = false;
      }
    },
    async fetchfailSNData() {
      this.loading = true;
      const date = new Date(this.selectedDate);
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    const formattedDate = `${year}${month}${day}`;
  
    const date2 = new Date(this.selectedDate2);
    const year2 = date2.getFullYear();
    const month2 = (date2.getMonth() + 1).toString().padStart(2, '0');
    const day2 = date2.getDate().toString().padStart(2, '0');
    const formattedDate2 = `${year2}${month2}${day2}`;
      try {
  
        // 查詢 SF_H_LINK API
  
        const sfHLinkResponse = await axios.get(`http://192.168.209.18:5088/api/SHOPFLOOR/FAILSN_TRANS2?MFG_DAY1=${formattedDate}&MFG_DAY2=${formattedDate2}&TYPE=${this.PDTYPESelect}`);
       //const sfHLinkResponse = await axios.get(`https://localhost:5001/api/SHOPFLOOR/FAILSN_TRANS2?MFG_DAY1=${formattedDate}&MFG_DAY2=${formattedDate2}&TYPE=${this.PDTYPESelect}`);
        this.SFPDSNLINK = sfHLinkResponse.data.result1 || [];
        this.SFPDSNLINKqty = sfHLinkResponse.data.result2 || [];
        console.log("API 請求出錯:", this.SFPDSNLINKqty[0].sn_qty);
        this.loading = false;
      } catch (error) {
        console.error('查詢失敗', error);
        this.loading = false;
      }
    },
    eff_performance_sumColumn(data, date, field, 部門) {
    return Object.keys(data).reduce((sum, erpCode) => {
      const department = this.eff_performance_getValue(erpCode, date, '部門');
      if (department === 部門) {
        const value = this.eff_performance_getValue(erpCode, date, field);
        return sum + (isNaN(value) ? 0 : Number(value));
      }
      return sum;
    }, 0);
  },
  
    formatCurrency(value) {
  // 將數值格式化為金錢樣式，但不添加貨幣符號
  if (typeof value === "number") {
    return new Intl.NumberFormat('zh-TW', { 
      minimumFractionDigits: 0, 
      maximumFractionDigits: 0 
    }).format(value);
  }
  return value;
  },
  
    calculateShiftBonus(shift) {
      // 計算每個 SHIFT 的實際獎金總計
      const group = this.groupedByShift[shift] || [];
      return group.reduce((total, item) => total + Number(item.實際獎金 || 0), 0);
    },
    getTotalCount() {
    return this.productionData ? this.productionData.length : 0;
  },
  getTotalCountPDLIST() {
    return this.SFPDSNLINK ? this.SFPDSNLINK.length : 0;
  },
  getTotalCountPDLIST2() {
    return this.SFPDSNLINKqty[0].sn_qty; 
    
  },
  getTotalCountFAILREWORKLIST() {
    return this.SFPDSNLINK ?  this.SFPDSNLINK.filter(item => item.重工結果 === 'Pass').length : 0;
  },
  getPassCount() {
    return this.productionData ? this.productionData.filter(item => item.RESULT === 'Pass').length : 0;
  },
  getDeviceCount(machineNumber) {
    const count = this.productionData.filter(item => item.deviceSerial === machineNumber).length;
    return count % 80; // 80 顯示 0，81 顯示 1，160 顯示 0，161 顯示 1 ...
  },
  getFailCount() {
    return this.productionData ? this.productionData.filter(item => item.RESULT === 'Fail').length : 0;
  },
    handleClick2() {
  
      if (this.sfsnData.TRANS_ID1.length !== this.TRANS1_LIMIT) {
        this.sfsnData.TRANS_ID1 = ''; // 清空输入框内容
        this.$refs.nexInputY.focus();  // 重新聚焦到输入框
  
  
      } else {
  
        this.$refs.nexInput.focus();
      }
    //  this.$refs.nexInput.focus();
    },
  
    handleClick(result) {
    // Update modal content
    this.displayContent = this.scanContent;
    this.modalMessage = `這是${result}: ${this.displayContent}`;
    this.showModal = true;
  
    // Prepare the data to be sent to the API
    const requestData = {
        area: this.selectedArea, // Replace with actual value
        wo_id: this.sfsnData.WO_ID , // Replace with actual value
        part_no: this.sfsnData.part_no , // Replace with actual value
        sn:  this.sfsnData.SN, // Replace with actual value
        operatioN_NO: this.SFselectedOPERATOR,
        operatioN_DESC: this.selectedText, // 使用获取到的文本
        result: result, // Pass the result (PASS/FAIL)
        deviceSerial:this.deviceSerial
        
    };
    console.log('更新成功', requestData);
    // Call the APIhttps://localhost:5001/api/SHOPFLOOR/INSERTSN
  
  //   fetch('http://192.168.209.18:5088/api/SHOPFLOOR/INSERTSN', {
  fetch('http://192.168.209.18:5088/api/SHOPFLOOR/INSERTSN', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(requestData)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json(); // Parse JSON response
    })
    .then(data => {
        console.log('Success:', data);
        this.modalMessage = data.message; // Use message from response
    })
    .catch((error) => {
        console.error('Error:', error);
        this.modalMessage = `上傳成功: ${this.displayContent}`;
    })
    .finally(() => {
        setTimeout(() => {
            this.showModal = false;
            this.scanContent='';
            this.deviceSerial='';
            this.sfsnData=null;
            this.$refs.scanInput.focus();
        }, 500);
  
    });
    this.SNSUMSELECT();
  },
  async generateSerialNumbers() {
      const url = `http://192.168.209.18:5088/api/SHOPFLOOR/GenerateSerialNumbers`;
      try {
        const response = await axios.post(url, null, {
          params: {
            initialSerialNumber: this.initialSerialNumber,
            count: this.count,
            woId: this.woId,
          },
        });
        this.responseMessage = response.data;
      } catch (error) {
        this.responseMessage =
          error.response?.data || "序號生成失敗，請檢查輸入內容。";
      }
    },
  seloption() {
  
  
  const selectedOperation = this.SFoperations.find(
    (operation) => operation.OPERATION_NO === this.SFselectedOPERATOR
  );
  
  
  // 如果找到对应的工站，则更新 selectedText
  this.selectedText = selectedOperation 
    ? selectedOperation.OPERATION_DESC 
    : '';
    this.selectedLINK = selectedOperation 
    ? selectedOperation.LINK 
    : '';
    this.selectedDESC1 = selectedOperation 
    ? selectedOperation.TRANS_DESC1 
    : '';
    this.selectedDESC2 = selectedOperation 
    ? selectedOperation.TRANS_DESC2 
    : '';
    this.TRANS1_LIMIT = selectedOperation 
    ? selectedOperation.TRANS1_LIMIT 
    : '';
    this.TRANS2_LIMIT = selectedOperation 
    ? selectedOperation.TRANS2_LIMIT 
    : '';
  
  
    console.log('Success from INSERTSN:',  this.selectedText);
  
  
  //this.selectedText = this.SFoperations[this.SFselectedOPERATOR].OPERATION_DESC || '';
  
  
  this.SNSUMSELECT();
    
  },
  
  SNSUMSELECT(){
    const area = this.selectedArea;
    const wo = this.SFselectedWO;
    const operation = this.SFselectedOPERATOR;
  
    const apiUrl = `http://192.168.209.18:5088/api/SHOPFLOOR/SNresultSELECT?area=${area}&operation=${operation}&wo=${wo}`;
    axios.get(apiUrl)
      .then(response => {
        this.productionData = response.data; // 将返回的数据存储到 productionData 中
      })
      .catch(error => {
        console.error("API 调用失败:", error);
      });
      console.log("API:", this.productionData);
  },
  
  
  handleEntertosc(){
    this.$refs.scanInput.focus();
  
  
  },
  handleEnterLINKKey() {
  
  if (this.sfsnData.TRANS_ID2.length !== this.TRANS2_LIMIT && this.selectedDESC2!=='') {
     this.sfsnData.TRANS_ID2 = ''; // 清空输入框内容
    this.$refs.nexInput.focus();
  
  } else if ((this.sfsnData.TRANS_ID1.length !== this.TRANS1_LIMIT && this.selectedDESC2==='')){ 
  
  this.sfsnData.TRANS_ID1 = ''; // 清空输入框内容
  this.$refs.nexInputD.focus();
  
  
  } else {
        this.displayContent = this.scanContent;
    this.modalMessage = `這是: ${this.displayContent}`;
    this.showModal = true;
  
    // 請求1的數據
    const requestData1 = {
        area: this.selectedArea,
        part_no: this.sfsnData.part_no, // Replace with actual value
        operatioN_NO: this.SFselectedOPERATOR, // Replace with actual value
        masteR_ID: this.sfsnData.SN,
        tranS_ID1: this.sfsnData.TRANS_ID1,  // 根據需求設置
        tranS_ID2: this.sfsnData.TRANS_ID2,
    };
  
    // 請求2的數據
    const requestData2 = {
        area: this.selectedArea, // Replace with actual value
        wo_id: this.sfsnData.WO_ID, // Replace with actual value
        part_no: this.sfsnData.part_no, // Replace with actual value
        sn: this.sfsnData.SN, // Replace with actual value
        operatioN_NO: this.SFselectedOPERATOR, // Replace with actual value
        operatioN_DESC: this.selectedText, // Replace with actual value
        result: 'Pass' ,// Pass the result (PASS/FAIL)
        deviceSerial:this.deviceSerial
    };
    // 同時發送兩個請求
    Promise.all([
    fetch('http://192.168.209.18:5088/api/SHOPFLOOR/INSERT_LINK', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(requestData1)
    }),
    fetch('http://192.168.209.18:5088/api/SHOPFLOOR/INSERTSN', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(requestData2)
    })
  ])
  .then(responses => {
    // 动态解析响应
    return Promise.all(responses.map(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.text().then(text => {
            try {
                return JSON.parse(text);
            } catch {
                return { message: text }; // 返回原始文本作为 message
            }
        });
    }));
  })
  .then(dataArray => {
    const [data1, data2] = dataArray;
    console.log('Success from INSERT_LINK:', data1);
    console.log('Success from INSERTSN:', data2);
    this.modalMessage = `${data1.message}\n${data2.message}`;
  })
  .catch(error => {
    console.error('Error:', error);
    this.modalMessage = `上傳失敗: ${this.displayContent}`;
    setTimeout(() => {
        this.showModal = false;
        this.scanContent = '';
        this.deviceSerial='';
        this.sfsnData = null;
        this.$refs.scanInput.focus();
    }, 500);
    this.seloption();
  })
  .finally(() => {
    setTimeout(() => {
        this.showModal = false;
        this.scanContent = '';
        this.deviceSerial='';
        this.sfsnData = null;
        this.$refs.scanInput.focus();
    }, 500);
    this.seloption();
  });
  
      }
  },
  
  async handleEnter() {
      
      try {
        const response = await axios.get(
          'http://192.168.209.18:5088/api/SHOPFLOOR/SNSELECT',
          {
            params: {
              area: this.selectedArea,
              SN: this.scanContent,
              OP: this.SFselectedOPERATOR
            }
          }
        );
  
        // 假设响应数据是一个数组，我们只取第一个元素
        if (response.data && response.data.length > 0) {
          this.sfsnData = response.data[0];
  
          console.log('Success from INSERT_LINK:', this.SFselectedOPERATOR);
          if (this.SFselectedOPERATOR === '40' ) {
        // 调用第二个 API
        const response2 = await axios.get(
          'http://192.168.209.18:5088/api/SHOPFLOOR/SN_TRANS',
          {
            params: {
              sn: this.scanContent // 使用 scanContent 作为 sn 参数
            }
          }
        );
  
        // 保存第二个 API 的结果
        this.transResponse = response2.data.result[0]; // 假设返回的数据直接赋值
      } else {
        this.transResponse = null; // 如果条件不符合，清空第二个 API 数据
      }
      console.log('Success from INSERT_LINK:',  this.transResponse);
      this.scanContent='';
  
        } else {
          // 如果没有数据，清空显示
          this.sfsnData = null;
          this.scanContent='';
        }
      } catch (error) {
        console.error('API 请求失败:', error);
        // 处理错误时也清空显示
        this.sfsnData = null;       
         this.scanContent='';
            }
  
  
  
  
    },
  
          /*  handleKeydown(event) {
          if (event.key === 'a' || event.key === 'A') {
            this.handleClick('PASS');
  
          } else if (event.key === 'b' || event.key === 'B') {
            this.handleClick('FAIL');
          }
        },*/
        async RATING_fetchData() {
  
          if (this.selectedL) {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + '-' + this.selectedL + 'C';
  } else {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
  }
          const Department = this.selectedDepartment;
          const area = this.selectedArea;
  
          try {
            const response = await axios.get(`http://192.168.209.18:5088/api/READWOID/SELECT_RATING?area=${area}&department=${Department}`);
            this.  RATING_data = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
    async eff_performance_fetchData() {
      const area = this.selectedArea;
      const year = this.selectedYear;
      const month = this.selectedMonth;
          try {
            const response = await axios.get(`http://192.168.209.18:5088/api/performance/effperformance?area=${area}&year=${year}&month=${month}`);
            this.  eff_performance_data = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
        async DEP_eff_performance_fetchData() {
          const area = this.selectedArea;
      const year = this.selectedYear;
      const month = this.selectedMonth;
          try {
            const response = await axios.get(`http://192.168.209.18:5088/api/performance/DEPPER?area=${area}&year=${year}&month=${month}`);
            this.  DEP_eff_performance_data = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
        async QCDEP_eff_performance_fetchData() {
          const area = this.selectedArea;
      const year = this.selectedYear;
      const month = this.selectedMonth;
          try {
            const response = await axios.get(`http://192.168.209.18:5088/api/performance/QCDEPPER?area=${area}&year=${year}&month=${month}`);
            this.  QCDEP_eff_performance_data = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
        async ZHDEP_eff_performance_fetchData() {
          try {
            const response = await axios.get('http://192.168.209.18:5088/api/performance/ZHDEPPER?area=VN');
            this.  ZHDEP_eff_performance_data = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
        async DEP_eff_OVERFLOW_fetchData() {
          const area = this.selectedArea;
      const year = this.selectedYear;
      const month = this.selectedMonth;
          try {
            const response = await axios.get(`http://192.168.209.18:5088/api/performance/DEPover?area=${area}&year=${year}&month=${month}`);
            this.  DEP_eff_performance_data = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
        async QCDEP_eff_OVERFLOW_fetchData() {
          const area = this.selectedArea;
      const year = this.selectedYear;
      const month = this.selectedMonth;
          try {
            const response = await axios.get(`http://192.168.209.18:5088/api/performance/QCDEPover?area=${area}&year=${year}&month=${month}`);
            this.  QCDEP_eff_performance_data = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
        async CNDEP_eff_OVERFLOW_fetchData() {
          try {
            const response = await axios.get('http://192.168.209.18:5088/api/performance/CNDEPover?area=VN');
            this.  ZHDEP_eff_performance_data = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
        async eff_performance_ppwo() {
          const area = this.selectedArea;
      const year = this.selectedYear;
      const month = this.selectedMonth;
          try {
            const response = await axios.get(`http://192.168.209.18:5088/api/performance/PPWO?area=${area}&year=${year}&month=${month}`);
            this.eff_performance_ppwodata = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
        async eff_performance_eff120() {
          const area = this.selectedArea;
      const year = this.selectedYear;
      const month = this.selectedMonth;
          try {
            const response = await axios.get(`http://192.168.209.18:5088/api/performance/eff120?area=${area}&year=${year}&month=${month}`);
            this.eff_performance_eff120data = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
        async eff_stff_bonus_fetchData() {
          const area = this.selectedArea;
      const year = this.selectedYear;
      const month = this.selectedMonth;
          try {
            const response = await axios.get(`http://192.168.209.18:5088/api/performance/stff_bonus?area=${area}&year=${year}&month=${month}`);
            this.eff_stff_bonus = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
        async eff_stff_OVER_bonus_fetchData() {
          const area = this.selectedArea;
      const year = this.selectedYear;
      const month = this.selectedMonth;
          try {
            const response = await axios.get(`http://192.168.209.18:5088/api/performance/stff_OVER_bonus?area=${area}&year=${year}&month=${month}`);
            this.eff_stff_bonus = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
        async overflow_performance_fetchData() {
          const area = this.selectedArea;
      const year = this.selectedYear;
      const month = this.selectedMonth;
          try {
            const response = await axios.get(`http://192.168.209.18:5088/api/performance/overflowperformance?area=${area}&year=${year}&month=${month}`);
            this.  eff_performance_data = response.data.result;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },
        eff_performance_processData() {
          const dateSet = new Set();
          const grouped = {};
  
          // 处理数据
          this. eff_performance_data.forEach(item => {
            dateSet.add(item.日期);
            if (!grouped[item.ERP班別代號]) {
              grouped[item.ERP班別代號] = {};
            }
            grouped[item.ERP班別代號][item.日期] = item;
          });
  
          this.eff_performance_dates = Array.from(dateSet).sort();
          this.eff_performance_groupedData = grouped;
          console.log('API response:', grouped);
          console.log('API response:', this.eff_performance_groupedData);
        },
        DEP_eff_performance_processData() {
          const dateSet = new Set();
          const grouped = {};
  
          // 处理数据
          this.DEP_eff_performance_data.forEach(item => {
            dateSet.add(item.日期);
            if (!grouped[item.ERP班別代號]) {
              grouped[item.ERP班別代號] = {};
            }
            grouped[item.ERP班別代號][item.日期] = item;
          });
  
          this.DEP_eff_performance_dates = Array.from(dateSet).sort();
          this.DEP_eff_performance_groupedData = grouped;
          console.log('API response:', grouped);
          console.log('API response:', this.DEP_eff_performance_groupedData);
        },
        QCDEP_eff_performance_processData() {
          const dateSet = new Set();
          const grouped = {};
  
          // 处理数据
          this.QCDEP_eff_performance_data.forEach(item => {
            dateSet.add(item.日期);
            if (!grouped[item.ERP班別代號]) {
              grouped[item.ERP班別代號] = {};
            }
            grouped[item.ERP班別代號][item.日期] = item;
          });
  
          this.QCDEP_eff_performance_dates = Array.from(dateSet).sort();
          this.QCDEP_eff_performance_groupedData = grouped;
          console.log('API response:', grouped);
          console.log('API response:', this.QCDEP_eff_performance_groupedData);
        },
        ZHDEP_eff_performance_processData() {
          const dateSet = new Set();
          const grouped = {};
  
          // 处理数据
          this.ZHDEP_eff_performance_data.forEach(item => {
            dateSet.add(item.日期);
            if (!grouped[item.ERP班別代號]) {
              grouped[item.ERP班別代號] = {};
            }
            grouped[item.ERP班別代號][item.日期] = item;
          });
  
          this.ZHDEP_eff_performance_dates = Array.from(dateSet).sort();
          this.ZHDEP_eff_performance_groupedData = grouped;
          console.log('API response:', grouped);
          console.log('API response:', this.ZHDEP_eff_performance_groupedData);
        },
        DEP_eff_OVERFLOE_processData() {
          const dateSet = new Set();
          const grouped = {};
  
          // 处理数据
          this.DEP_eff_performance_data.forEach(item => {
            dateSet.add(item.日期);
            if (!grouped[item.ERP班別代號]) {
              grouped[item.ERP班別代號] = {};
            }
            grouped[item.ERP班別代號][item.日期] = item;
          });
  
          this.DEP_eff_performance_dates = Array.from(dateSet).sort();
          this.DEP_eff_performance_groupedData = grouped;
          console.log('API response:', grouped);
          console.log('API response:', this.DEP_eff_performance_groupedData);
        },
        QCDEP_eff_OVERFLOE_processData() {
          const dateSet = new Set();
          const grouped = {};
  
          // 处理数据
          this.QCDEP_eff_performance_data.forEach(item => {
            dateSet.add(item.日期);
            if (!grouped[item.ERP班別代號]) {
              grouped[item.ERP班別代號] = {};
            }
            grouped[item.ERP班別代號][item.日期] = item;
          });
  
          this.QCDEP_eff_performance_dates = Array.from(dateSet).sort();
          this.QCDEP_eff_performance_groupedData = grouped;
          console.log('API response:', grouped);
          console.log('API response:', this.QCDEP_eff_performance_groupedData);
        },
        CNDEP_eff_OVERFLOE_processData() {
          const dateSet = new Set();
          const grouped = {};
  
          // 处理数据
          this.ZHDEP_eff_performance_data.forEach(item => {
            dateSet.add(item.日期);
            if (!grouped[item.ERP班別代號]) {
              grouped[item.ERP班別代號] = {};
            }
            grouped[item.ERP班別代號][item.日期] = item;
          });
  
          this.ZHDEP_eff_performance_dates = Array.from(dateSet).sort();
          this.ZHDEP_eff_performance_groupedData = grouped;
          console.log('API response:', grouped);
          console.log('API response:', this.ZHDEP_eff_performance_groupedData);
        },
        overflow_performance_processData() {
          const dateSet = new Set();
          const grouped = {};
  
          // 处理数据
          this. eff_performance_data.forEach(item => {
            dateSet.add(item.日期);
            if (!grouped[item.ERP班別代號]) {
              grouped[item.ERP班別代號] = {};
            }
            grouped[item.ERP班別代號][item.日期] = item;
          });
  
          this.eff_performance_dates = Array.from(dateSet).sort();
          this.eff_performance_groupedData = grouped;
          console.log('API response:', grouped);
          console.log('API response:', this.eff_performance_groupedData);
        },
        eff_performance_getValue(erpCode, date, field) {
          return this.eff_performance_groupedData[erpCode] && this.eff_performance_groupedData[erpCode][date] ? this.eff_performance_groupedData[erpCode][date][field] : '-';
        },
        DEP_eff_performance_getValue(erpCode, date, field) {
          return this.DEP_eff_performance_groupedData[erpCode] && this.DEP_eff_performance_groupedData[erpCode][date] ? this.DEP_eff_performance_groupedData[erpCode][date][field] : '-';
        },
        QCDEP_eff_performance_getValue(erpCode, date, field) {
          return this.QCDEP_eff_performance_groupedData[erpCode] && this.QCDEP_eff_performance_groupedData[erpCode][date] ? this.QCDEP_eff_performance_groupedData[erpCode][date][field] : '-';
        },
        ZHDEP_eff_performance_getValue(erpCode, date, field) {
          return this.ZHDEP_eff_performance_groupedData[erpCode] && this.ZHDEP_eff_performance_groupedData[erpCode][date] ? this.ZHDEP_eff_performance_groupedData[erpCode][date][field] : '-';
        },
        overflow_performance_getValue(erpCode, date, field) {
          return this.eff_performance_groupedData[erpCode] && this.eff_performance_groupedData[erpCode][date] ? this.eff_performance_groupedData[erpCode][date][field] : '-';
        },
  
        eff_performance_formatNumber(value) {
        return (typeof value === 'number' && !isNaN(value)) ? value.toFixed(2) : '-';
         },
        overflow_performance_formatNumber(value) {
          return typeof value === 'number' ? value.toFixed(2) : '-';
        },
        eff_performance_formatNumber2(value) {
           return (typeof value === 'number' && !isNaN(value)) ? value.toFixed(2) + '%' : '-';
         },
        overflow_performance_formatNumber2(value) {
          return typeof value === 'number' ? value.toFixed(2)+'%' : '-';
        },
        
        async effper() {
    // 使用 selectedArea 作为参数进行 API 调用
    await this.eff_performance_fetchData();
     this.eff_performance_processData();
     await this.eff_performance_ppwo();
     await this. eff_performance_eff120();
     await this.eff_stff_bonus_fetchData();
    await this.DEP_eff_performance_fetchData();
      this.DEP_eff_performance_processData();
    await this.QCDEP_eff_performance_fetchData();
     this.QCDEP_eff_performance_processData();
    await this.ZHDEP_eff_performance_fetchData();
  this.ZHDEP_eff_performance_processData();
  
  },
  async overflowper() {
    // 使用 selectedArea 作为参数进行 API 调用
    await this.overflow_performance_fetchData();
     this.overflow_performance_processData();
     await this.eff_performance_ppwo();
     await this.eff_stff_OVER_bonus_fetchData();
     await this.DEP_eff_OVERFLOW_fetchData();
     this.DEP_eff_OVERFLOE_processData();
     await this.QCDEP_eff_OVERFLOW_fetchData();
     this.QCDEP_eff_OVERFLOE_processData();
     await this.CNDEP_eff_OVERFLOW_fetchData();
     this.CNDEP_eff_OVERFLOE_processData();
  },
  processData(data) {
    // 处理和分组数据的逻辑
    // ...
  },
  calculateTotaleff(group, type) {
    return Object.values(group).reduce((total, monthData) => total + (monthData[type] || 0), 0);
  },
    woselect() {
      this.loading = true;
      this.secondResult = [];
    axios.get('http://192.168.209.18:5088/api/READWOID/part_list', {
        params: {
            part: this.selectedpart
        }
    })
    .then(response => {
        console.log('API response:', response.data); // 調試信息
  
        this.secondResult = response.data.result || [];
        this.loading = false;
        // 假设 response.data.result 是一个数组，你可以选择第一个元素的 ItemDesc 或其他逻辑
        if (this.secondResult.length > 0) {
            this.selectedItemDesc = this.secondResult[0].ItemDesc;
            this.selectedItemNum = this.secondResult[0].ItemNum;
        } else {
            this.selectedItemDesc = '';
            this.selectedItemNum = '';
        }
        this.loading = false;
        this.generateCharts();
    })
    .catch(error => {
      this.loading = false;
        console.error('API call failed: ', error);
        this.secondResult = [];
        this.selectedItemDesc = '';
        this.selectedItemNum = '';
    });
  },
  generateCharts() {
    // 如果存在旧的图表实例，则销毁它
    if (this.chartInstance) {
        this.chartInstance.destroy();
        this.chartInstance = null; // 确保旧实例已被销毁
    }
  
    // 反向排序副本
    const data = this.secondResult.slice().reverse();
    const labels = data.map(item => item.WONum);
    const effData = data.map(item => item.eff);
    const womoneyData = data.map(item => {
  // 判断 womoney 是否为 null 或者是一个空对象
  if (item.womoney !== null && typeof item.womoney === 'number') {
    return item.womoney;
  } else {
    return 0; // 如果为空值，则返回 0
  }
  });
  
  
    // 绘制混合图表
    const mixedCtx = document.getElementById('mixedChart').getContext('2d');
    this.chartInstance = new Chart(mixedCtx, {
        type: 'bar', // 主图表类型设为柱状图
        data: {
            labels: labels,
            datasets: [
                {
                    label: '人時差異(含製費)',
                    data: womoneyData,
                    backgroundColor: 'rgba(255, 99, 132, 0.7)',
                    borderColor: 'rgba(255, 99, 132,  0.7)',
                    borderWidth: 1,
                    type: 'bar', // 数据集类型为柱状图
                    yAxisID: 'y1' // 指定使用右侧 y 轴
                },
                {
                    label: '效率 ',
                    data: effData,
                    borderColor: 'rgba(25, 101, 0,  0.7)',
                    backgroundColor: 'rgba(25, 101, 0, 0.7)',
                    type: 'line', // 数据集类型为折线图
                    yAxisID: 'y2' // 指定使用左侧 y 轴
                }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: true },
                tooltip: {
                    callbacks: {
                        label: function(tooltipItem) {
                            return `${tooltipItem.dataset.label}: ${tooltipItem.raw}`;
                        }
                    }
                }
            },
            scales: {
                x: {
                    beginAtZero: true
                },
                y1: {
                    beginAtZero: true,
                    position: 'left',
                    title: {
                        display: true,
                        text: '人時差異(含製費)'
                    }
                },
                y2: {
                    beginAtZero: true,
                    position: 'right',
                    title: {
                        display: true,
                        text: '效率'
                    },
                    ticks: {
                        color: 'rgba(75, 192, 192, 1)' // 将折线图的 y 轴刻度标记颜色设置为折线图的颜色
                    }
                }
            }
        }
    });
  },
  
                selectwo(woid) {
                    axios.get('http://192.168.209.18:5088/api/READWOID/combined_data', {
                        params: {
                          wo_id: woid
                        }
                    })
                    .then(response => {
                        console.log('API response:', response.data); // 調試信息
                        if (response.data.firstResult && response.data.firstResult.length > 0) {
                            this.processFirstResult(response.data.firstResult);
                        } else {
                            this.firstResult = [];
                        }
                        this.firstResult = response.data.firstResult || [];
                    })
                    .catch(error => {
                        console.error('API call failed: ', error);
                        this.firstResult = [];
  
                    });
                },
                processFirstResult(data) {
                    // 獲取所有動態列（MFG_DAY）
                    this.dynamicHeaders = Object.keys(data[0]).filter(key => key !== '生產部門' && key !== '工作內容');
                    
                    // 將數據存儲在 firstResult 中
                    this.firstResult = data;
                },
                calculateRowTotal(row) {
                    // 計算每行的總和
                    return this.dynamicHeaders.reduce((total, day) => {
                        const value = row[day]*1;
                        return total + (value  ? parseFloat(value) : 0);
                    }, 0);
                },
                calculateColumnTotal(day) {
                    // 計算每列的總和
                    return this.firstResult.reduce((total, row) => {
                        const value = row[day]*1;
                        return total + (value ? parseFloat(value) : 0);
                    }, 0);
                },
                calculateGrandTotal() {
                    // 計算所有列的總和
                    return this.dynamicHeaders.reduce((grandTotal, day) => {
                        return grandTotal + this.calculateColumnTotal(day);
                    }, 0);
                },
    fetchAttendanceData(jobNumber, name) {
      const date = new Date(this.selectedDate);
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    const formattedDate = `${year}${month}${day}`;
      const apiUrl = `http://192.168.209.18:5088/api/Attendance/ATT_RAWDATA?MFG_DAY=${formattedDate}&JOB_NUMBER=${jobNumber}`;
      fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
          this.attendanceData = data;
          this.selectedJobNumber = jobNumber;
          this.selectedName = name;
        })
        .catch(error => {
          console.error('Error fetching attendance data:', error);
        });
    },
    toggleSettings() {
      this.settingsOpen = !this.settingsOpen; // 切换设置的展开状态
    },
    toggleperformance () {
      this.performance = !this.performance; // 切换设置的展开状态
    },
    toggleSelectAll() {
      this.ATT_time_ADJ_data.forEach(item => {
        item.selected = this.selectAll;
      });
    },
    toggleWOSelectAll() {
        this.WO_SUM_VERSON.forEach(item => {
            this.$set(this.showInSecondTable, item.部門, this.WOselectAll);
        });
        const trueKeys = Object.keys(this.showInSecondTable)
  .filter(key => this.showInSecondTable[key])
  .sort((a, b) => a - b);
  
  trueKeys.forEach(trueKey => {
  this.WOVERSON = [];
  this.WOVER(trueKey);
  });
  
    },
    toggleRATINGSelectAll() {
        this.RATING_SUM_VERSON.forEach(item => {
            this.$set(this.showInSecondTable, item.部門, this.WOselectAll);
        });
        const trueKeys = Object.keys(this.showInSecondTable)
  .filter(key => this.showInSecondTable[key])
  .sort((a, b) => a - b);
  
  trueKeys.forEach(trueKey => {
  this.RATINGVERSON = [];
  this.RATINGVER(trueKey);
  });
  
    },
    toggleATTSelectAll() {
        this.ATT_time_SUM_data.forEach(item => {
            this.$set(this.showInSecondTable, item.部門, this.WOselectAll);
        });
  
  const trueKeys = Object.keys(this.showInSecondTable)
  .filter(key => this.showInSecondTable[key])
  .sort((a, b) => a - b);
  
  trueKeys.forEach(trueKey => {
  this.att_hr_data(trueKey);
  });
    },
    async executeSelected() {
      this.loading = true;
      this.isButtonDisabled = true;
  const selectedItems = this.ATT_time_ADJ_data.filter(item => item.selected);
  try {
    for (const item of selectedItems) {
      const UPDATEData = {
        mfG_DAY: item.mfG_DAY,
        area: item.area,
        department: item.department,
        jobnumber: item.jobnumber,
        ADJTIME: item.adj_time,
        floW_ID: "NFC",
      };
  
      await axios.post('http://192.168.209.18:5088/api/Attendance/UPDATE_ADJS', UPDATEData, {
        headers: {
          'Content-Type': 'application/json'
        }
      });
    }
  
    alert(this.translatedText.更新完成);
    this.isButtonDisabled = false;
    this.loading = false;
    this.att_hr_SUM_ADJ();
  } catch (error) {
    console.error('更新失敗', error);
  }
  },
  
    calculateTotalDifference() {
  
      return this.WO_SUM_VERSON.reduce((total, item) => {
        const difference = item.回報工時 - (item.執行工時 * 1 + item.狀態工時 * 1 + item.狀態工時2 * 1 + item.殘疾人 * 1 + (item.未設定工單 - item.殘疾人 * 1) + item.無效工時 * 1 + item.借出工時 * 1 - item.借入工時 * 1 + item.調整工時 * 1);
        if (this.showInSecondTable[item.部門]) {
        return total + difference;
        }else{
  
          return total;
        }
      }, 0);
    },
    show_ADJ() {
      this.showADJs = true;
  
    },
    show_ADJ_CANCEL() {
      this.showADJs = false;
  
    },
    CHECK_WOADJ() {
      let totalAdjustment = this.WOVERSON.reduce((sum, item) => {
        return parseFloat((sum + parseFloat(item.ADJ || 0)).toFixed(2));
      }, 0);
  
      if (totalAdjustment !== 0) {
        alert('調整欄位數字相加必須為0');
        console.log('Success:', totalAdjustment);
      } else {
        alert('調整正確');
        
        let adjustedItems = this.WOVERSON.filter(item => item.ADJ && item.ADJ != 0);
        
        adjustedItems.forEach(item => {
          let payload = {
            AREA: item.廠區, // Replace with actual value if needed
            MFG_DAY: item.日期,  // Replace with actual value if needed
            WO_DEPARTMENT: item.工單部門,
            wo_id: item.工單,
            part_desc: item.品名,
            Qty: item.數量,
            std_time: item.標準工時,
            working_hours: item.ADJ
          };
          console.log('更新成功', payload);
          axios.post('http://192.168.209.18:5088/api/Report/ADG_WO_TIME', payload)
            .then(response => {
              console.log('Success:', response);
              this.WO_SUM_VER();
            })
            .catch(error => {
              console.error('Error:', error);
            });
        });
  
      }
      this.showADJs = false;
    },
       ADJ_CONFIRM_ET(item) {
      const UPDATEData = {
  mfG_DAY:item.mfG_DAY,
  area: item.area,
  department: item.department,
  jobnumber:item.jobnumber,
  ADJTIME:item.adj_time,
  };
  axios.post('http://192.168.209.18:5088/api/Attendance/UPDATE_ADJS', UPDATEData, {
  headers: {
    'Content-Type': 'application/json'
  }
  })
  .then(response => {
  // Handle successful response here
  if (response.status === 200) {
  
  
  } else {
  
  }
  
  })
  .catch(error => {
  // Handle other errors here
  
  });
    },
  
    showAdjustmentDialog(item) {
      this.currentItem = item;
      this.showDialog = true;
    },
    closeDialog() {
      this.showDialog = false;
    },
    applyAdjustment() {
      if (this.currentItem) {
        // Apply the adjustment logic here
        console.log(`Adjusted ${this.adjustmentValue} for ${this.currentItem.工號}`);
        console.log(`Job Order: ${this.selectedreson}`);
        console.log(`DATE: ${this.selectedDate}`);
        console.log(`AREA: ${this.selectedArea}`);
        
  const UPDATEData = {
  area: this.selectedArea,
  mfG_DAY:this.selectedDate,
  jobnumber:this.currentItem.工號,
  adjtime: this.adjustmentValue,
  reson:this.selectedreson,
  };
  //axios.post('https://localhost:5001/api/Attendance/ADJTIMES', UPDATEData, {
  
  axios.post('http://192.168.209.18:5088/api/Attendance/ADJTIMES', UPDATEData, {
  headers: {
    'Content-Type': 'application/json'
  }
  })
  .then(response => {
  // Handle successful response here
  if (response.status === 200) {
    console.log('更新成功', response.status);
    alert(this.translatedText.更新完成);
   
  } else {
    console.log('更新成功 (但是收到了 400 錯誤)', response);
  }
  
  })
  .catch(error => {
  // Handle other errors here
  if (error.response.status === 400 && error.response.data === "No data found to delete.") {
    // 如果错误消息是 "No data found to delete"，则继续执行 this.insert
    console.log('更新成功', error.response.status);
    alert(this.translatedText.更新完成);
   
  }
  alert(this.translatedText.更新完成);
   
  });
  
  
      }
      this.att_hr_SUM_data();
      this.closeDialog();
    },
    submitCARD_Form() {
    // 构造要发送的数据对象
    const formData = {
      area: this.selectedArea, // 如果您的表单中有区域相关的数据，请将其填充在这里
      department: this.machine_card[0].department,
      jO_NUMBER: this.machine_card[0].job_number,
      username: this.machine_card[0].username,
      nfC_ID: this.machine_card[0].nfC_ID,
      code: this.machine_card[0].code
    };
  
    // 发送 POST 请求到指定的 API
    fetch("http://192.168.209.18:5088/api/c_CARD/updatecard", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(formData)
    })
    .then(response => {
      // 处理响应
      if (response.ok) {
        // 成功发送数据
        console.log("表单数据已成功提交");
        alert(this.translatedText.更新完成);
        // 可以在这里执行其他操作，例如显示成功消息
      } else {
        // 发生错误
        console.error("表单数据提交失败");
        alert(this.translatedText.更新失敗);
        // 可以在这里执行其他操作，例如显示错误消息
      }
    })
    .catch(error => {
      // 捕获网络错误
      console.error("网络错误:", error);
      // 可以在这里执行其他操作，例如显示网络错误消息
    });
  },
    CAEDoptions_change(event) {
    const selectedUsername = event.target.value;
    const selectedOption = this.CAEDoptions.find(option => option.username === selectedUsername);
    if (selectedOption) {
      this.machine_card[0].job_number = selectedOption.jobnumber;
    }
  },
     fetchOptions() {
      this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
      axios.post('http://192.168.209.18:5088/api/c_CARD/SELECT', {
         area: this.selectedArea,
         department:this.selectedDepartment,
  
  
  })
  .then(response => {
  // POST請求成功，將數據賦值給seatData
  //this.ATT_time_data = this.ATT_time_data.concat(response.data);
  this.CAEDoptions= response.data;
  
  console.log('值.',this.CAEDoptions);
  })
  .catch(error => {
  // POST請求失敗，輸出錯誤信息
  console.error('Error posting data:', error);
  });
  
  
    },
    shift_data (){
  
      this.loading = true;
       if (!this.selectedArea && !this.selectedDate) {
       this.loading = false;
      return; // 如果没有选择区域，直接返回
        }
      axios.post('http://192.168.209.18:5088/api/c_shift', {
         area: this.selectedArea,
  
  })
  .then(response => {
  // POST請求成功，將數據賦值給seatData
  //this.ATT_time_data = this.ATT_time_data.concat(response.data);
  this.shiftdata= response.data;
  })
  .catch(error => {
  // POST請求失敗，輸出錯誤信息
  console.error('Error posting data:', error);
  this.shiftdata=[];
  
  });
  
  this.loading = false;
  
    },
    selectMachine(){
     // this.ATT_time_data=[];
     this.loading = true;
       if (!this.selectedArea && !this.selectedDate) {
       this.loading = false;
      return; // 如果没有选择区域，直接返回
        }
        if (this.selectedL) {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + '-' + this.selectedL + 'C';
  } else {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
  }
  
        axios.post('http://192.168.209.18:5088/api/c_CARD', {
         area: this.selectedArea,
         department:this.selectedDepartment,
         machine:this.selectedmachine,
  
  })
  .then(response => {
  // POST請求成功，將數據賦值給seatData
  //this.ATT_time_data = this.ATT_time_data.concat(response.data);
  this.machine_card= response.data;
  this.machine_card[0].department=this.selectedDepartment
  console.log('值.',this.machine_card);
  })
  .catch(error => {
  // POST請求失敗，輸出錯誤信息
  console.error('Error posting data:', error);
  this.machine_card=[];
  alert(this.translatedText.查無卡號);
  });
  
  this.loading = false;
  this.fetchOptions();
  
  
    },
    calculateTotal_hrsum(column) {
      return this.ATT_time_SUM_data.reduce((total, item) => {
        if (this.showInSecondTable[item.部門]) {
          return total + parseFloat(item[column] || 0);
        } else {
          return total;
        }
      }, 0);
    },
    calculateTotal_wosum(column) {
      return this.WO_SUM_VERSON.reduce((total, item) => {
        if (this.showInSecondTable[item.部門]) {
          return total + parseFloat(item[column] || 0);
        } else {
          return total;
        }
      }, 0);
    },
    checkDuplicate(inputValue,inputField,item) {
      console.log('值.',inputValue);
      
            // 检查输入值是否存在于 hostMachine.MACHIN 中
            const isDuplicate = this.hostMachine.some(machine => machine.Machine === inputValue);
  
  
            if (isDuplicate) {
                // 如果存在，将输入值重置为 '0000'
                alert(this.translatedText.重複輸入);
                this.newSeat[inputField] = '0000';
            }else{
              const newSeatS = {
                 Machine: inputValue,
                 HOSTID: this.hostMachine[0].HOSTID
                 };
                this.hostMachine.push(newSeatS);
            }
        
    },
    checkDuplicate2(inputValue,inputField,item) {
      console.log('值.',inputValue);
      
            // 检查输入值是否存在于 hostMachine.MACHIN 中
            const isDuplicate = this.hostMachine.some(machine => machine.Machine === inputValue);
  
  
            if (isDuplicate) {
                // 如果存在，将输入值重置为 '0000'
                alert(this.translatedText.重複輸入);
           
                item[inputField] = '0000';
            }else{
              const newSeatS = {
                 Machine: inputValue,
                 HOSTID: this.hostMachine[0].HOSTID
                 };
                this.hostMachine.push(newSeatS);
            }
        
    },
    async completeSeat() {
  if (this.selectedL) {
    this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + '-' + this.selectedL + 'C';
  } else {
    this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
  }
  
  if (this.selectedD && this.selectedS && this.selectedC) {
    try {
  // 删除座位数据
  await this.DELETESEAT();
  
  // 插入座位数据
  
  
  // 更新座位数据
  // await this.UPDATESEAT();
  
  console.log('All operations completed successfully.');
  } catch (error) {
  console.error('Error during operations:', error);
  }
  
  }
  
  },
  RESET(){
  const UPDATEData = {
  area: this.selectedArea,
  department: this.selectedDepartment,
  };
  
  axios.post('http://192.168.209.18:5088/api/ONLINE/RESET', UPDATEData, {
  headers: {
    'Content-Type': 'application/json'
  }
  })
  .then(response => {
  // Handle successful response here
  if (response.status === 200) {
    console.log('更新成功', response.status);
    alert(this.translatedText.更新完成);
   
  } else {
    console.log('更新成功 (但是收到了 400 錯誤)', response);
  }
  this.fetchData();
  })
  .catch(error => {
  // Handle other errors here
  if (error.response.status === 400 && error.response.data === "No data found to delete.") {
    // 如果错误消息是 "No data found to delete"，则继续执行 this.insert
    console.log('更新成功', error.response.status);
    alert(this.translatedText.更新完成);
   
  }
  alert(this.translatedText.更新完成);
   
  });
  
  },
  async insertseat2(){
  
  try {
  const uploadDataArray = this.seatData.map(item => ({
    area: this.selectedArea,
    department: this.selectedDepartment,
    machine_L: item.machine_L,
    work_content_L: item.work_content_L ? item.work_content_L.toString() : "",
    work_content_id_L: "123",
    seat_ID: item.seatID.toString(),
    machine_R: item.machine_R,
    work_content_R: item.work_content_R ? item.work_content_R.toString() : "",
    work_content_id_R: "123",
    host_id: this.hostMachine[0].HOSTID, // 修改为适当的变量名
  }));
  
  // 批量上传数据
  const responses = await Promise.all(uploadDataArray.map(async uploadData => {
    try {
      const response = await fetch('http://192.168.209.18:5088/api/c_seat/INSERT', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(uploadData),
      });
  
      // 检查 HTTP 状态码
      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }
  
      // 处理响应
      const contentType = response.headers.get('Content-Type');
      if (contentType && contentType.includes('application/json')) {
        const result = await response.json();
        console.log('Upload result:', result);
        console.log('Success Message:', result.successMessage);
        return result; // 返回结果以便进一步处理
      } else {
        const resultText = await response.text();
        console.log('Success Message:', resultText);
        return resultText; // 返回结果以便进一步处理
      }
    } catch (error) {
      console.error('Error uploading data:', uploadData);
      throw error; // 重新抛出错误以便外部处理
    }
  }));
  
  // 处理成功上传的结果
  console.log('All uploads successful:', responses);
  this.UPDATESEAT();
  // 更新座位数据（如果需要）
  } catch (error) {
  console.error('Error during upload:', error);
  }
  
  
  
  },
  UPDATESEAT(){
  const UPDATEData = {
  area: this.selectedArea,
  department: this.selectedDepartment,
  };
  
  axios.post('http://192.168.209.18:5088/api/c_seat/updateseat', UPDATEData, {
  headers: {
    'Content-Type': 'application/json'
  }
  })
  .then(response => {
  // Handle successful response here
  if (response.status === 200) {
    console.log('更新成功', response.status);
    alert(this.translatedText.更新完成);
   
     this.seatData = [];
     this.seateditMode = false;
     this.postData();
  } else {
    console.log('更新成功 (但是收到了 400 錯誤)', response);
  }
  
  })
  .catch(error => {
  // Handle other errors here
  if (error.response.status === 400 && error.response.data === "No data found to delete.") {
    // 如果错误消息是 "No data found to delete"，则继续执行 this.insert
    console.log('更新成功', error.response.status);
    alert(this.translatedText.更新完成);
   
     this.seatData = [];
     this.seateditMode = false;
     this.postData();
  }
  alert(this.translatedText.更新完成);
   
   this.seatData = [];
   this.seateditMode = false;
   this.postData();
  });
  
  },
  
  DELETESEAT(){
  // 構建 DELETE 請求的主體
  const deleteData = {
  
  area: this.selectedArea,
  department: this.selectedDepartment,
  }
  console.log('DEPARTMENT', deleteData);
  axios.delete('http://192.168.209.18:5088/api/c_seat/DELETE', {
    data: deleteData,
    headers: {
      'Content-Type': 'application/json'
    }
  })
    .then(response => {
      // Handle successful response here
      if (response.status === 400) {
        console.log('刪除成功 (但是收到了 400 錯誤)', response);
      } else {
        console.log('有資料刪除成功', response.status);
      }
      this.seateditMode = false;
       this.insertseat2();
  
    })
    .catch(error => {
      // Handle other errors here
      console.error('刪除失敗', error.response.data);
      if (error.response.data === "No data found to delete.") {
        // 如果错误消息是 "No data found to delete"，则继续执行 this.insert
        console.log('無資料刪除成功', error.response.status);
        this.insertseat2();
      
      }
    });
  
  
    },
    addSeat() {
      this.showseatForm=true;
   
  },
  inputseat(){
    console.log('刪除成功', this.newSeat.seatID);
    const newSeatS = {
      seatID: this.newSeat.seatID, // 座位号需要转换为字符串类型
      machine_L: this.newSeat.machine_L,
      work_content_L: this.newSeat.work_content_L,
      work_content_R: this.newSeat.work_content_R,
      machine_R: this.newSeat.machine_R,
  
      
    };
  
    this.seatData.push(newSeatS); // 将新座位添加到 seatData 数组中
    this.seatData.forEach(item => {
        item.editMode = true;
      });
      this.seatData.sort((a, b) => a.seatID - b.seatID);
      this.seatData.sort((a, b) => {
    if (a.seatID === b.seatID) {
        return b.seatID - a.seatID; // 如果 property1 相等，则按照 property2 进行排序
    } else {
        return  a.seatID -b.seatID ; // 否则，按照 property1 进行排序
    }
  });
  // Reassign new seatIDs
  this.seatData = this.seatData.map((item, index) => {
    item.seatID = index + 1;
    return item;
  });
  this.showseatForm=false;
  this.newSeat.machine_L='0000';
  this.newSeat.machine_R='0000';
  },
  removeSeat(){
    this.showActions = true;
  },
  DELETESEATtb(index){
  
  
    if (index !== -1) {
        // 如果找到具有特定行号的座位对象，则删除它
        this.seatData.splice(index, 1);
    }
    
    this.showActions = false;
    this.seatData = this.seatData.map((item, index) => {
    item.seatID = index + 1;
    return item;
  });
  },
    // 删除行     this.seatData.splice(newValue, diff); // 修改这行
  
  
    enableseatEditMode() {
      this.seatData.forEach(item => {
        item.editMode = true;
  
      });
      this.seateditMode = true;
    },
    canceseatlEdit() {
      this.showActions = false;
      // 取消编辑时，将所有项目的 editMode 属性设置为 false
      this.seatData.forEach(item => {
        item.editMode = false;
  
      });
      this.seateditMode = false;
      this.postData();
    },
    formattedDate: function() {
  if (this.selectedDate) {
    const date = new Date(this.selectedDate);
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    const formattedDate = `${year}${month}${day}`;
    
    // 在這裡調用函數
  
    
    return formattedDate;
  } else {
    return '';
  }
  },    calculateDepartment_WOTotal(field, department) {
  let total = 0;
  for (const item of this.WOVERSON) {
    if (item.部門 === department && !isNaN(parseFloat(item[field]))) {
      total += parseFloat(item[field]);
    }
  }
  return total;
  },
  
    calculateDepartmentTotal(field, department) {
  let total = 0;
  for (const item of this.ATT_time_data) {
    if (item.部門 === department && !isNaN(parseFloat(item[field]))) {
      total += parseFloat(item[field]);
    }
  }
  return total;
  },
  calculateExcessHoursTotal(department) {
    let totalExcessHours = 0;
    for (const item of this.ATT_time_data) {
      if (item.部門 === department && !isNaN(parseFloat(item.考勤工時)) && ((item.考勤工時*1)+(item.調整工時*1)+(item.手動調整工時*1)) >= 8) {
        totalExcessHours +=  8 ;
      }else if (item.部門 === department &&  !isNaN(parseFloat(item.考勤工時)) && ((item.考勤工時*1)+(item.調整工時*1)+(item.手動調整工時*1))< 8) {
  
        totalExcessHours += parseFloat(((item.考勤工時*1)+(item.調整工時*1)+(item.手動調整工時*1))) ;
  
      }else if (item.部門 === department &&  item.假別 === '年休' ) {
  
     totalExcessHours += parseFloat(((item.調整工時*1))) ;
  
  }else{
  
        totalExcessHours +=0;
      }
    }
    return totalExcessHours;
  },
  
    validateInput( item) {
   console.log('n', item.FQC);
  console.log(' o:', item.OLDFQC);
  
      if (item.FQC < item.OLDFQC) {
      item.inputError = true;
      item.FQC=item.OLDFQC; // 更新原始值
    } else if (item.FQC > item.qty) {
      item.inputError2 = true;
      item.FQC=item.OLDFQC; // 更新原始值
      }else{
      item.inputError = false;
      item.inputError2 = false;
    }
    // 其他驗證邏輯，比如檢查是否大於工單數量，可以在這裡進行
  },
  async downloadExcelWOPER() {
  // 引入库
  const dataRows = Array.from(document.querySelectorAll('#WOPET2 tbody tr'));
      this.ATTSUMdata = dataRows.map(row => {
        const cells = row.querySelectorAll('td');
  
        return {
          班別代號: cells[0]?.innerText,
          M1標準工時:parseFloat(parseFloat(cells[1]?.innerText || '0').toFixed(2)),
          M1實際工時:parseFloat(cells[2]?.innerText.trim()).toFixed(2) || 0,
          M1效率: parseFloat(cells[3]?.innerText.trim()).toFixed(2) || 0,
          M2標準工時:parseFloat(cells[4]?.innerText.trim()).toFixed(2) || 0,
          M2實際工時:parseFloat(cells[5]?.innerText.trim()).toFixed(2) || 0,
          M2效率:parseFloat(cells[6]?.innerText.trim()).toFixed(2) || 0,
          M3標準工時:parseFloat(cells[7]?.innerText.trim()).toFixed(2) || 0,
          M3實際工時:parseFloat(cells[8]?.innerText.trim()).toFixed(2) || 0,
          M3效率:parseFloat(cells[9]?.innerText.trim()).toFixed(2) || 0,
          累計負值效率:cells[10]?.innerText,
          效率上升率:cells[11]?.innerText,
          最終考核效率:cells[12]?.innerText,
          當月考績:	cells[13]?.innerText,			
          額外獎勵:	cells[14]?.innerText,			
          下月累計負值效率:	cells[15]?.innerText,			
          // 其他需要保存的資料也在這裡處理
        };
      });
      const dataRows6 = Array.from(document.querySelectorAll('#WOPET3 tbody tr'));
      this.ATTSUMdata6 = dataRows6.map(row => {
        const cells6 = row.querySelectorAll('td');
  
        return {
          班別代號: cells6[0]?.innerText,
          M1標準工時:parseFloat(parseFloat(cells6[1]?.innerText || '0').toFixed(2)),
          M1實際工時:parseFloat(cells6[2]?.innerText.trim()).toFixed(2) || 0,
          M1效率: parseFloat(cells6[3]?.innerText.trim()).toFixed(2) || 0,
          M2標準工時:parseFloat(cells6[4]?.innerText.trim()).toFixed(2) || 0,
          M2實際工時:parseFloat(cells6[5]?.innerText.trim()).toFixed(2) || 0,
          M2效率:parseFloat(cells6[6]?.innerText.trim()).toFixed(2) || 0,
          M3標準工時:parseFloat(cells6[7]?.innerText.trim()).toFixed(2) || 0,
          M3實際工時:parseFloat(cells6[8]?.innerText.trim()).toFixed(2) || 0,
          M3效率:parseFloat(cells6[9]?.innerText.trim()).toFixed(2) || 0,
          累計負值效率:cells6[10]?.innerText,
          效率上升率:cells6[11]?.innerText,
          最終考核效率:cells6[12]?.innerText,
          當月考績:	cells6[13]?.innerText,			
          額外獎勵:	cells6[14]?.innerText,			
          下月累計負值效率:	cells6[15]?.innerText,			
          // 其他需要保存的資料也在這裡處理
        };
      });
      const dataRows2 = Array.from(document.querySelectorAll('#PPWO tbody tr'));
      this.ATTSUMdata2 = dataRows2.map(row => {
        const cells2 = row.querySelectorAll('td');
  
        return {
          工單: cells2[0]?.innerText,
          班別代號:cells2[1]?.innerText,
          料號:cells2[2]?.innerText,
          數量:cells2[3]?.innerText,
          標準工時:parseFloat(parseFloat(cells2[4]?.innerText || '0').toFixed(2)),
          實際工時:parseFloat(parseFloat(cells2[5]?.innerText|| '0').toFixed(2)),
  
          // 其他需要保存的資料也在這裡處理
  
        };
      });
      const dataRows3 = Array.from(document.querySelectorAll('#stffbonus tbody tr'));
      this.ATTSUMdata3 = dataRows3.map(row => {
        const cells3 = row.querySelectorAll('td');
  
        return {
          班別代號: cells3[0].innerText|| '',
          工號:cells3[1].innerText|| '',
          姓名:cells3[2]?.innerText|| '',
          工作天數:cells3[3]?.innerText|| '',
          請假天數:cells3[4]?.innerText|| '',
          崗位:cells3[5]?.innerText|| '',
          績效等級I:cells3[6]?.innerText|| '',
          獎金I:cells3[7]?.innerText|| '',
          績效等級II:cells3[8]?.innerText|| '',
          獎金II:cells3[9]?.innerText|| '',
          最終獎金:cells3[10]?.innerText|| '',
        };
      });
      const dataRows4 = Array.from(document.querySelectorAll('#DEPPER tbody tr'));
      this.ATTSUMdata4 = dataRows4.map(row => {
        const cells4 = row.querySelectorAll('td');
  
        return {
          管理部門: cells4[0]?.innerText,
          管理班別:cells4[1]?.innerText,
          工號:cells4[2]?.innerText,
          姓名: cells4[3]?.innerText,
          上班天數:cells4[4]?.innerText,
          職稱:cells4[5]?.innerText,
          M1效率:parseFloat(cells4[6]?.innerText.trim()).toFixed(2) || 0,
          M2效率:parseFloat(cells4[7]?.innerText.trim()).toFixed(2) || 0,
          M3效率:parseFloat(cells4[8]?.innerText.trim()).toFixed(2) || 0,
          累計負值效率:cells4[9]?.innerText,
          效率上升率:cells4[10]?.innerText,
          最終考核效率:cells4[11]?.innerText,
          當月考績:cells4[12]?.innerText,
          額外獎勵:cells4[13]?.innerText,
          考績獎金:cells4[14]?.innerText,	
          額外考績獎金:cells4[15]?.innerText,
          A15拉管理福利金:cells4[16]?.innerText,
          最終獎金:cells4[17]?.innerText,
          下月累計負值效率:cells4[18]?.innerText,
          // 其他需要保存的資料也在這裡處理
        };
      });
      const dataRows5 = Array.from(document.querySelectorAll('#QCDEPPER tbody tr'));
      this.ATTSUMdata5 = dataRows5.map(row => {
        const cells5 = row.querySelectorAll('td');
  
        return {
          管理部門: cells5[0]?.innerText,
          管理班別:cells5[1]?.innerText,
          工號:cells5[2]?.innerText,
          姓名: cells5[3]?.innerText,
          職稱:cells5[4]?.innerText,
          M1效率:parseFloat(cells5[5]?.innerText.trim()).toFixed(2) || 0,
          M2效率:parseFloat(cells5[6]?.innerText.trim()).toFixed(2) || 0,
          M3效率:parseFloat(cells5[7]?.innerText.trim()).toFixed(2) || 0,
          累計負值效率:cells5[8]?.innerText,
          效率上升率:cells5[9]?.innerText,
          最終考核效率:cells5[10]?.innerText,
          當月考績:cells5[11]?.innerText,
          額外獎勵:cells5[12]?.innerText,
          考績獎金:cells5[13]?.innerText,	
          額外考績獎金:cells5[14]?.innerText,
          A15拉管理福利金:cells5[15]?.innerText,
          最終獎金:cells5[16]?.innerText,
          下月累計負值效率:cells5[17]?.innerText,
          // 其他需要保存的資料也在這裡處理
        };
      });
      const dataRows7 = Array.from(document.querySelectorAll('#ZHDEPPER tbody tr'));
      this.ATTSUMdata7 = dataRows7.map(row => {
        const cells7 = row.querySelectorAll('td');
  
        return {
          管理部門: cells7[0]?.innerText,
          管理班別:cells7[1]?.innerText,
          工號:cells7[2]?.innerText,
          姓名: cells7[3]?.innerText,
          職稱:cells7[4]?.innerText,
          M1效率:parseFloat(cells7[5]?.innerText.trim()).toFixed(2) || 0,
          M2效率:parseFloat(cells7[6]?.innerText.trim()).toFixed(2) || 0,
          M3效率:parseFloat(cells7[7]?.innerText.trim()).toFixed(2) || 0,
          累計負值效率:cells7[8]?.innerText,
          效率上升率:cells7[9]?.innerText,
          最終考核效率:cells7[10]?.innerText,
          當月考績:cells7[11]?.innerText,
          額外獎勵:cells7[12]?.innerText,
          考績獎金:cells7[13]?.innerText,	
          額外考績獎金:cells7[14]?.innerText,
          A15拉管理福利金:cells7[15]?.innerText,
          最終獎金:cells7[16]?.innerText,
          下月累計負值效率:cells7[17]?.innerText,
          // 其他需要保存的資料也在這裡處理
        };
      });
      const dataRows8 = Array.from(document.querySelectorAll('#eff120 tbody tr'));
      this.ATTSUMdata8 = dataRows8.map(row => {
        const cells8 = row.querySelectorAll('td');
  
        return {
          班別代號:cells8[0]?.innerText,
          料號:cells8[1]?.innerText,
          客戶料號:cells8[2]?.innerText,
          工單數量: cells8[3]?.innerText,     
          數量:cells8[4]?.innerText,
          標準工時:parseFloat(parseFloat(cells8[5]?.innerText || '0').toFixed(2)),
          實際工時:parseFloat(parseFloat(cells8[6]?.innerText|| '0').toFixed(2)),
          效率:parseFloat(parseFloat(cells8[7]?.innerText|| '0').toFixed(2)),
          // 其他需要保存的資料也在這裡處理
          建議調整標準工時:cells8[8]?.innerText,
        };
      });
    
    
    
      const PERData = {
            MFG_DAY: '2024/10',
            wopet: this.ATTSUMdata,
            PPWO: this.ATTSUMdata2,
            stffbonus:this.ATTSUMdata3,
            DEPPER:this.ATTSUMdata4,
            QCDEPPER:this.ATTSUMdata5,
            wopet3: this.ATTSUMdata6,
            ZHDEPPER:this.ATTSUMdata7,
            EFF120:this.ATTSUMdata8,
          };
  
          axios.post('https://localhost:5001/api/PWEWOTableToExcel/to-excel', PERData, { responseType: 'blob' })
          //axios.post('https://localhost:5001/api/PWEWOTableToExcel/to-pdf', PERData, { responseType: 'blob' })
         // axios.post('https://localhost:5001/api/TableToExcel/to-excel', combinedData, { responseType: 'blob' })
            .then(response => {
              const blob = new Blob([response.data], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
              const link = document.createElement('a');
              link.href = window.URL.createObjectURL(blob);
              link.download =  '月效率考核表 Mẫu đánh giá hiệu quả hàng tháng .xlsx';
              link.click();
            })
            .catch(error => {
              console.error('Error exporting to Excel:', error);
            });
  },
  
  async downloadExcelWOOVER() {
  // 引入库
  const dataRows = Array.from(document.querySelectorAll('#WOOEVER2 tbody tr'));
      this.ATTSUMdata = dataRows.map(row => {
        const cells = row.querySelectorAll('td');
  
        return {
          班別代號: cells[0]?.innerText,
          M1標準工時:parseFloat(parseFloat(cells[1]?.innerText || '0').toFixed(2)),
          M1實際工時:parseFloat(cells[2]?.innerText.trim()).toFixed(2) || 0,
          M1效率: parseFloat(cells[3]?.innerText.trim()).toFixed(2) || 0,
          M2標準工時:parseFloat(cells[4]?.innerText.trim()).toFixed(2) || 0,
          M2實際工時:parseFloat(cells[5]?.innerText.trim()).toFixed(2) || 0,
          M2效率:parseFloat(cells[6]?.innerText.trim()).toFixed(2) || 0,
          M3標準工時:parseFloat(cells[7]?.innerText.trim()).toFixed(2) || 0,
          M3實際工時:parseFloat(cells[8]?.innerText.trim()).toFixed(2) || 0,
          M3效率:parseFloat(cells[9]?.innerText.trim()).toFixed(2) || 0,
          累計負值效率:cells[10]?.innerText,
          效率上升率:cells[11]?.innerText,
          最終考核效率:cells[12]?.innerText,
          當月考績:	cells[13]?.innerText,			
          額外獎勵:	cells[14]?.innerText,			
          下月累計負值效率:	cells[15]?.innerText,			
          // 其他需要保存的資料也在這裡處理
        };
      });
      const dataRows6 = Array.from(document.querySelectorAll('#WOOEVER3 tbody tr'));
      this.ATTSUMdata6 = dataRows6.map(row => {
        const cells6 = row.querySelectorAll('td');
  
        return {
          班別代號: cells6[0]?.innerText,
          M1標準工時:parseFloat(parseFloat(cells6[1]?.innerText || '0').toFixed(2)),
          M1實際工時:parseFloat(cells6[2]?.innerText.trim()).toFixed(2) || 0,
          M1效率: parseFloat(cells6[3]?.innerText.trim()).toFixed(2) || 0,
          M2標準工時:parseFloat(cells6[4]?.innerText.trim()).toFixed(2) || 0,
          M2實際工時:parseFloat(cells6[5]?.innerText.trim()).toFixed(2) || 0,
          M2效率:parseFloat(cells6[6]?.innerText.trim()).toFixed(2) || 0,
          M3標準工時:parseFloat(cells6[7]?.innerText.trim()).toFixed(2) || 0,
          M3實際工時:parseFloat(cells6[8]?.innerText.trim()).toFixed(2) || 0,
          M3效率:parseFloat(cells6[9]?.innerText.trim()).toFixed(2) || 0,
          累計負值效率:cells6[10]?.innerText,
          效率上升率:cells6[11]?.innerText,
          最終考核效率:cells6[12]?.innerText,
          當月考績:	cells6[13]?.innerText,			
          額外獎勵:	cells6[14]?.innerText,			
          下月累計負值效率:	cells6[15]?.innerText,			
          // 其他需要保存的資料也在這裡處理
        };
      });
      const dataRows2 = Array.from(document.querySelectorAll('#WOPP3 tbody tr'));
      this.ATTSUMdata2 = dataRows2.map(row => {
        const cells2 = row.querySelectorAll('td');
  
        return {
          工單: cells2[0].innerText,
          班別代號:cells2[1].innerText,
          料號:cells2[2].innerText,
          數量:cells2[3].innerText,
          標準工時:parseFloat(parseFloat(cells2[4]?.innerText || '0').toFixed(2)),
          實際工時:parseFloat(parseFloat(cells2[5]?.innerText|| '0').toFixed(2)),
  
          // 其他需要保存的資料也在這裡處理
  
        };
      });
      const dataRows3 = Array.from(document.querySelectorAll('#STAFF_OVERBOUNS tbody tr'));
      this.ATTSUMdata3 = dataRows3.map(row => {
        const cells3 = row.querySelectorAll('td');
  
        return {
          班別代號: cells3[0].innerText|| '',
          工號:cells3[1].innerText|| '',
          姓名:cells3[2]?.innerText|| '',
          工作天數:cells3[3]?.innerText|| '',
          請假天數:cells3[4]?.innerText|| '',
          崗位:cells3[5]?.innerText|| '',
          績效等級I:cells3[6]?.innerText|| '',
          獎金I:cells3[7]?.innerText|| '',
          績效等級II:cells3[8]?.innerText|| '',
          獎金II:cells3[9]?.innerText|| '',
          最終獎金:cells3[10]?.innerText|| '',
        };
      });
      const dataRows4 = Array.from(document.querySelectorAll('#DEPOVER tbody tr'));
      this.ATTSUMdata4 = dataRows4.map(row => {
        const cells4 = row.querySelectorAll('td');
  
        return {
          管理部門: cells4[0]?.innerText,
          管理班別:cells4[1]?.innerText,
          工號:cells4[2]?.innerText,
          姓名: cells4[3]?.innerText,
          上班天數:cells4[4]?.innerText,
          職稱:cells4[5]?.innerText,
          M1效率:parseFloat(cells4[6]?.innerText.trim()).toFixed(2) || 0,
          M2效率:parseFloat(cells4[7]?.innerText.trim()).toFixed(2) || 0,
          M3效率:parseFloat(cells4[8]?.innerText.trim()).toFixed(2) || 0,
          累計負值效率:cells4[9]?.innerText,
          效率上升率:cells4[10]?.innerText,
          最終考核效率:cells4[11]?.innerText,
          當月考績:cells4[12]?.innerText,
          額外獎勵:cells4[13]?.innerText,
          考績獎金:cells4[14]?.innerText,	
          額外考績獎金:cells4[15]?.innerText,
          A15拉管理福利金:cells4[16]?.innerText,
          最終獎金:cells4[17]?.innerText,
          下月累計負值效率:cells4[18]?.innerText,
          // 其他需要保存的資料也在這裡處理
        };
      });
      const dataRows5 = Array.from(document.querySelectorAll('#QCDEPOVER tbody tr'));
      this.ATTSUMdata5 = dataRows5.map(row => {
        const cells5 = row.querySelectorAll('td');
  
        return {
          管理部門: cells5[0]?.innerText,
          管理班別:cells5[1]?.innerText,
          工號:cells5[2]?.innerText,
          姓名: cells5[3]?.innerText,
          職稱:cells5[4]?.innerText,
          M1效率:parseFloat(cells5[5]?.innerText.trim()).toFixed(2) || 0,
          M2效率:parseFloat(cells5[6]?.innerText.trim()).toFixed(2) || 0,
          M3效率:parseFloat(cells5[7]?.innerText.trim()).toFixed(2) || 0,
          累計負值效率:cells5[8]?.innerText,
          效率上升率:cells5[9]?.innerText,
          最終考核效率:cells5[10]?.innerText,
          當月考績:cells5[11]?.innerText,
          額外獎勵:cells5[12]?.innerText,
          考績獎金:cells5[13]?.innerText,	
          額外考績獎金:cells5[14]?.innerText,
          A15拉管理福利金:cells5[15]?.innerText,
          最終獎金:cells5[16]?.innerText,
          下月累計負值效率:cells5[17]?.innerText,
          // 其他需要保存的資料也在這裡處理
        };
      });
      const dataRows7 = Array.from(document.querySelectorAll('#CNDEPOVER tbody tr'));
      this.ATTSUMdata7 = dataRows7.map(row => {
        const cells7 = row.querySelectorAll('td');
  
        return {
          管理部門: cells7[0]?.innerText,
          管理班別:cells7[1]?.innerText,
          工號:cells7[2]?.innerText,
          姓名: cells7[3]?.innerText,
          職稱:cells7[4]?.innerText,
          M1效率:parseFloat(cells7[5]?.innerText.trim()).toFixed(2) || 0,
          M2效率:parseFloat(cells7[6]?.innerText.trim()).toFixed(2) || 0,
          M3效率:parseFloat(cells7[7]?.innerText.trim()).toFixed(2) || 0,
          累計負值效率:cells7[8]?.innerText,
          效率上升率:cells7[9]?.innerText,
          最終考核效率:cells7[10]?.innerText,
          當月考績:cells7[11]?.innerText,
          額外獎勵:cells7[12]?.innerText,
          考績獎金:cells7[13]?.innerText,	
          額外考績獎金:cells7[14]?.innerText,
          A15拉管理福利金:cells7[15]?.innerText,
          最終獎金:cells7[16]?.innerText,
          下月累計負值效率:cells7[17]?.innerText,
          // 其他需要保存的資料也在這裡處理
        };
      });
  
    
    
    
      const PERData = {
            MFG_DAY: '2024/10',
            wopet: this.ATTSUMdata,
            PPWO: this.ATTSUMdata2,
            stffbonus:this.ATTSUMdata3,
            DEPPER:this.ATTSUMdata4,
            QCDEPPER:this.ATTSUMdata5,
            wopet3: this.ATTSUMdata6,
            ZHDEPPER:this.ATTSUMdata7,
            EFF120:this.ATTSUMdata2,
          };
  
          axios.post('https://localhost:5001/api/PWEOVERWOTableToExcel/to-excel', PERData, { responseType: 'blob' })
          //axios.post('https://localhost:5001/api/PWEWOTableToExcel/to-pdf', PERData, { responseType: 'blob' })
         // axios.post('https://localhost:5001/api/TableToExcel/to-excel', combinedData, { responseType: 'blob' })
            .then(response => {
              const blob = new Blob([response.data], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
              const link = document.createElement('a');
              link.href = window.URL.createObjectURL(blob);
              link.download =  '月溢領考核表 Mẫu đánh giá hiệu quả hàng tháng .xlsx';
              link.click();
            })
            .catch(error => {
              console.error('Error exporting to Excel:', error);
            });
  },
  
  
  async downloadExcel() {
    const dataRows = Array.from(document.querySelectorAll('#stff2 tbody tr'));
      this.ATTSUMdata = dataRows.map(row => {
        const cells = row.querySelectorAll('td');
  
        return {
          部門: cells[0].innerText,
          出勤人數:parseInt(cells[1]?.innerText.trim()) || 0,
          實際掛卡工時:parseFloat(parseFloat(cells[2]?.innerText.trim() || '0').toFixed(2)),
          系統計算考勤工時:parseFloat(parseFloat(cells[3]?.innerText.trim() || '0').toFixed(2)),
          回報管理部考勤工時:parseFloat(parseFloat(cells[4]?.innerText.trim() || '0').toFixed(2)),
          差異:parseFloat(parseFloat(cells[5]?.innerText.trim() || '0').toFixed(2)),
          原因:	cells[6].innerText,			
          // 其他需要保存的資料也在這裡處理
        };
      });
      const dataRows2 = Array.from(document.querySelectorAll('#stff tbody tr'));
      this.ATTSUMdata2 = dataRows2.map(row => {
        const cells2 = row.querySelectorAll('td');
  
        return {
          部門: cells2[0].innerText,
          工作拉:cells2[1].innerText,
          工號:cells2[2].innerText,
          姓名:cells2[3].innerText,
          實際掛卡工時:parseFloat(parseFloat(cells2[4]?.innerText || '0').toFixed(2)),
          系統計算考勤工時:parseFloat(parseFloat(cells2[5]?.innerText|| '0').toFixed(2)),
          調整: parseFloat(parseFloat(cells2[6]?.innerText || '0').toFixed(2)),	
          回報管理部考勤工時:	parseFloat(parseFloat(cells2[7]?.innerText || '0').toFixed(2)),
          正班工時:	parseFloat(parseFloat(cells2[8]?.innerText || '0').toFixed(2)),	
          加班工時:	parseFloat(parseFloat(cells2[9]?.innerText || '0').toFixed(2)),
          假別:	cells2[9]?.innerText || '', // 差異原因
          事由:	cells2[10]?.innerText || '',	
          差異原因:	cells2[11]?.innerText || '',		
          差異原因2:	cells2[12]?.innerText || '',		
          // 其他需要保存的資料也在這裡處理
        };
      });
          // Combine data for all tables
          const combinedData = {
            MFG_DAY: this.selectedDate,
            employees: this.ATTSUMdata,
            employmentTime: this.ATTSUMdata2,
          };
  
          // Send combined data to backend API https://localhost:5001/api/TableToExcel/to-excel
           axios.post('http://192.168.209.18:5088/api/TableToExcel/to-excel', combinedData, { responseType: 'blob' })
         // axios.post('https://localhost:5001/api/TableToExcel/to-excel', combinedData, { responseType: 'blob' })
            .then(response => {
              const blob = new Blob([response.data], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
              const link = document.createElement('a');
              link.href = window.URL.createObjectURL(blob);
              link.download =  this.selectedDate+'Attendance daily report.xlsx';
              link.click();
            })
            .catch(error => {
              console.error('Error exporting to Excel:', error);
            });
        
        },
  
  
        async downloadWOExcel() {
      const dataRows = Array.from(document.querySelectorAll('#WO1 tbody tr'));
      this.WOSUMdata = dataRows.map(row => {
        const cells = row.querySelectorAll('td');
        return {
    部門: cells[0]?.innerText || '',
    回報管理部考勤工: parseFloat(parseFloat(cells[1]?.innerText.trim() || '0')),
    工單工時: parseFloat(parseFloat(cells[2]?.innerText.trim() || '0').toFixed(2)),
    狀態工時: parseFloat(parseFloat(cells[3]?.innerText.trim() || '0').toFixed(2)),
    狀態工時2: parseFloat(parseFloat(cells[4]?.innerText.trim() || '0').toFixed(2)),
    貼紙班: parseFloat(parseFloat(cells[5]?.innerText.trim() || '0').toFixed(2)),
    殘疾人: parseFloat(parseFloat(cells[6]?.innerText.trim() || '0').toFixed(2)),
    無效工時: parseFloat(parseFloat(cells[7]?.innerText.trim() || '0').toFixed(2)),
    未設定工單: parseFloat(parseFloat(cells[8]?.innerText.trim() || '0').toFixed(2)),
    借入工時: parseFloat(parseFloat(cells[9]?.innerText.trim() || '0').toFixed(2)),
    借出工時: parseFloat(parseFloat(cells[10]?.innerText.trim() || '0').toFixed(2)),
    調整工時: parseFloat(parseFloat(cells[11]?.innerText.trim() || '0').toFixed(2)),
    備註: cells[12]?.innerText || '',
    系統計算差異: parseFloat(parseFloat(cells[13]?.innerText.trim() || '0').toFixed(2)),
    // 其他需要保存的資料也在這裡處理
  };
      });
      const dataRows2 = Array.from(document.querySelectorAll('#WO2 tbody tr'));
      this.WOSUMdata2 = dataRows2.map(row => {
        const cells2 = row.querySelectorAll('td');
  
        return {
          部門: cells2[0].innerText|| '',
          拉:cells2[1].innerText|| '',
          工單:cells2[2].innerText|| '',
          工序:cells2[3].innerText|| '',
          品名:cells2[4].innerText|| '',
          數量:parseFloat(parseFloat(cells2[5]?.innerText || '0').toFixed(2)),
          標準工時:parseFloat(parseFloat(cells2[6]?.innerText|| '0').toFixed(2)),
          執行工時: parseFloat(parseFloat(cells2[7]?.innerText || '0').toFixed(2)),	
  
        };
      });
          // Combine data for all tables
          const WOCombinedData = {
            MFG_DAY: this.selectedDate,
            WOEmployee: this.WOSUMdata,
            WOEmploymentTime: this.WOSUMdata2,
          };
          console.log('更新成功', WOCombinedData);
          // Send combined data to backend API https://localhost:5001/api/TableToExcel/to-excel
           axios.post('http://192.168.209.18:5088/api/WOTableToExcel/to-excel', WOCombinedData, { responseType: 'blob' })
         //axios.post('https://localhost:5001/api/WOTableToExcel/to-excel', WOCombinedData, { responseType: 'blob' })
            .then(response => {
              const blob = new Blob([response.data], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
              const link = document.createElement('a');
              link.href = window.URL.createObjectURL(blob);
              link.download =  this.selectedDate+'生產日報 report.xlsx';
              link.click();
            })
            .catch(error => {
              console.error('Error exporting to Excel:', error);
            });
        
        },
        exportToExcel2() {
          const wb = XLSX.utils.book_new();
  
  // 第一个表格的数据
  const ws1 = XLSX.utils.json_to_sheet(this.woderpdata);
  XLSX.utils.book_append_sheet(wb, ws1, '總表');
  
  // 第二个表格的数据
  const ws2 = XLSX.utils.json_to_sheet(this.erpdata1);
  XLSX.utils.book_append_sheet(wb, ws2, 'NFC工時與ERP工時不符');
  const ws3 = XLSX.utils.json_to_sheet(this.erpdata2);
  XLSX.utils.book_append_sheet(wb, ws3, 'NFC已完成ERP未結案');
  const ws4 = XLSX.utils.json_to_sheet(this.erpdata3);
  XLSX.utils.book_append_sheet(wb, ws4, 'NFC未完成ERP已結案');
  const ws5 = XLSX.utils.json_to_sheet(this.erpdata4);
  XLSX.utils.book_append_sheet(wb, ws5, 'NFC沒資料ERP已結案');
  const ws6 = XLSX.utils.json_to_sheet(this.erpdata5);
  XLSX.utils.book_append_sheet(wb, ws6, '昨日已完成工單');
  const ws7 = XLSX.utils.json_to_sheet(this.erpdata6);
  XLSX.utils.book_append_sheet(wb, ws7, '廠區生產未完成工單');
  
  // 导出 Excel 文件
  const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });
  const fileName = '工單狀態與ERP對比報表.xlsx';
  const blob = new Blob([wbout], { type: 'application/octet-stream' });
  
  if (navigator.msSaveBlob) {
  navigator.msSaveBlob(blob, fileName);
  } else {
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.setAttribute('download', fileName);
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  }
  },
  PDSNexportToExcel() {
          const wb = XLSX.utils.book_new();
  
  // 第一个表格的数据
  const ws1 = XLSX.utils.json_to_sheet(this.SFPDSNLINK);
  XLSX.utils.book_append_sheet(wb, ws1, '總表');
  
  // 第二个表格的数据
  
  // 导出 Excel 文件
  const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });
  const fileName = '出貨序號對照表.xlsx';
  const blob = new Blob([wbout], { type: 'application/octet-stream' });
  
  if (navigator.msSaveBlob) {
  navigator.msSaveBlob(blob, fileName);
  } else {
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.setAttribute('download', fileName);
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  }
  },
  
  
  exportTableToExcel() {
      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.aoa_to_sheet([]);
  
      // 处理表格1的数据
      const table1 = document.querySelector('#erpsum');
      const table1Headers = [
        [table1.querySelector('th[colspan]').innerText],
        Array.from(table1.querySelectorAll('thead th')).map(th => th.innerText)
      ];
      const table1Data = Array.from(table1.querySelectorAll('tbody tr')).map(tr =>
        Array.from(tr.querySelectorAll('td')).map(td => td.innerText)
      );
  
      // 处理表格2的数据
      const table2 = document.querySelector('#erpsum');
      const table2Headers = [Array.from(table2.querySelectorAll('thead th')).map(th => th.innerText)];
      const table2Data = Array.from(table2.querySelectorAll('tbody tr')).map(tr =>
        Array.from(tr.querySelectorAll('td')).map(td => td.innerText)
      );
  
      // 合并数据
  
  
      // 写入数据到工作表
      XLSX.utils.sheet_add_aoa(ws, mergedData, { origin: 'A1' });
  
      // 处理合并单元格
      ws['!merges'] = [
        { s: { r: 0, c: 0 }, e: { r: 0, c: 7 } }, // 合并第一张表的标题行
      ];
  
      XLSX.utils.book_append_sheet(wb, ws, '考勤報告');
      XLSX.writeFile(wb, '考勤報告.xlsx');
    },
    exportToExcel() {
      fetch('http://192.168.209.18:5088/api/TableToExcel/generate')
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.blob();
        })
        .then(blob => {
          const url = window.URL.createObjectURL(new Blob([blob]));
          const a = document.createElement('a');
          a.href = url;
          a.download = 'attendance_report.xlsx';
          document.body.appendChild(a);
          a.click();
          window.URL.revokeObjectURL(url);
        })
        .catch(error => {
          console.error('There was a problem with the fetch operation:', error);
        });
    },
                  
              
        exportToExcel_wo() {
          const data = this.generateExcelData_wo();
          const ws = XLSX.utils.json_to_sheet(data);
          const wb = XLSX.utils.book_new();
          XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
          XLSX.writeFile(wb, this.WOVERSON[0].部門 + "工單明細.xlsx");
        },
        generateExcelData_wo() {
          const data = [];
          this.WOVERSON.forEach(item => {
            data.push({
              部門: item.部門,
              總工時: item.執行工時,
              執行工單: item.執行工單,
              品名: item.品名,
              執行工時: item.工單工時
  
            });
          });
          return data;
        },
        toggleStatus(id, show) {
  const newValue = show === 'T' ? 'F' : 'T';
  const ID = parseInt(id, 10);
  
  // 构建 PUT 请求的主体
  const updateData = {
    id: ID,
    area: this.selectedArea,
    show: newValue
  };
  
  axios.put('http://192.168.209.18:5088/api/Attendance/UPDATE_SHOW', updateData, {
    headers: {
      'Content-Type': 'application/json'  // 设置 Content-Type 为 JSON
    }
  })
  .then(response => {
    // 处理成功的响应
    console.log('更新成功', response);
  })
  .catch(error => {
    // 处理错误
    console.error('更新失败', error);
  });
  
  console.log('选中的数据:', updateData);
  },
  toggleSHIFTStatus(id, show,NAME) {
  const newValue = show === 'T' ? 'F' : 'T';
  const ID = parseInt(id, 10);
  
  // 构建 PUT 请求的主体
  const updateData = {
    id: ID,
    area: this.selectedArea,
    show: newValue,
    field:NAME
  };
  axios.put('http://192.168.209.18:5088/api/c_shift/UPDATE_SHOW', updateData, {
    headers: {
      'Content-Type': 'application/json'  // 设置 Content-Type 为 JSON
    }
  })
  .then(response => {
    // 处理成功的响应
    console.log('更新成功', response);
  })
  .catch(error => {
    // 处理错误
    console.error('更新失败', error);
  });
  this.shift_data();
  
  },
  updateAllRatings() {
  
  
    const payload = this.RATING_data.map(item => ({
      area: this.selectedArea,
      qty1: item.COMPLETED_QTY_1,
      qty2: item.COMPLETED_QTY_2,
      qty3: item.COMPLETED_QTY_3,
      qty4: item.COMPLETED_QTY_4,
      qty5: item.COMPLETED_QTY_5,
      toqty: this.calculateTotalCompletedQty(item),
      ID: String(item.id)
    }));
    console.log('id:',payload);
  
    axios.put("http://192.168.209.18:5088/api/READWOID/UPDATE_RATING_ALL", payload)
      .then(response => {
        alert(response.data); // 提示更新成功的信息
        this.fetchData();
        this.RATING_fetchData()
  
      })
      .catch(error => {
        console.error(error);
        alert("更新失敗！");
      });
  },
  async updateRATINGDate(ID, fqc1,fqc2,fqc3,fqc4,fqc5,total) {
  
      try {
  
        const response = await axios.put(
          "http://192.168.209.18:5088/api/READWOID/UPDATE_RATING",
          {
             area: this.selectedArea, // 根據需求傳入正確值
             qty1: fqc1,
             qty2: fqc2,
             qty3: fqc3,
             qty4: fqc4,
             qty5: fqc5,
             toqty: total,
             id: String(ID), // 将 id 转换为字符串
  
          }
        );
  
        alert(response.data);
      } catch (error) {
        console.error("更新失敗", error);
        alert("更新失敗，請重試！");
      } finally {
        this.fetchData();
        this.RATING_fetchData()
      }
    },
    completeWorkOrder(woId, fqc) {
  
    const requestData = {
      wO_ID: woId,
      fqc: fqc.toString(),
      department: this.selectedDepartment, // 您的部门名称
      area: this.selectedArea // 您的区域名称
    };
    axios.post('http://192.168.209.18:5088/api/READWOID/update', requestData)
    .then(response => {
      // 成功时弹出成功消息
      console.log('选中的数据:', this.translatedText.更新完成);
      alert(this.translatedText.更新完成);
      // 如果需要在完成后进行一些额外的操作，可以在此处添加代码
    })
    .catch(error => {
      // 失败时弹出错误消息
      alert(this.translatedText[currentLanguage].更新完成);
      console.error('完成工單时出错', requestData);
      // 处理错误情况
    });
  },
    changeLanguage(event) {
            this.currentLanguage = event.target.value;
  
            // 根據選定的語言更新translatedText中的內容
            if (this.currentLanguage === 'zh') {
                this.translatedText = {
                  前處理:'前處理',
        插件:'插件',
        组装:'组装',
        打端子:'打端子',
                  打扭:'打扭',
                  套套管:'套套管',
                  內模:'內模',
                  外模:'外模',
                  外觀:'外觀',
                  待包裝:'待包裝',
                  總數量:'總數量',
                  本月效率:'本月效率',
                  本月溢領:'本月溢領',
                  未結工單:'未結工單',
                  逾期工單:'逾期工單',
                  包装:'包装',
                一般:'一般',
                焊接:'焊接',
                成型:'成型',
                做線:'做線',
                焊接S:'焊接',
                成型S:'成型',
                做線S:'做線',
                星級完成數量:'重點工站完成數量',
                    在線生產看板: '在線生產看板',
                    每日生產看版:'每日生產看版',
                    工單管理: '工單管理',
                    工單查詢: '工單查詢',
                    工站管理: '工站管理',
                    工站設定:'工站設定',
                    人員管理: '人員管理',
                    考勤異常: '考勤異常',
                    生產看版: '生產看版',
                    工單分析圖表: '工單分析圖表',
                    未結工單: '未結工單',
                    完工數量:'完工數量',
                    生產日報:'生產日報',
                    產能日報:'產能日報',
                    卡片設定:'卡片設定',
                    考勤日報:'考勤日報',
                    登入:'登入',
                    NFC_SYSTEAM:'NFC 系統',
                    考勤系統:'考勤系統',
                    生產數據:'生產數據',
                    area:'選擇廠區',
                    部門:'部門',
                    D:'部',
                    S:'課',
                    C:'班',
                    L:'拉',
                    在線人數:'在線人數',
                    應出席人數:'應出席人數',
                    實際出席人數:'實際出席人數',
                    請假人數:'請假人數',
                    流水線在線人數:'流水線在線人數',
                    借入人數:'借入人數',
                    借出人數:'借出人數',
                    工單列表:'工單列表',
                    ID:'編號',
                    工單:'工單',
                    品名:'品名',
                    數量:'數量',
                    標準工時:'標準工時',
                    執行工時:'執行工時',
                    當前效率:'當前效率',
                    過往效率:'過往效率',
                    已完成數量:'已完成數量',
                    設備:'設備',
                    姓名:'姓名',
                    工時:'工時',
                    工站:'工站',
                    座位:'座位',
                    工站列表:'工站列表',
                    功能:'功能',
                    fqcer1:'輸入值不能小於原值',
                    fqcer2:'輸入值不能大於工單數量',
                    完成:'完成',
                    暫停:'暫停',
                    復工:'復工',
                    輸入工單:'輸入工單',
                    查詢:'查詢',
                    提交:'提交',
                    workOrder1:'100:試產工單, 200:來料全檢, 400:重工,700 物料員工時',
                    貼紙班:'貼紙班',
                    裁剝班:'裁線班',
                    料號:'料號',
                    設定工單列表:'設定工單列表',
                    移除:'移除',
                    總和:'總和',
                    修改:'修改',
                    取消:'取消',
                    增加座位:'增加座位',
                    刪除座位:'刪除座位',
                    卡機號:'卡機號',
                    工站名稱:'工站名稱',
                    insert:'插入',
                    delete:'刪除',
                    New:'新增',
                    出勤:'出勤',
                    工作拉:'工作拉',
                    工號:'工號',
                    Status:'狀態',
                    事由:'事由',
                    年休:'年休',
                    請假:'請假',
                    哺乳假:'哺乳假',
                    工傷:'工傷',
                    工傷陪護:'工傷陪護',
                    借出:'借出',
                    新進員工:'新進員工',
                    夜班:'夜班',
                    考勤日報:'考勤日報',
                    show:'顯示',
                    出勤人數:'出勤人數',
                    實際掛卡工時:'實際掛卡工時',
                    總共考勤工時:'總共考勤工時',
                    回報管理部考勤工時:'回報管理部考勤工時', 
                    差異:'差異', 
                    原因:'原因',
                    輸入卡機:'輸入卡機',
                    NFC卡號:'NFC卡號',
                    choose:'選擇 NFC_CODE',
                    刷新:'刷新',
                    在線工單:'在線工單',
                    平均效率:'平均效率',
                    低於90工單數:'低於90%工單數',
                    已完成工單:'已完成工單',
                    未結案工單:'未結案工單',
                    無效工時:'無效工時(hrs)',
                    本日:'本日',
                    本月:'本月',
                   上月:'上月',
                   pd1:'備註：(本月、上月)資料來源ERP',
                   應報考勤:'應報考勤',
                   加總:'加總',
                   導出:'導出',
                   系統計算考勤工時:'系統計算考勤工時',
                   增加有效考勤工時:'增加有效考勤工時',
                   正班工時:'正班工時',
                   加班工時:'加班工時',
                   假別:'假別',
                   更新完成:'更新完成',
                   更新失敗:'更新失敗',
                   重複輸入:'输入值重复，请重新输入！',
                   查無卡號:'查無卡號',
                   工單已存在:'该工單號已存在于表格中。',
                   未添加工單:'未添加工單',
                   查無工單:'查無工單，是否手動增加？',
                   請輸暫停理由:'請輸暫停理由：',
                   未生產:'未生產',
                   調整:'調整',
                   忘記設定:'忘記設定',
                  忘記設定狀態:'忘記設定狀態',
                  工作部門:'工作部門',
                  備註:'備註',
                  考勤調整確認:'考勤調整確認',
                  日期:'日期',
                  班別管理:'班別管理',
                  工單狀態與ERP對比報表:'工單狀態與ERP對比報表',
                  ERP入庫數量:'ERP入庫數量',
                  過站管理:'過站管理',
                  序號管理:'序號管理',
                  序號查詢:'序號查詢',
                  出貨序號表:'出貨序號表',
                  不良品紀錄查詢:'不良品紀錄查詢',
                工站編號:'工站編號',
                綁定工站:'綁定工站',
                測試工站:'測試工站',
                輸入開始序號:'輸入開始序號',
                依產品分類加總資料:'依產品分類加總資料',
      輸入工時:'輸入工時',
      標準產能:'標準產能',
      實際產出:'實際產出',
      不良品:'不良品',
      不良率:'不良率',
      效率:'效率',
                };
            } else if (this.currentLanguage === 'en') {
                this.translatedText = {
                  依產品分類加總資料: 'Tổng hợp theo phân loại sản phẩm',
                  打端子:'Dập đầu sắt',
  輸入工時: 'Giờ làm đã nhập',
  標準產能: 'Công suất tiêu chuẩn',
  實際產出: 'Sản lượng thực tế',
  不良品: 'Sản phẩm lỗi',
  不良率:'Tỷ lệ lỗi',
  效率: 'Hiệu suất',
                  打扭:'xoắn',
                  套套管:'Tayáo',
                  內模:'bên trong',
                  外模:'Khuôn ngoài',
                  外觀:'Vẻ bề ngoài',
                  總數量:'Total quantity',
                  本月效率:'Cumulative efficiency',
                  本月溢領:'Cumulative overpayment',
                  未結工單:'未結工單',
                  逾期工單:'逾期工單',
                  星級完成數量:'Number of stars completed',
                一般:'General',
                焊接:'welding',
                成型:'MD',
                做線:'Make a line',
                焊接S:'welding',
                成型S:'MD',
                做線S:'Make a line',
                    在線生產看板: 'In line production dashboard',
                    每日生產看版:'Daily production board',
                    工單管理: 'Work order query',
                    工單查詢: '工單查詢',
                    工站管理: 'Work station management',
                    工站設定:'Workstation settings',
                    人員管理: 'Staff management',
                    考勤異常: 'Abnormal attendance',
                    生產看版: 'Production dashboard',
                    工單分析圖表: 'Work order analysis chart',
                    未結工單: 'Unfinished work order',
                    完工數量:'Completed quantity',
                    生產日報:'Daily production report',
                    產能日報:'Capacity Daily',
                    卡片設定:'Card settings',
                    考勤日報:'Attendance daily report',
                    登入:'Log in',
                    NFC_SYSTEAM:'NFC Systeam',
                    考勤系統:'Attendance System',
                    生產數據:'Production Data',
                    area:'Area',
                    部門:'department',
                    D:'D',
                    S:'S',
                    C:'C',
                    L:'L',
                    在線人數:'Online users',
                    應出席人數:'Number of people to attend',
                    實際出席人數:'Actual attendance',
                    請假人數:'Leave',
                    流水線在線人數:'Production line users',
                    借入人數:'Borrowing',
                    借出人數:'Lending',
                    工單列表:'Work Order List',
                    ID:'ID',
                    工單:'Work_Order',
                    品名:'Product name',
                    數量:'Quantity',
                    標準工時:'Standard hours',
                    執行工時:'Execution hours',
                    當前效率:'Current efficiency',
                    過往效率:'Past efficiency',
                    已完成數量:'Completed quantity',
                    設備:'Equipment:',
                    姓名:'Name',
                    工時:'Hours',
                    工站:'Workstation',
                    座位:'Seats',
                    工站列表:'Seat list',
                    功能:'Function',
                    fqcer1:'The input value cannot be less than the original value',
                    fqcer2:'The input value cannot be greater than the work order quantity',
                    完成:'complete',
                    暫停:'pause',
                    復工:'Return to work',
                    輸入工單:'Enter work order NO.',
                    查詢:'Query',
                    提交:'submit',
                    workOrder1:'100: Trial production work order, 200: Full inspection of incoming materials, 400:,700 Giờ làm việc của nhân viên vật liệu',
                    貼紙班:'Sticker class',
                    裁剝班:'Cut and strip wire',
                    料號:'Part No',
                    設定工單列表:'Set up work order list',
                    移除:'remove',
                    總和:'sum',
                    choose:'Chooset NFC CODE',
                    修改:'Revise',
                    取消:'Cancel',
                    增加座位:'Add Seats',
                    刪除座位:'Delete seat',
                    卡機號:'machine number',
                    工站名稱:'Work_ tation',
                    insert:'Insert',
                    delete:'Delete',
                    New:'New',
                    出勤:'Attendance',
                    工作拉:'Production line',
                    工號:'Job number',
                    Status:'Status',
                    事由:'Reason',
                    年休:'Annual leave',
                    請假:' Ask for leave',
                    哺乳假:'Breastfeeding leave',
                    工傷:'work injury leave',
                    工傷陪護:'Work injury escort',
                    借出:'Borrowing',
                    新進員工:'Junior staff',
                    夜班:'Night shift',
                    考勤日報:'Daily attendance report',
                    show:'show',
                    出勤人數:'Attendance',
                    實際掛卡工時:'Actual working hours',
                    總共考勤工時:'Total attendance hours',
                    回報管理部考勤工時:'Report attendance hours to the management department', 
                    差異:'Difference', 
                    原因:'Reason',
                    輸入卡機:'Input card machine NO.',
                    NFC卡號:'NFC card number',
                    NFC_CODE:'NFC_CODE',
                    刷新:'Refresh',
                    在線工單:'Online work order',
                    平均效率:'Average efficiency',
                    低於90工單數:'Less than 90% of work orders',
                    已完成工單:'Completed Work_Order',
                    未結案工單:'Open case work order',
                    無效工時:'Invalid working hours(hrs)',
                    本日:'Today',
                    本月:'This month',
                    上月:'Last month',
                    pd1:'Remarks: (This month, Last month) Data source ERP',
                    應報考勤:'Attendance should be reported:',
                    加總:'Total',
                    導出:'Export',
                    系統計算考勤工時:'The system calculates attendance hours',
                    增加有效考勤工時:'Increase effective attendance hours',
                    正班工時:'Regular working hours',
                    加班工時:'overtime hours',
                    假別:'Leave type',
                    更新完成:'Update completed',
                    更新失敗:'Update failed',
                    重複輸入:'The input value is repeated, please re-enter!',
                    查無卡號:'Check no card number',
                    工單已存在:'The work order number already exists in the table',
                    未添加工單:'No work order added',
                    查無工單:'If there is no work order, do you want to add it manually?',
                    請輸暫停理由:'Please enter the reason for suspension:',
                    未生產:'Not produce yet',
                    調整:'Adjustment',
                    忘記設定:'Forgot settings',
                     忘記設定狀態:'Forgot to set status',
                     工作部門:'Working department',
                     備註:'Remark',
                     考勤調整確認:'Attendance adjustment',
                     日期:'MFG_DAY',
                     班別管理:'Shift management',
                     工單狀態與ERP對比報表:'Work order status and ERP comparison report',
                     ERP入庫數量:'ERP warehousing quantity',
                     過站管理:'Station management',
                     序號管理:'Serial number management',
                     序號查詢:'Serial number query',
                     出貨序號表:'Shipping serial number table',
                     不良品紀錄查詢:'Defective product record inquiry',
                     工站編號:' Station number',
                     綁定工站:' Bind work station',
                     測試工站:' Test station',
                     輸入開始序號:'Enter the starting sequence number',
  
                };
            } else if (this.currentLanguage === 'vi') {
                this.translatedText = {
                  依產品分類加總資料: 'Tổng hợp theo phân loại sản phẩm',
  輸入工時: 'Giờ làm đã nhập',
  標準產能: 'Công suất tiêu chuẩn',
  打端子:'Dập đầu sắt',
  實際產出: 'Sản lượng thực tế',
  不良品: 'Sản phẩm lỗi',
  效率: 'Hiệu suất',
  不良率:'Tỷ lệ lỗi',
  前處理:'Lồng thảo quản',
  欄位合併:'Gộp cột ',
        插件:'cắm chân bản mạch',
        组装:' lắp ráp',
                  打扭:'xoắn dây',
                  套套管:'lồng vỏ bọc',
                  內模:'bên khuôn trong',
                  外模:'khuôn ngoài',
                  外觀:'ngoại quan',
                  待包裝:'Chờ đóng gói',
                  總數量:'Tổng số lượng',
                  本月效率:'Hiệu quả của tháng',
                  本月溢領:'Phế tháng này ',
                  未結工單:'Lệnh sản xuất chưa kết thúc',
                  逾期工單:'Lệnh sản xuất quá hạn',
                  星級完成數量:'Số sao đã hoàn thành',
                  一般:'Tổng quan',
                   焊接:'Hàn',
                   成型:'Thành hình',
                    做線:'Làm dây',
                   焊接S:'Hàn',
                   成型S:'Thành hình',
                   做線S:'Làm dây',
                    在線生產看板: 'Bảng điều khiển sản xuất trên chuyền',
                    每日生產看版:'Bảng sản xuất hàng ngày',
                    工單管理: 'Quản lý công đơn',
                    工單查詢: 'Truy vấn lệnh sản xuất',
                    工站管理: 'Quản lý trạm',
                    工站設定:'Cài đặt máy trạm',
                    人員管理: 'Quản lý nhân sự',
                    考勤異常: 'Chấm công bất thường',
                    生產看版: 'Bảng điều khiển sản xuất',
                    工單分析圖表: 'Biểu đồ phân tích công đơn',
                    未結工單: 'Công đơn chưa hoàn thành',
                    完工數量:'Số lượng đã hoàn thành',
                    生產日報:'Báo cáo sản xuất hàng ngày',
                    產能日報:'Công suất hàng ngày',
                    卡片設定:'Cài đặt thẻ',
                    考勤日報:'Báo cáo chấm công hàng ngày',
                    登入:'Đăng nhập',
                    NFC_SYSTEAM:'NFC_SYSTEAM',
                    考勤系統:'Hệ thống chấm công',
                    生產數據:'Dữ liệu sản xuất',
                    area:'Khu vực',
                    部門:'Bộ phận',
                    D:'D',
                    S:'S',
                    C:'C',
                    L:'L',
                    在線人數:'Số người trên chuyền',
                    應出席人數:'Số người tham gia',
                    實際出席人數:'Số người tham gia thực tế',
                    請假人數:'Số người xin nghỉ phép',
                    流水線在線人數:'Số người làm việc trên chuyền',
                    借入人數:'Số lượng người mượn',
                    借出人數:'Số người cho mượn',
                    工單列表:'Danh sách công đơn',
                    ID:'ID',
                    工單:'Công đơn',
                    品名:'Tên sản phẩm',
                    數量:'Số lượng',
                    標準工時:'Giờ làm việc tiêu chuẩn',
                    執行工時:'Giờ thực hiện',
                    當前效率:'Hiệu suất hiện tại',
                    過往效率:'Hiệu suất trước kia',
                    已完成數量:'Số lượng đã hoàn thành',
                    設備:'Thiết bị',
                    姓名:'Tên',
                    工時:'Giờ làm việc',
                    工站:'Trạm',
                    座位:'Số ghế',
                    工站列表:'Danh sách trạm',
                    功能:'Chức năng',
                    fqcer1:'Giá trị đầu vào không thể nhỏ hơn giá trị ban đầu',
                    fqcer2:'Giá trị đầu vào không được lớn hơn số lượng công đơn',
                    完成:'Hoàn thành',
                    暫停:'Tạm dừng',
                    復工:'Quay trở lại làm việc',
                    輸入工單:'Nhập công đơn',
                    查詢:'Tra cứu',
                    提交:'Nộp',
                    workOrder1:'100: Lệnh sản xuất thử, 200: Kiểm tra toàn bộ nguyên liệu đầu vào, 400: Công việc nặng nhọc,700 Giờ làm việc của nhân viên vật liệu',
                    貼紙班:'Loại nhãn dá',
                    裁剝班:'Cắt và tước dây',
                    料號:'Mã liệu',
                    設定工單列表:'Thiết lập danh sách công đơn',
                    移除:'Di dời',
                    總和:'Tổng',
                    choose:'Chọn NFC CODE',
                    修改:'Sửa đổi',
                    取消:'Hủy bỏ',
                    增加座位:'Thêm chỗ ngồi',
                    刪除座位:'Xóa chỗ ngồi',
                    卡機號:'Số thiết bị',
                    工站名稱:'Tên trạm',
                    insert:'Chèn',
                    delete:'Xóa',
                    New:'Mới',
                    出勤:'Tham gia',
                    工作拉:'Chuyền',
                    工號:'Mã số nhân viên',
                    Status:'Trạng thái',
                    事由:'Lý do',
                    年休:'Nghỉ phép năm',
                    請假:'Nghỉ việc riêng',
                    哺乳假:'Nghỉ con nhỏ',
                    工傷:'Tai nạn lao động',
                    工傷陪護:'Bồi thường tai nạn lao động',
                    借出:'Cho mượn',
                    新進員工:'Nhân viên mới',
                    夜班:'Ca đêm',
                    考勤日報:'Chấm công hàng ngày',
                    show:'Trình bày',
                    出勤人數:'Số người tham gia',
                    實際掛卡工時:'Số giờ sản xuất thực tế',
                    總共考勤工時:'Tổng số giờ tham gia',
                    回報管理部考勤工時:'Báo cáo số giờ tham gia cho bộ phận Nhân sự', 
                    差異:'Sự khác biệt', 
                    原因:'Nguyên nhân',
                    輸入卡機:'Nhập số thiết bị',
                    NFC卡號:'Mã thẻ NFC',
                    NFC_CODE:'NFC_CODE',
                    刷新:'làm cho khỏe lại',
                    在線工單:'Lệnh làm việc trực tuyến',
                    平均效率:'Hiệu quả trung bình',
                    低於90工單數:'Ít hơn 90% đơn đặt hàng công việc',
                    已完成工單:'Đã hoàn thành công việc_Đơn hàng',
                    未結案工單:'Mở lệnh làm việc',
                    無效工時:'Giờ làm việc không hợp lệ(hrs)',
                    本日:'Hôm nay',
                    本月:'tháng này',
                    上月:'tháng trước',
                    pd1:'Lưu ý: (tháng này, tháng trước) nguồn dữ liệu ERP',
                    應報考勤:'Việc tham dự phải được báo cáo',
                    加總:'Tổng cộng',
                    導出:'Xuất khẩu',
                    系統計算考勤工時:'Hệ thống tính số giờ chấm công',
                    增加有效考勤工時:'Tăng số giờ đi học hiệu quả',
                    正班工時:'Giờ làm việc thường xuyên',
                    加班工時:'giờ tăng ca',
                    假別:'loại nghỉ phép',
                    更新完成:'Cập nhật đã hoàn tất',
                    更新失敗:'Cập nhật không thành công',
                    重複輸入:'Giá trị đầu vào bị lặp lại, vui lòng nhập lại!',
                    查無卡號:'Kiểm tra không có số thẻ',
                    工單已存在:'Số lệnh sản xuất đã tồn tại trong bảng',
                    未添加工單:'Không có lệnh sản xuất nào được thêm vào',
                    查無工單:'Nếu không có lệnh sản xuất, bạn có muốn thêm nó theo cách thủ công không?',
                    請輸暫停理由:'Vui lòng nhập lý do tạm dừng:',
                    未生產:'Chưa sản xuất',
                    調整:'Điều chỉnh',
                    忘記設定:'Quên cài đặt',
                     忘記設定狀態:'Quên đặt trạng thái',
                     工作部門:'Bộ phận công tác',
                     備註:'Nhận xét',
                     考勤調整確認:'Điều chỉnh chấm công',
                     日期:'ngày',
                     班別管理:'Quản lý ca',
                     工單狀態與ERP對比報表:'Trạng thái lệnh sản xuất và báo cáo so sánh ERP',
                     ERP入庫數量:'Số lượng kho ERP',
                     過站管理:'Quản lý trạm',
                     序號管理:'Quản lý số sê-ri',
                     序號查詢:'Truy vấn số sê-ri',
                     出貨序號表:'Bảng số serial vận chuyển',
                     不良品紀錄查詢:'Truy vấn hồ sơ sản phẩm bị lỗi',
                     工站編號:'Số trạm',
                     綁定工站:'Trạm làm việc ràng buộc',
                     測試工站:'Trạm kiểm tra',
                     輸入開始序號:'Nhập số thứ tự bắt đầu',
                };
            }
        },
    removeRow(item) {
        // 在这里处理移除行的逻辑
        const index = this.ERPDATA.indexOf(item);
        if (index !== -1) {
            this.ERPDATA.splice(index, 1);
        }
    },
  
     async updateStatus(JOBNUMBER, status) {
      let hrtime;
      let note;
      const translatedText = {
    zh: {
        事由: '請輸入理由:', // 添加出勤的翻译
        考勤: '請輸有效考勤工時（只能輸入數字）：', // 添加出勤的翻译
       },
      en: {
  
        事由: 'Please enter the reason',
        考勤: 'Please enter valid attendance hours (only numbers can be entered):', // 添加出勤的翻译
     },
     vi: {
      事由: 'Vui lòng nhập lý do',
      考勤: 'Vui lòng nhập số giờ tham dự hợp lệ (chỉ có thể nhập số):', // 添加出勤的翻译
     }
     
  };
  let currentLanguage = this.currentLanguage; // 默认语言为中文
      if(status==='請假' ){
       hrtime ='0';
        note = window.prompt(translatedText[currentLanguage].事由 );
        
      }else if (status==='夜班'){
        hrtime ='0';
        note = '';
      }else if (status==='備註'){
        hrtime ='0';
        note = window.prompt(translatedText[currentLanguage].事由 );
        }else if (status==='借出'){
          while (true) {
    hrtime = window.prompt(translatedText[currentLanguage].考勤);
  
    // 使用 isNaN() 函数检查输入是否为数字
    if (!isNaN(hrtime)) {
        break; // 如果输入是数字，跳出循环
    }
  }
  const options = [
        "廠內重工工時",
        "其它廠重工工時",
        "其他借出工時"
    ];
  
    let message = translatedText[currentLanguage].事由 + "\n";
    options.forEach((option, index) => {
        message += `${index + 1}. ${option}\n`;
    });
  
    let choice;
    while (true) {
        choice = window.prompt(message);
        if (choice >= 1 && choice <= options.length) {
            note = options[choice - 1];
            break;
        }
    }
  
    console.log("選擇的事由:", note);
        }else{
  
  
  // 使用 while 循环确保用户输入的是一个有效的数字
  while (true) {
    hrtime = window.prompt(translatedText[currentLanguage].考勤);
  
    // 使用 isNaN() 函数检查输入是否为数字
    if (!isNaN(hrtime)) {
        break; // 如果输入是数字，跳出循环
    }
  }
        note = window.prompt(translatedText[currentLanguage].事由 );
  
      }
  
      // Make API call to add new staff
      const apiUrl = "http://192.168.209.18:5088/api/Attendance/UPDATESTATUS";
      
      // Assuming you have Axios installed, if not run: npm install axios
  
      axios.post(apiUrl, {
        area: this.selectedArea,
        jobnumber: JOBNUMBER,
        ststus: status,
        hr_time:hrtime,
        note:note,
      
  })
        .then(response => {
          // Handle success
          console.log("New staff added successfully:", response.data);
          this. staff_data();
          // You may want to update the staffData array with the new data
          // For example, this.staffData.push(response.data);
  
          // Reset the form and hide it
        })
        .catch(error => {
          // Handle error
          console.log("hrtime", hrtime);
          console.error("Error adding new staff:", error);
        });
    },
    startAutoScroll() {
          this.intervalId = setInterval(() => {
            // 移除第一個元素，將新數字添加到最後
            this.PDVERSON.push(this.PDVERSON.shift());
          }, 1000); // 調整循環播放的時間間隔
        },
        stopAutoScroll() {
          clearInterval(this.intervalId);
        },
        countShiftDesc(index, data) {
      let count = 1;
      while (index + count < data.length && data[index + count].部門 === data[index].部門) {
        count++;
      }
      return count;
    },
    countShiftDescATT(index) {
      let count = 1;
      while (index + count < this.ATT_time_data.length && this.ATT_time_data[index + count].部門 === this.ATT_time_data[index].部門) {
        count++;
      }
      return count;
    },
    ATT_Abnorma_data() {
    // Make a POST request to the API
    axios.post('http://192.168.209.18:5088/api/Attendance/ATT_DATA_Exception', /* Add any data you need to send in the body */)
      .then(response => {
        // Assuming the API response contains data in a property named 'data'
        this.ATT_Abnormal_d = response.data;
      })
      .catch(error => {
        console.error('Error fetching data:', error);
      });
  },
  
    formatDepartment(department) {
      if (!department) {
        return '';  // 如果没有部门值，则返回空字符串
      }
  
      // 使用 replace 方法替换字符串中的 "D"、"S"、"C"
      const formattedDepartment = department.replace(/D/g, 'D').replace(/S/g, 'S').replace(/C/g, 'C');
      return formattedDepartment;
    },
    async woderp() {
      this.woderpdata = [];
      this.erpdata1=[];
      this.erpdata2=[];
      this.erpdata3=[];
      this.erpdata4=[];
      this.erpdata5=[];
      this.erpdata6=[];
      this.loading = true;
      this.woderpreport = true;
       if (!this.selectedArea) {
       this.loading = false;
     
      return; // 如果没有选择区域，直接返回
        }
        const date = new Date(this.selectedDate);
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    const formattedDate = `${year}${month}${day}`;
  
        const apiUrl1 = `http://192.168.209.18:5088/api/Report/WO_ERP__SUM_version?AREA=${this.selectedArea}`;
        const apiUrl2 = `http://192.168.209.18:5088/api/Report/WO_ERP_1?AREA=${this.selectedArea}`;
        const apiUrl3 = `http://192.168.209.18:5088/api/Report/WO_ERP_2?AREA=${this.selectedArea}`;
        const apiUrl4 = `http://192.168.209.18:5088/api/Report/WO_ERP_3?AREA=${this.selectedArea}`;
        const apiUrl5 = `http://192.168.209.18:5088/api/Report/WO_ERP_4?AREA=${this.selectedArea}`;
        const apiUrl6 = `http://192.168.209.18:5088/api/Report/WO_ERP_5?AREA=${this.selectedArea}&MFG_DAY=${formattedDate}`;
        const apiUrl7 = `http://192.168.209.18:5088/api/Report/WO_ERP_6?AREA=${this.selectedArea}`;
  
        try {
        const responses = await Promise.all([
            fetch(apiUrl1),
            fetch(apiUrl2),
            fetch(apiUrl3),
            fetch(apiUrl4),
            fetch(apiUrl5),
            fetch(apiUrl6),
            fetch(apiUrl7)
  
        ]);
        const data = await Promise.all(responses.map(response => response.json()));
  
        this.woderpdata = data[0];
        this.erpdata1 = data[1];
        this.erpdata2 = data[2];
        this.erpdata3 = data[3];
        this.erpdata4 = data[4];
        this.erpdata5 = data[5];
        this.erpdata6 = data[6];
     } catch (error) {
    console.error('Error fetching data:', error);
    }
     this.loading = false;
     this.woderpreport = true;
  
  },
    async PDVER() {
      this.PDVERSON = [];
      this.PDTOVERSON = [];
      this.loading = true;
       this.SHOW_PD_VERSON = true;
  
       if (!this.selectedArea) {
       this.loading = false;
       this.SHOW_PD_VERSON = true;
      return; // 如果没有选择区域，直接返回
        }
  
        const apiUrl1 = `http://192.168.209.18:5088/api/Report/PD_version?AREA=${this.selectedArea}`;
        const apiUrl2 = `http://192.168.209.18:5088/api/Report/PD_TO_version?AREA=${this.selectedArea}`;
  
        try {
        const responses = await Promise.all([
            fetch(apiUrl1),
            fetch(apiUrl2)
        ]);
        const data = await Promise.all(responses.map(response => response.json()));
  
        this.PDVERSON = data[0];
        this.PDTOVERSON = data[1];
     } catch (error) {
    console.error('Error fetching data:', error);
    }
     this.loading = false;
     this.SHOW_PD_VERSON = true;
  
  },
  
  async  fetchCombinedVersions(selectedArea) {
     this.PDVERSON = [];
      this.PDTOVERSON = [];
      this.loading = true;
      this.SHOW_PD_VERSON = false;
       if (!this.selectedArea) {
       this.loading = false;
       this.SHOW_PD_VERSON = true;
      return; // 如果没有选择区域，直接返回
        }
  
    const apiUrl = `http://192.168.209.18:5088/api/Report/Combined_versions?AREA=${this.selectedArea}`;
  
    try {
        const response = await fetch(apiUrl);
        const data = await response.json();
  
        console.log('PD Version:', data.pdVersion);
        console.log('PD TO Version:', data.pdToVersion);
  
        // 处理数据
        this.PDVERSON = data.pdVersion;
        this.PDTOVERSON = data.pdToVersion;
        this.loading = false;
        this.SHOW_PD_VERSON = true;
    } catch (error) {
        console.error('Error fetching data:', error);
        this.loading = false;
    }
    this.SHOW_PD_VERSON = true;
  },
  
  async RATING_SUM_VER() {
  this.RATING_SUM_VERSON = [];
  this.RATINGVERSON = [];
  this.loading = true;
  
  if (!this.selectedArea) {
    this.loading = false;
    return; // 如果没有选择区域，直接返回
  }
  
  const date = new Date(this.selectedDate);
  const year = date.getFullYear();
  const month = (date.getMonth() + 1).toString().padStart(2, '0');
  const day = date.getDate().toString().padStart(2, '0');
  const formattedDate = `${year}${month}${day}`;
  const apiUrl1 = `http://192.168.209.18:5088/api/READWOID/SELECT_SUM_RATING?area=${this.selectedArea}&MFG_DAY=${formattedDate}`;
  
  try {
    const response = await fetch(apiUrl1);
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
  
    const data = await response.json();
    this.RATING_SUM_VERSON = data.result; // 假设 JSON 数据结构为 { "result": [...] }
  
    // 根据获取到的数据进行二次处理
    const trueKeys = Object.keys(this.showInSecondTable)
      .filter(key => this.showInSecondTable[key])
      .sort((a, b) => a - b);
  
    trueKeys.forEach(trueKey => {
      // 避免清空已存在的数据，改为追加处理
      this.RATINGVER(trueKey);
    });
  } catch (error) {
    console.error('Error fetching data:', error);
  } finally {
    this.loading = false;
  }
  },
  // 日期格式化函数
  
  // 异步函数 RATINGVER
  async RATINGVER(DEPARTMENT) {
  console.log("New staff added successfully:", this.showInSecondTable);
  if (!this.showInSecondTable[DEPARTMENT]) {
      // 遍历ATT_time_data数组
      for (let i = this.RATINGVERSON.length - 1; i >= 0; i--) {
        if (this.RATINGVERSON[i].部門 === DEPARTMENT) {
          // 如果部门匹配，从数组中删除该项
          this.RATINGVERSON.splice(i, 1);
        }
      }
    }
  
  
  // 如果没有选择区域，直接返回
  if (!this.selectedArea) {
    console.warn('No selected area');
    return;
  }
  
  this.loading = true; // 开始加载
  const date = new Date(this.selectedDate);
  const year = date.getFullYear();
  const month = (date.getMonth() + 1).toString().padStart(2, '0');
  const day = date.getDate().toString().padStart(2, '0');
  const formattedDate = `${year}${month}${day}`;
  const apiUrl1 = `http://192.168.209.18:5088/api/READWOID/SELECT_SN_RATING?area=${this.selectedArea}&department=${DEPARTMENT}&MFG_DAY=${formattedDate}`;
  
  try {
    // 发起 API 请求
    const response = await fetch(apiUrl1);
  
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
  
    const data = await response.json();
  
    if (data && Array.isArray(data.result)) {
      // 合并数据到 RATINGVERSON
      this.RATINGVERSON.push(...data.result);
  
      // 按部门排序
      this.RATINGVERSON.sort((a, b) => (a.部門 < b.部門 ? -1 : a.部門 > b.部門 ? 1 : 0));
    } else {
      console.warn('No valid data returned from API:', data);
    }
  } catch (error) {
    console.error('Error fetching data:', error);
  } finally {
    this.loading = false; // 加载结束
  }
  
  console.log("RATINGVERSON:", this.RATINGVERSON);
  },
  
  
  
  
  async WO_SUM_VER() {
      this.WO_SUM_VERSON = [];
      this.WOVERSON = [];
      this.loading = true;
       if (!this.selectedArea) {
       this.loading = false;
      return; // 如果没有选择区域，直接返回
        }
        const date = new Date(this.selectedDate);
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    const formattedDate = `${year}${month}${day}`;
        const apiUrl1 = `http://192.168.209.18:5088/api/Report/WO_SUM_version?AREA=${this.selectedArea}&MFG_DAY=${formattedDate}`;
  
        try {
        const responses = await Promise.all([
            fetch(apiUrl1),
    
        ]);
        const data = await Promise.all(responses.map(response => response.json()));
  
        this.WO_SUM_VERSON = data[0];
  
     } catch (error) {
    console.error('Error fetching data:', error);
    }
    const trueKeys = Object.keys(this.showInSecondTable)
  .filter(key => this.showInSecondTable[key])
  .sort((a, b) => a - b);
  
  trueKeys.forEach(trueKey => {
  this.WOVERSON = [];
  this.WOVER(trueKey);
  });
     this.loading = false;
  },
  
  async WOVER(DEPARTMENT) {
  console.log("New staff added successfully:", this.showInSecondTable);
  if (!this.showInSecondTable[DEPARTMENT]) {
      // 遍历ATT_time_data数组
      for (let i = this.WOVERSON.length - 1; i >= 0; i--) {
        if (this.WOVERSON[i].部門 === DEPARTMENT) {
          // 如果部门匹配，从数组中删除该项
          this.WOVERSON.splice(i, 1);
        }
      }
    }
  
      this.loading = true;
       if (!this.selectedArea) {
       this.loading = false;
      return; // 如果没有选择区域，直接返回
        }
        const date = new Date(this.selectedDate);
      const year = date.getFullYear();
      const month = (date.getMonth() + 1).toString().padStart(2, '0');
      const day = date.getDate().toString().padStart(2, '0');
      const formattedDate = `${year}${month}${day}`;
        const apiUrl1 = `http://192.168.209.18:5088/api/Report/WO_version?AREA=${this.selectedArea}&DEPARTMENT=${DEPARTMENT}&MFG_DAY=${formattedDate}`;
  
        try {
        const responses = await Promise.all([
            fetch(apiUrl1),
    
        ]);
        const data = await Promise.all(responses.map(response => response.json()));
  
        //this.WOVERSON = data[0];
        this.WOVERSON.push(...data[0]);
        this.WOVERSON.sort((a, b) => {
        // 按部门名称顺序排序（假设部门名称是字符串）
           if (a.部門 < b.部門) {
          return -1;
          }
             if (a.部門 > b.部門) {
               return 1;
         }
                return 0;
  });
  
     } catch (error) {
    console.error('Error fetching data:', error);
    }
     this.loading = false;
  },
  
  async att_hr_SUM_ADJ() {
  this.ATT_time_ADJ_data=[];
  const date = new Date(this.selectedDate);
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    const formattedDate = `${year}${month}${day}`;
  this.loading = true;
       if (!this.selectedArea  && !this.selectedDate) {
       this.loading = false;
      return; // 如果没有选择区域，直接返回
        }
  const apiUrl1 = `http://192.168.209.18:5088/api/Attendance/HR_ADJ_CONFIRM?AREA=${this.selectedArea}&mfg_day=${formattedDate}`;
  
  try {
  const responses = await Promise.all([
      fetch(apiUrl1),
  ]);
  const data = await Promise.all(responses.map(response => response.json()));
  
  this.ATT_time_ADJ_data = data[0];
  } catch (error) {
  console.error('Error fetching data:', error);
  }
  this.loading = false;
  },
  async att_hr_SUM_data() {
      this.ATT_time_data=[];
      this.ATT_time_SUM_data = [];
      this.loading = true;
       if (!this.selectedArea  && !this.selectedDate) {
       this.loading = false;
      return; // 如果没有选择区域，直接返回
        }
        const date = new Date(this.selectedDate);
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    const formattedDate = `${year}${month}${day}`;
        const apiUrl1 = `http://192.168.209.18:5088/api/Report/HR_SUN_version?AREA=${this.selectedArea}&MFG_DAY=${formattedDate}`;
  
        try {
        const responses = await Promise.all([
            fetch(apiUrl1),
        ]);
        const data = await Promise.all(responses.map(response => response.json()));
  
        this.ATT_time_SUM_data = data[0];
     } catch (error) {
    console.error('Error fetching data:', error);
    }
    
   
   /* const trueKeys = Object.keys(this.showInSecondTable).filter(key => this.showInSecondTable[key]);
  
  // 遍历 trueKeys 数组，依次传递每个值为 true 的键给 att_hr_data 方法
  trueKeys.forEach(trueKey => {
  this.att_hr_data(trueKey);
  });
     this.loading = false;*/
  
     const trueKeys = Object.keys(this.showInSecondTable)
  .filter(key => this.showInSecondTable[key])
  .sort((a, b) => a - b);
  
  trueKeys.forEach(trueKey => {
  this.att_hr_data(trueKey);
  });
  
  this.loading = false;
  },
  
  async att_hr_data( DEPATRMENT) {
     // this.ATT_time_data=[];
     if (!this.showInSecondTable[DEPATRMENT]) {
      // 遍历ATT_time_data数组
      for (let i = this.ATT_time_data.length - 1; i >= 0; i--) {
        if (this.ATT_time_data[i].部門 === DEPATRMENT) {
          // 如果部门匹配，从数组中删除该项
          this.ATT_time_data.splice(i, 1);
        }
      }
    }
     this.loading = true;
       if (!this.selectedArea && !this.selectedDate) {
       this.loading = false;
      return; // 如果没有选择区域，直接返回
        }
        if (this.selectedL) {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + '-' + this.selectedL + 'C';
  } else {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
  }
  const date = new Date(this.selectedDate);
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    const formattedDate = `${year}${month}${day}`;
        axios.post('http://192.168.209.18:5088/api/Attendance/ATT_DATA_hr', {
         area: this.selectedArea,
         department:DEPATRMENT,
         mfG_DAY:formattedDate,
  
  })
  .then(response => {
  // POST請求成功，將數據賦值給seatData
  //this.ATT_time_data = this.ATT_time_data.concat(response.data);
  this.ATT_time_data.push(...response.data);
  this.ATT_time_data.sort((a, b) => {
  // 按部门名称顺序排序（假设部门名称是字符串）
  if (a.部門 < b.部門) {
    return -1;
  }
  if (a.部門 > b.部門) {
    return 1;
  }
  return 0;
  });
  
  })
  .catch(error => {
  // POST請求失敗，輸出錯誤信息
  console.error('Error posting data:', error);
  });
  this.setCookie2('showInSecondTable', JSON.stringify(this.showInSecondTable));
     this.loading = false;
  },
    generateChart() {
      // Trigger chart generation in the child component
      this.$children[0].fetchData();
      this.$children[1].fetchReportData();
    },
  
    new_staff() {
        this.newStaff.department  =this.selectedDepartment;
      this.showForm = true;
    },
    show_delete() {
      this.showActions = true;
   
    },
    show_CANCLE(){
      this.showActions = false;
  
      this.showForm = false;
      this.staffData.forEach(item => {
      item.editable = false;
    });
      this. staff_data();
    },
    show_UPDATE() {
      this.showActions = true;
      this.staffData.forEach(item => {
      item.editable = true;
    });
   
    },
    addNewSHIFT() {
      // Make API call to add new staff
      const apiUrl = "http://192.168.209.18:5088/api/c_shift/creat";
      
      // Assuming you have Axios installed, if not run: npm install axios
  
      axios.post(apiUrl, {
        area: this.selectedArea,
        department: this.newSHIFT.DEPARTMENT,
        hostid: this.newSHIFT.HOSTID,
  
  })
        .then(response => {
          // Handle success
          console.log("New staff added successfully:", response.data);
  
          // You may want to update the staffData array with the new data
          // For example, this.staffData.push(response.data);
  
          // Reset the form and hide it
          this.newSHIFT = {
            department: "",
            HOSTID: "",
    
          };
          this.showForm = false;
          this. shift_data();
        })
        .catch(error => {
          // Handle error
          console.error("Error adding new staff:", error);
        });
    },
    addNewStaff() {
      // Make API call to add new staff
      const apiUrl = "http://192.168.209.18:5088/api/Attendance/creat";
      
      // Assuming you have Axios installed, if not run: npm install axios
  
      axios.post(apiUrl, {
        area: this.selectedArea,
        department: this.newStaff.department,
        jobnumber: this.newStaff.jobnumber,
        username: this.newStaff.username,
        work_department: this.newStaff.work_department ? this.newStaff.work_department : ''
  })
        .then(response => {
          // Handle success
          console.log("New staff added successfully:", response.data);
  
          // You may want to update the staffData array with the new data
          // For example, this.staffData.push(response.data);
  
          // Reset the form and hide it
          this.newStaff = {
            department: "",
            jobnumber: "",
            username: "",
            work_department: "",
          };
          this.showForm = false;
          this. staff_data();
        })
        .catch(error => {
          // Handle error
          console.error("Error adding new staff:", error);
        });
    },
    // ... (existing methods for completeTask and pauseTask)
   staff_data() {
    this.staffData=[];
    if (!this.selectedArea || !this.selectedD || !this.selectedS || !this.selectedC) {
        // 資料為空，不執行POST請求
            console.warn('資料為空，未執行POST請求。');
           return;
         }
  
  if (this.selectedL) {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
  } else {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
  }
  console.log('POST 請求傳遞的資料:', {
    area: this.selectedArea,
  department: this.selectedDepartment,
  });
  // 使用axios來發送POST請求
  axios.post('http://192.168.209.18:5088/api/Attendance', {
  area: this.selectedArea,
  department: this.selectedDepartment,
  })
  .then(response => {
  // POST請求成功，將數據賦值給seatData
  this.staffData = response.data;
  })
  .catch(error => {
  // POST請求失敗，輸出錯誤信息
  console.error('Error posting data:', error);
  });
  
  },  
    enableEditMode(selectedItem) {
      // 將所有項目的 editMode 設置為 false
      this.seatData.forEach(item => {
        item.editMode = false;
      });
      // 將選定的項目的 editMode 設置為 true
      selectedItem.editMode = true;
    },
  
    disableEditMode(item) {
      item.editMode = false;
    },
    postData() {
  
        if (!this.selectedArea || !this.selectedD || !this.selectedS || !this.selectedC) {
        // 資料為空，不執行POST請求
            console.warn('資料為空，未執行POST請求。');
           return;
         }
  
        if (this.selectedL) {
           this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + '-' + this.selectedL + 'C';
        } else {
           this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
        }
      // 使用axios來發送POST請求
      axios.post('http://192.168.209.18:5088/api/c_seat', {
        area: this.selectedArea,
        department: this.selectedDepartment,
      })
      .then(response => {
        // POST請求成功，將數據賦值給seatData
        this.seatData = response.data;
        this.newSeat.machine_L='0000',
        this.newSeat.machine_R='0000',
        this.newSeat.seatID=this.seatData.length + 1
        this.HOST_MACHINE();
      })
      .catch(error => {
  
        // POST請求失敗，輸出錯誤信息
        console.error('Error posting data:', error);
        this.HOST_MACHINE();
        this.seatData=[];
      });
    
  
  },
  HOST_MACHINE(){
  
    // 使用axios來發送GET請求
    axios.get('http://192.168.209.18:5088/api/c_seat/HOST_MACHINE', {
        params: {
            AREA: this.selectedArea,
            DEPARTMENT: this.selectedDepartment
        }
    })
    .then(response => {
        // 成功获取数据后的处理逻辑，你可以根据需要处理返回的数据
        this.hostMachine = response.data;
        console.log('Data fetched successfully:', response.data);
    })
    .catch(error => {
        // GET請求失敗，輸出錯誤信息
        console.error('Error fetching data:', error);
    });
  
  
  
  },
  
    getRowSpan(index) {
      let count = 1;
      for (let i = index + 1; i < this.realTimeData.length; i++) {
        if (this.realTimeData[i].NFC_CODE === this.realTimeData[index].NFC_CODE) {
          count++;
        } else {
          break;
        }
      }
      return count;
    },
  
    async fetchOnlineData() {
        if (this.selectedL) {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + '-' + this.selectedL + 'C';
  } else {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
  }
  
  
    const apiUrl = 'http://192.168.209.18:5088/api/ONLINE?area=' + this.selectedArea + '&department=' + this.selectedDepartment;
  
    try {
        const response = await fetch(apiUrl); // 使用 apiUrl 而不是硬编码的 URL
        const data = await response.json();
        this.onlineData = data;
      } catch (error) {
        console.error('Error fetching online data:', error);
      }
    
  },
    async executeUpdate() {
  
        const allWoIds = this.totwo();
       try {
    // 构造 UPDATE 请求的数据
    const updateData = {
      nickName: allWoIds, // 替换为实际的 nickName
      department: this.selectedDepartment,
      area: this.selectedArea,
      nfC_CODE:this.selectednfccode,
  
    };
  
    // 使用 fetch 或其他方法发送 UPDATE 请求
    const response = await fetch('http://192.168.209.18:5088/api/NEWWOID/update', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(updateData),
    });
  
    // 检查 HTTP 状态码
    if (!response.ok) {
      throw new Error(`HTTP error! Status: ${response.status}`);
    }
  
    // 检查 Content-Type
    const contentType = response.headers.get('Content-Type');
    if (contentType && contentType.includes('application/json')) {
      // 处理 UPDATE 响应
      const result = await response.json();
      console.log('UPDATE result:', result);
    } else {
      // 处理非 JSON 格式的 UPDATE 响应
      const resultText = await response.text();
      console.log('UPDATE result:', resultText);
      alert(this.translatedText.更新完成);
     this.fetchData2();
     this.ERPDATA = [];
     this.selectedERP='';
  
    }
  
  } catch (error) {
    console.error('Error executing UPDATE:', error);
  }
  },
    totwo() {
     let allWoIds = "";
      for (const item of this.ERPDATA) {
       allWoIds += item.wadoco + ",";
     }
     return allWoIds;
    },
    async uploadData() {
       try {
  
        if (!this.selectednfccode || this.selectednfccode.trim() === "") {
          alert("NFC Code 不能为空或 NULL"); // 弹出提示框提醒用户
          return; // 直接终止操作
    }
      // 计算整张表格的总和
      const totalQty = parseFloat(this.calculateTotal("wauorg"));
      const totalStdTime = parseFloat(this.calculateTotal("wlrunl_sum"));
      const allWoIds = this.totwo();
      this.loading = true;
  
    // 逐行上传数据
    for (const item of this.ERPDATA) {
      const standardTime = parseFloat(item.wlrunl_sum);
      const qty = parseFloat(item.wauorg);
  
      const uploadData = {
        area: this.selectedArea,
        department: this.selectedDepartment,
        woId: item.wadoco,
        transId: "LOT_START",
        qty: qty,
        nfcCode: this.selectednfccode,
        partNo: item.walitm,
        partDesc: item.wadl01,
        standardTime: standardTime,
        totalWo: allWoIds,
        totalQty: totalQty,
        totalStdTime: totalStdTime.toFixed(2),
        PasstEFF: item.avgStdEff || 0,
      };
  
      // 使用 fetch 或其他方法发送 POST 请求上传数据
      console.log('uploadData Message:', uploadData);
      const response = await fetch('http://192.168.209.18:5088/api/NEWWOID', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(uploadData),
      });
  
      // 检查 HTTP 状态码
      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }
  
      // 检查 Content-Type
      const contentType = response.headers.get('Content-Type');
      if (contentType && contentType.includes('application/json')) {
        // 处理响应
        const result = await response.json();
        console.log('Upload result:', result);
        console.log('Success Message:', result.successMessage);
        this.loading = false;
       // await this.executeUpdate();
      } else {
        // 处理非 JSON 格式的成功消息
        const resultText = await response.text();
        console.log('Success Message:', resultText);
        this.loading = false;
      }
  
    }
    await this.executeUpdate();
  } catch (error) {
    console.error('Error uploading data:', uploadData);
    
  }
  this.loading = false;
  },
    async fetchDPData() {
      this.selectednfccode=null;
      if (this.selectedL) {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + '-' + this.selectedL + 'C';
  } else {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
  }
      // 从服务器获取下拉选项的数据
      try {
  
        
        const response = await fetch('http://192.168.209.18:5088/api/DISTINCTNFCCODE?name=' + this.selectedDepartment + 'LN%25&area=' + this.selectedArea);
        const data = await response.json();
        this.dpOptions = data.map(item => {
      const match = item.nfc_code.match(/\d+$/);
      return match ? match[0] : item.nfc_code;
      console.log('Success Message:', response);
    });
      } catch (error) {
        console.error('Error fetching DP data:', error);
      }
    },
    SAFFcalculateTotal(property) {
      // 计算指定属性的总和
      return this.ERPDATA.reduce((total, item) => total + parseFloat(item[property] || 0), 0);
    },
    calculateTotal(property) {
      // 计算指定属性的总和
      return this.ERPDATA.reduce((total, item) => total + parseFloat(item[property] || 0), 0);
    },
    PDcalculateTotal(property) {
      // 计算指定属性的总和
      return this.PDTOVERSON.reduce((total, item) => total + parseFloat(item[property] || 0), 0);
    },
    PDcalculateAVG(property) {
  // 獲取指定屬性的數組
  const propertyArray = this.PDTOVERSON.map(item => parseFloat(item[property] || 0));
  
  // 計算總和
  const sum = propertyArray.reduce((total, value) => total + value, 0);
  
  // 計算平均值，注意處理分母為零的情況
  const nonZeroLength = propertyArray.filter(value => value !== 0).length;
  const average = nonZeroLength > 0 ? sum / nonZeroLength : 0;
  
  // 返回總和和平均值
  return average;
  },
  
    checkAndSelectERP() {
        this.isButtonDisabled = true;
  const existingWorkOrderInERPDATA = this.ERPDATA.find(item => item.wadoco === this.selectedERP);
  const existingWorkOrderInRealTimeData = this.realTimeData.find(item => item.WO_ID === this.selectedERP);
  
  if (existingWorkOrderInERPDATA || existingWorkOrderInRealTimeData) {
    alert(this.translatedText.工單已存在);
    this.selectedERP='';
    this.isButtonDisabled = false;
  } else {
    if (this.Stickers=='TZ'||this.Stickers=='CD') {
      this.selectStickersr(this.Stickers);
    } else {
      this.selectERP();
    }
  } 
  },
  async selectStickersr(Stickers) {
  const wo_Id = this.selectedERP;
  
  try {
    // Make GET request to fetch SN_LIST data
    const snListResponse = await axios.get(`http://192.168.209.18:5088/api/SFWOREAD/SN_LIST?WO_ID=${this.selectedERP}&TYPE=${encodeURIComponent(Stickers)}`);
    this.snList = snListResponse.data.result || [];
  
    if (this.snList.length === 0 || this.snList[0].wadoco === '') {
      const userWantsToAddManually = window.confirm(this.translatedText.查無工單);
      if (userWantsToAddManually) {
        // Call method to add manually
        this.addManually(wo_Id);
      } else {
        // Logic when the user chooses not to add manually
        alert(this.translatedText.未添加工單);
        this.isButtonDisabled = false;
      }
    } else {
      this.ERPDATA.push(...this.snList);
      this.isButtonDisabled = false;
  
    }
  } catch (error) {
    // Handle errors from GET request
    console.error('Error fetching SN_LIST data:', error);
    alert(this.translatedText.查無工單);
    this.isButtonDisabled = false;
  }
  this.selectedERP='';
  },
    selectERP(){
  
  const wo_Id = this.selectedERP;
  //const apiUrl = `http://192.168.209.18:5088/api/ERPWOID/${wo_Id}`;
  
  if(wo_Id==='100'){
  this.ERPDATA.push({
      wadoco: wo_Id,
      walitm: '100',
      wadl01:'試產工單',
      wauorg: '0',
      wlrunl_sum:'1',
      // 其他属性...
  
    });
    this.isButtonDisabled = false;  
  }else if (wo_Id==='200'){
  this.ERPDATA.push({
      wadoco: wo_Id,
      walitm: '200',
      wadl01:'來料全檢',
      wauorg: '0',
      wlrunl_sum:'1',
      // 其他属性...
  
    });
    this.isButtonDisabled = false;  
  }else if (wo_Id==='300'){
  this.ERPDATA.push({
      wadoco: wo_Id,
      walitm: '300',
      wadl01:'貼紙班',
      wauorg: '0',
      wlrunl_sum:'1',
      // 其他属性...
  
    });
    this.isButtonDisabled = false;  
  }else if (wo_Id==='400'){
  this.ERPDATA.push({
      wadoco: wo_Id,
      walitm: '400',
      wadl01:'重工',
      wauorg: '0',
      wlrunl_sum:'1',
      // 其他属性...
  
    });
    this.isButtonDisabled = false;  
  }else if (wo_Id==='700'){
  this.ERPDATA.push({
      wadoco: wo_Id,
      walitm: '700',
      wadl01:'物料員工時',
      wauorg: '0',
      wlrunl_sum:'1',
      // 其他属性...
  
    });
  }else if (wo_Id==='500'){
  this.ERPDATA.push({
      wadoco: wo_Id,
      walitm: '500',
      wadl01:'裁剝線',
      wauorg: '0',
      wlrunl_sum:'1',
      // 其他属性...
  
    });
    this.isButtonDisabled = false;  
  }else{
  // Assuming you are using fetch API
  axios.post('http://192.168.209.18:5088/api/ERPREAD/WOID', {
  wadoco: this.selectedERP
  })
  .then(response => {
  const data = response.data;
  if (data.length === 0 || data[0].wadoco === '') {
    const userWantsToAddManually = window.confirm(this.translatedText.查無工單);
    if (userWantsToAddManually) {
      // 执行手动增加工单的逻辑，可以调用一个方法或者显示一个表单
      this.addManually(wo_Id);
    } else {
      // 用户选择不手动增加时的逻辑
      alert(this.translatedText.未添加工單);
      this.isButtonDisabled = false;  
    }
  } else {
    this.ERPDATA.push(...data);
    this.isButtonDisabled = false;  
  }
  })
  .catch(error => {
  // POST请求失败，输出错误信息
  console.error('Error posting data:', error);
  alert(this.translatedText.查無工單);
      this.isButtonDisabled = false;  
  });
  
  }
  this.selectedERP='';
    },
    addManually(wo_Id) {
  // 使用 window.prompt 弹出提示框，接收用户输入
  const WO_IDNumber = window.prompt('請輸入料號：');
  const PARTNumber = window.prompt('請輸入料號：');
  const productName = window.prompt('請輸入品名：');
  const quantity = window.prompt('請輸入數量：');
  const STD = window.prompt('請輸入標準工時：');
  
  // 判断用户是否点击了取消按钮
  if (PARTNumber !== null && productName !== null && quantity !== null) {
    // 执行手动增加工单的逻辑，例如将输入的数据添加到 ERPDATA 数组
    this.ERPDATA.push({
      wadoco: wo_Id,
      walitm: PARTNumber,
      wadl01:productName,
      wauorg: quantity,
      wlrunl_sum:STD,
      // 其他属性...
  
    });
    this.isButtonDisabled = false;  
  } else {
    // 用户点击了取消按钮
    alert('取消手動增加工單');
    this.isButtonDisabled = false;  
  }
  
  },
  REWORK(item) {
  // 禁用按钮，防止重复点击
  this.isButtonDisabled = true;
  
  // 在 ERPDATA 中查找是否已经存在具有相同 WO_ID 的工作单
  const existingWorkOrderInERPDATA = this.ERPDATA.find(data => data.wadoco === item.WO_ID);
  
  // 如果工作单已存在，显示警告信息并重新启用按钮
  if (existingWorkOrderInERPDATA) {
    alert(this.translatedText.工單已存在);
    this.isButtonDisabled = false;
  } else {
    // 如果工作单不存在，将新的工作单数据推入 ERPDATA 数组
    this.ERPDATA.push({
      wadoco: item.WO_ID,
      walitm: item.PART_NO,
      wadl01: item.PART_DESC,
      wauorg: item.qty,
      wlrunl_sum: item.std,
      avgStdEff: item.PasstEFF 
      // 其他属性...
    });
    this.isButtonDisabled = false;
  }
  },
  
    completeTask(woId, nfcCode) {
    const area = this.selectedArea;
    const department = this.selectedDepartment;
    // 发起完成任务的 HTTP 请求
    fetch(`http://192.168.209.18:5088/api/lotend?area=${area}&department=${department}&NFC_code=${nfcCode}&woId=${woId}`)
      .then(response => response.json())
      .then(data => {
        // 处理成功完成任务的响应
        console.log('任务完成:', data);
        alert(this.translatedText.更新完成);
        this.fetchData2();
      })
      .catch(error => console.error('发生错误:', error));
  
  },
  delete_staffData(id) {
  
    const numericId = parseInt(id, 10);
  
  // 構建 DELETE 請求的主體
  const deleteData = {
  id: numericId,
  area: this.selectedArea
  };
  
  axios.delete('http://192.168.209.18:5088/api/Attendance/Delete', {
    data: deleteData,  // 將主體放入 data 選項
    headers: {
      'Content-Type': 'application/json'  // 設置 Content-Type 為 JSON
    }
  })
    .then(response => {
      // 在這裡處理成功的回應，如果需要的話
      console.log('刪除成功', response);
      this. staff_data();
      this.showActions = false;
    })
    .catch(error => {
      // 在這裡處理錯誤，如果需要的話
      console.error('刪除失敗', error);
  
    });
    console.log('selectedD:', id)
  },  
  UPDATE_staffData(ITEM) {
  
  
  
  // 构建 PUT 请求的主体
  const updateData = {
    id: ITEM.id.toString(),
    area: this.selectedArea,
    department: ITEM.department,
    jobnumber:ITEM.jobnumber,
    username:ITEM.username,
    work_department:ITEM.work_department
  };
  
  axios.put('http://192.168.209.18:5088/api/Attendance/UPDATE_USER', updateData, {
    headers: {
      'Content-Type': 'application/json'  // 设置 Content-Type 为 JSON
    }
  })
  .then(response => {
    // 处理成功的响应
    console.log('更新成功', response);
    this. staff_data();
      this.showActions = false;
  })
  .catch(error => {
    // 处理错误
    console.error('更新失败', error);
  });
  
  console.log('选中的数据:', updateData);
  
  
  },delete_hr(id) {
  
  const numericId = parseInt(id, 10);
  
  // 構建 DELETE 請求的主體
  const deleteData = {
  id: numericId,
  area: this.selectedArea
  };
  
  axios.delete('http://192.168.209.18:5088/api/Attendance/Delete_hr', {
  data: deleteData,  // 將主體放入 data 選項
  headers: {
  'Content-Type': 'application/json'  // 設置 Content-Type 為 JSON
  }
  })
  .then(response => {
  // 在這裡處理成功的回應，如果需要的話
  console.log('刪除成功', response);
  this. staff_data();
  this.showActions = false;
  })
  .catch(error => {
  // 在這裡處理錯誤，如果需要的話
  console.error('刪除失敗', error);
  
  });
  console.log('selectedD:', id)
  },
  openDateDialog(item) {
      this.REWOID = item;
      this.showDialog = true;
    },
    closeDialog() {
      this.showDialog = false;
      this.REWOID = null;
      this.selectedDate = null;
    },
    async updateReworkDate() {
      if (!this.selectedDate) {
        alert("請選擇日期！");
        return;
      }
  
      try {
        this.isButtonDisabled = true;
        console.log('id:', this.REWOID);
        console.log('reworkDate:', this.selectedDate);
        console.log('area:', this.selectedArea);
        const response = await axios.put(
          "http://192.168.209.18:5088/api/READWOID/UPDATE_rework_date",
          {
             area: this.selectedArea, // 根據需求傳入正確值
             reworkDate: this.selectedDate,
             id: String(this.REWOID), // 将 id 转换为字符串
          }
        );
  
        alert(response.data);
      } catch (error) {
        console.error("更新失敗", error);
        alert("更新失敗，請重試！");
      } finally {
        this.isButtonDisabled = false;
        this.closeDialog();
        this.fetchDPData();
        this.fetchData();
      }
    },
  showRemarkSelect(woId, nfcCode) {
      this.showSelect = true;       // 顯示下拉選單
      this.currentWoId = woId;      // 儲存當前工單ID
      this.currentNfcCode = nfcCode;// 儲存當前NFC代碼
    },
    closeModal() {
      this.showSelect = false;      // 關閉彈窗
      this.selectedRemark = "";    // 重置選項
    },
  pauseTask(woId, nfcCode) {
    if (this.selectedRemark) {    // 確認用戶選擇了原因
        const area = this.selectedArea;
        const department = this.selectedDepartment;
        const woId = this.currentWoId;
        const nfcCode = this.currentNfcCode;
        const remarkWithDate = this.selectedRemark;  
        const now = new Date();
    const reWORKDate = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;  
  
  
    // 发起暂停任务的 HTTP 请求
    fetch(`http://192.168.209.18:5088/api/lotend/PAUSE?area=${area}&department=${department}&NFC_code=${nfcCode}&woId=${woId}&REMARK=${remarkWithDate}&REWORK=${reWORKDate}`)
      .then(response => response.json())
      .then(data => {
        // 处理成功暂停任务的响应
        console.log('任务暂停:', data);
        this.fetchData2();
      })
      .catch(error => console.error('发生错误:', error));
        // 重置並隱藏下拉選單
        this.showSelect = false;
        this.selectedRemark = "";
        this.currentWoId = null;
        this.currentNfcCode = null;
  } else {
    console.log('用户取消了操作');
    // 可以添加相应的提示或处理
  }
  },
    getBackgroundColor(nfcCode) {
  // 根据 nfcCode 的值返回相应的颜色
  if (nfcCode === '01') {
    return '#4886ea';
  } else if (nfcCode === '02') {
    return 'darkgreen';
  } else if (nfcCode === '03') {
    return 'yellow';
  } else if (nfcCode === '04') {
    return '#bd91f3';
  } else if (nfcCode === '05') {
    return 'lightgreen';
  } else if (nfcCode === '06') {
    return 'orange';
  }  else {
    return ''; // 如果没有匹配的值，可以返回空字符串或其他默认值
  }
  
  },
  repassword(){
  this.SHOW_RATING_VERSON= false;
  this.SF_SN_MG=false,
  this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
     this.SHOW_PD_VERSON= false;
     this.SHOW_WO_VERSON= false;
     this.showyear= false;
      this.showCLASS= false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.showDemoContent = false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.fqc_mangeContent = false;
      this.isLoggedIn= false;
      this.repasswords= true;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
  },
  login_VERSON(){
  this.repasswords= false;
  this.SHOW_RATING_VERSON= false;
  this.SF_SN_MG=false,
  this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
     this.SHOW_PD_VERSON= false;
     this.SHOW_WO_VERSON= false;
     this.showyear= false;
      this.showCLASS= false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.showDemoContent = false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.fqc_mangeContent = false;
      this.isLoggedIn= true
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
  },
  effperformance(){
  this.repasswords= false;
  this.SF_SN_MG=false,
  this.SHOW_RATING_VERSON= false;
  this.SHOPSTcontent= false;
  this.SNLISTcontent= false;
  this.PDSNLISTcontent= false;
  this.FAILSNLISTcontent= false;
  this.SHOW_eff_performance= true;
  this.SHOW_overflow_performance= false;
  this.SHOW_PD_VERSON= false;
     this.SHOW_WO_VERSON= false;
     this.showyear= false;
      this.showCLASS= false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.showDemoContent = false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.fqc_mangeContent = false;
      this.isLoggedIn= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
      this.effper();
  
  },
  overflowperformance(){
  this.repasswords= false;
  this.SF_SN_MG=false,
  this.SHOW_RATING_VERSON= false;
  this.SHOPSTcontent= false;
  this.SNLISTcontent= false;
  this.PDSNLISTcontent= false;
  this.FAILSNLISTcontent= false;
  this.SHOW_eff_performance= false;
  this.SHOW_overflow_performance= true;
  this.SHOW_PD_VERSON= false;
     this.SHOW_WO_VERSON= false;
     this.showyear= false;
      this.showCLASS= false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.showDemoContent = false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.fqc_mangeContent = false;
      this.isLoggedIn= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
      this.overflowper();
  
  },
  WO_VERSON(){
  this.repasswords= false;
  this.SF_SN_MG=false,
  this.SHOW_RATING_VERSON= false;
  this.SHOPSTcontent= false;
  this.SNLISTcontent= false;
  this.PDSNLISTcontent= false;
  this.FAILSNLISTcontent= false;
  this.SHOW_eff_performance= false;
  this.SHOW_overflow_performance= false;
     this.SHOW_PD_VERSON= false;
     this.SHOW_WO_VERSON= true;
     this.showyear= false;
      this.showCLASS= false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.showDemoContent = false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.fqc_mangeContent = false;
      this.isLoggedIn= false;
      this.WO_SUM_VER();
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
  
  },
  RATING_VERSON(){
  this.repasswords= false;
  this.SF_SN_MG=false,
  this.SHOPSTcontent= false;
  this.SNLISTcontent= false;
  this.PDSNLISTcontent= false;
  this.FAILSNLISTcontent= false;
  this.SHOW_eff_performance= false;
  this.SHOW_overflow_performance= false;
     this.SHOW_PD_VERSON= false;
     this.SHOW_WO_VERSON= false;
     this.SHOW_RATING_VERSON= true;
     this.showyear= false;
      this.showCLASS= false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.showDemoContent = false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.fqc_mangeContent = false;
      this.isLoggedIn= false;
      this.RATING_SUM_VER();
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
  
  },
  PD_VERSON(){
  this.repasswords= false;
  this.SF_SN_MG=false,
  this.SHOW_RATING_VERSON= false;
  this.SHOPSTcontent= false;
  this.SNLISTcontent= false;
  this.PDSNLISTcontent= false;
  this.FAILSNLISTcontent= false;
  this.SHOW_eff_performance= false;
  this.SHOW_overflow_performance= false;
    this.SHOW_WO_VERSON= false;
     this.SHOW_PD_VERSON= true;
     this.showyear= false;
      this.showCLASS= false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.showDemoContent = false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.fqc_mangeContent = false;
      this.isLoggedIn= false;
      this.fetchCombinedVersions();
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
  
  },
  
  woerp_report(){
  this.repasswords= false;
  this.SF_SN_MG=false,
  this.SHOW_RATING_VERSON= false;
  this.SHOPSTcontent= false;
  this.SNLISTcontent= false;
  this.PDSNLISTcontent= false;
  this.FAILSNLISTcontent= false;
  this.SHOW_eff_performance= false;
  this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.fqc_mangeContent = false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= false,
      this.showDemoContent = false;
      this.seat_mangeContent = false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=true;
      this.woderp() ;
  },
  eff_report() {
  this.repasswords= false;
  this.SF_SN_MG=false,
  this.SHOW_RATING_VERSON= false;
  this.SHOPSTcontent= false;
  this.SNLISTcontent= false;
  this.PDSNLISTcontent= false;
  this.FAILSNLISTcontent= false;
  this.SHOW_eff_performance= false;
  this.SHOW_overflow_performance= false;
      // 點擊時設置 showRealTimeContent 為 false，並且 showDemoContent 為 true
      this.SHOW_WO_VERSON= false;
      this.SHOW_PD_VERSON= false,
      this.showyear= true,
      this.showCLASS= false,
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.showDemoContent = true;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.fqc_mangeContent = false;
      this.isLoggedIn= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
      
      this.$nextTick(() => {
        const iframe = this.$refs.demoIframe;
        if (iframe) {
          iframe.contentWindow.addEventListener('resize', () => {
            this.iframeHeight = iframe.contentDocument.body.scrollHeight;
          });
        }
      });
    },
    SHOP_ST() {
      this.repasswords= false;
      this.SF_SN_MG= false;
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= true;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= true,
        this.showDemoContent = false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.fqc_mangeContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
      this.fetchData();
    },
    SN_MG() {
      this.repasswords= false;
      this.SF_SN_MG=true,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= true,
        this.showDemoContent = false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.fqc_mangeContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
  
    },
    SNLIST() {
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= true;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= false,
        this.showDemoContent = false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.fqc_mangeContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
  
    },
    PDSNLIST() {
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= true;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= false,
        this.showDemoContent = false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.fqc_mangeContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
      this.SFPDSNLINK =[];
  
    },
    FAILSNLIST() {
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= true;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= false,
        this.showDemoContent = false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.fqc_mangeContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
      this.SFPDSNLINK =[];
  
    },
    showRealTime() {
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= true,
      this.showDemoContent = false;
      this.showRealTimeContent = true;
      this.showPDRealTimeContent= false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.fqc_mangeContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.fetchData();
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
      this.fetchTableData();
    },
    showPDRealTime() {
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= true,
      this.showDemoContent = false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= true;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.seat_mangeContent = false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.fqc_mangeContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
  
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
      this.fetchTableData();
    },
    fqc_mange(){
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= false,
      this.showDemoContent = false;
      this.seat_mangeContent = false;
      this.fqc_mangeContent = true;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
  
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
      this.fetchData();
      this.RATING_fetchData()
  
    },
    wo_select(){
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.fqc_mangeContent = false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= false,
      this.showDemoContent = false;
      this.seat_mangeContent = false;
      this.wo_mangeContent = false;
      this.wo_selectment= true;
      this.showRealTimeContent = false;
      this.staff_mangeContent = false;
      this.showPDRealTimeContent= false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
  
    },
    wo_mange() {
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.fqc_mangeContent = false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= true,
      this.showDemoContent = false;
      this.seat_mangeContent = false;
      this.wo_mangeContent = true;
      this.wo_selectment= false;
      this.showRealTimeContent = false;
      this.staff_mangeContent = false;
      this.showPDRealTimeContent= false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.fetchDPData();
      this.fetchData();
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
    },
    seat_mange() {
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.fqc_mangeContent = false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= true,
      this.showDemoContent = false;
      this.seat_mangeContent = true;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.postData();
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
    },
    staff_mange() {
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.fqc_mangeContent = false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= false,
      this.showDemoContent = false;
      this.seat_mangeContent = false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.staff_mangeContent = true;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.staff_data();
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
      
    },
    ATT_Abnormal(){
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.fqc_mangeContent = false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= false,
      this.showDemoContent = false;
      this.seat_mangeContent = false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = true;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.ATT_Abnorma_data();
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
  
  
    },
    ATT_timebt_confirm(){
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.fqc_mangeContent = false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= false,
      this.showDemoContent = false;
      this.seat_mangeContent = false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.att_hr_SUM_ADJ();
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.ATT_ADJ_confirm=true;
      this.woderpreport=false;
    },
    ATT_timebt(){
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.fqc_mangeContent = false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= false,
      this.showDemoContent = false;
      this.seat_mangeContent = false;
      this.showRealTimeContent = false;
      this.showPDRealTimeContent= false;
      this.wo_mangeContent = false;
      this.wo_selectment= false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = true;
      this.isLoggedIn= false;
      this.att_hr_SUM_data();
      this.CARD_mangeContent= false;
      this.shift_mangeContent= false;
      this.ATT_ADJ_confirm=false;
      this.woderpreport=false;
     
  
    },
    CARD_mange(){
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
      this.SHOW_WO_VERSON= false;
      this.fqc_mangeContent = false;
      this.SHOW_PD_VERSON= false,
      this.showyear= false,
      this.showCLASS= true,
      this.showDemoContent = false;
      this.seat_mangeContent = false;
      this.showRealTimeContent = false;
      this.wo_mangeContent = false;
      this.showPDRealTimeContent= false;
      this.wo_selectment= false;
      this.staff_mangeContent = false;
      this.ATT_AbnormalContent = false;
      this.ATT_timeContent = false;
      this.isLoggedIn= false;
      this.CARD_mangeContent= true;
      this.shift_mangeContent= false;
       this.machine_card=null;
       this.selectedmachine='';
       this.ATT_ADJ_confirm=false;
       this.woderpreport=false;
  
    },
    shift_mange(){
      this.repasswords= false;
      this.SF_SN_MG=false,
      this.SHOW_RATING_VERSON= false;
      this.SHOPSTcontent= false;
      this.SNLISTcontent= false;
      this.PDSNLISTcontent= false;
      this.FAILSNLISTcontent= false;
      this.SHOW_eff_performance= false;
      this.SHOW_overflow_performance= false;
  this.SHOW_WO_VERSON= false;
  this.fqc_mangeContent = false;
  this.SHOW_PD_VERSON= false,
  this.showyear= false,
  this.showCLASS= false,
  this.showDemoContent = false;
  this.seat_mangeContent = false;
  this.showRealTimeContent = false;
  this.showPDRealTimeContent= false;
  this.wo_mangeContent = false;
  this.wo_selectment= false;
  this.staff_mangeContent = false;
  this.ATT_AbnormalContent = false;
  this.ATT_timeContent = false;
  this.isLoggedIn= false;
  this.CARD_mangeContent= false;
  this.shift_mangeContent= true;
  this.machine_card=null;
  this.selectedmachine='';
  this.ATT_ADJ_confirm=false;
  this.woderpreport=false;
  this.shift_data();
  },
    handleInputChange() {
      this.updateTimeOptions(),
      this.setCookie('selectedArea', this.selectedArea, 30); // 在這裡，30 是 cookie 的有效期（天）
      this.setCookie('selectedD', this.selectedD, 30); // 在這裡，30 是 cookie 的有效期（天）
      this.setCookie('selectedS', this.selectedS, 30); // 在這裡，30 是 cookie 的有效期（天）
      this.setCookie('selectedC', this.selectedC, 30); // 在這裡，30 是 cookie 的有效期（天）
      this.setCookie('selectedL', this.selectedL, 30); // 在這裡，30 是 cookie 的有效期（天）
      // 在这里添加条件语句
      if (this.seat_mangeContent) {
            this.postData();
          }
          if (this.staff_mangeContent) {
            this.staff_data();
          }
          if (this.showRealTimeContent) {
            this.fetchData();
            this.fetchTableData();
            this.getEFFData()
          } 
          if (this.wo_mangeContent) {
            this.fetchData();
            this.fetchDPData();
  
  
          }
          if (this.fqc_mangeContent) {
            this.fetchData();
            this.RATING_fetchData()
       
          } if (this.SHOPSTcontent) {
            this.fetchData();
       
          }if (this.showPDRealTimeContent) {
            this.fetchTableData();
       
          }
  
  
  
  
    },
  
    async fetchData() {
      if (this.selectedL) {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + '-' + this.selectedL + 'C';
  } else {
  this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
  }
  
  if (this.selectedD && this.selectedS && this.selectedC) {
  
  
  this.loading = true;
  const apiUrl1 = `http://192.168.209.18:5088/api/READWOID?area=${this.selectedArea}&department=${this.selectedDepartment}`;
  const apiUrl2 = `http://192.168.209.18:5088/api/Query2?area=${this.selectedArea}&department=${this.selectedDepartment}`;
  
  // 使用 Promise.all 并行发起两个请求
  Promise.all([
    fetch(apiUrl1),
    fetch(apiUrl2)
  ])
    .then(responses => Promise.all(responses.map(response => response.json())))
    .then(data => {
      // data[0] 包含第一个请求的响应数据
      // data[1] 包含第二个请求的响应数据
      this.realTimeData = data[0];
      this.QUERRYTIME = data[1];
    })
    .catch(error => console.error('Error fetching data:', error))
        .finally(() => {
          this.loading = false;
          this.fetchOnlineData();
          this.fetchDPData();  
  
        });
      }
  },
  
    fetchData2() {
      const apiUrl = `http://192.168.209.18:5088/api/READWOID?area=${this.selectedArea}&department=${this.selectedDepartment}`;
  
      // Assuming you are using fetch API
      fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
          this.realTimeData = data;
        })
        .catch(error => console.error('Error fetching data:', error));  
        this.fetchDPData();  
    },
    fetchData3() {
  
      if (this.selectedD && this.selectedS && this.selectedC) {
        console.log('TIME:',  this.currentTime)
        if (this.selectedL) {
         this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + '-' + this.selectedL + 'C';
         } else {
            this.selectedDepartment = this.selectedD + 'D' + this.selectedS + 'S' + this.selectedC + 'C';
           }
  
  const apiUrl1 = `http://192.168.209.18:5088/api/READWOID?area=${this.selectedArea}&department=${this.selectedDepartment}`;
  const apiUrl2 = `http://192.168.209.18:5088/api/Query2?area=${this.selectedArea}&department=${this.selectedDepartment}`;
  
  // 使用 Promise.all 并行发起两个请求
  Promise.all([
    fetch(apiUrl1),
    fetch(apiUrl2)
  ])
    .then(responses => Promise.all(responses.map(response => response.json())))
    .then(data => {
      // data[0] 包含第一个请求的响应数据
      // data[1] 包含第二个请求的响应数据
      this.realTimeData = data[0];
      this.QUERRYTIME = data[1];
    })
    .catch(error => console.error('Error fetching data:', error))
        .finally(() => {
          this.fetchDPData();  
          this.fetchOnlineData();
  
        });
      }
  },
  getCurrentDate() {
      const today = new Date();
      const year = today.getFullYear();
      const month = String(today.getMonth() + 1).padStart(2, '0');
      const day = String(today.getDate()-1).padStart(2, '0');
      return `${year}-${month}-${day}`;
    },
    login2() {
      // 这里进行用户名和密码的验证
      if (this.username === 'admin' && this.password === 'admin') {
        this.isLoggedIn = false;
        this.power='T'
        this.power='T'
      } else {
        alert('Invalid username or password');
      }
    },
    async login() {
          try {
            const response = await axios.post('http://192.168.209.18:5088/api/LOGIN/login', this.credentials);
            this.user = response.data;
            this.isAuthenticated = true;
            this.isLoggedIn = false;
           this.power='T'
          } catch (error) {
            console.error('Login failed:', error);
            alert('Login failed!');
          }
        },
    logout() {
      // 这里进行用户名和密码的验证
  
        this.power='F'
        this.power='F'
        this.user = { permissions: [] };
        this.credentials = {
          username: '',
          password: '',
        };
    },
    savePreference() {
      // 保存偏好設置到 Cookie 中
  
    },
    setCookie(name, value, days) {
      const date = new Date();
      date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
      const expires = "expires=" + date.toUTCString();
      document.cookie = name + "=" + value + ";" + expires + ";path=/";
    },
    getCookie(name) {
      const cname = name + "=";
      const decodedCookie = decodeURIComponent(document.cookie);
      const cookieArray = decodedCookie.split(';');
      for (let i = 0; i < cookieArray.length; i++) {
        let c = cookieArray[i];
        while (c.charAt(0) === ' ') {
          c = c.substring(1);
        }
        if (c.indexOf(cname) === 0) {
          return c.substring(cname.length, c.length);
        }
      }
      return "";
    },
    setCookie2(name, value, days = 7) {
      const date = new Date();
      date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
      const expires = "expires=" + date.toUTCString();
      document.cookie = name + "=" + value + ";" + expires + ";path=/";
    },
    getCookie2(name) {
      const cookieName = name + "=";
      const decodedCookie = decodeURIComponent(document.cookie);
      const cookieArray = decodedCookie.split(';');
      for (let i = 0; i < cookieArray.length; i++) {
        let cookie = cookieArray[i];
        while (cookie.charAt(0) === ' ') {
          cookie = cookie.substring(1);
        }
        if (cookie.indexOf(cookieName) === 0) {
          return cookie.substring(cookieName.length, cookie.length);
        }
      }
      return null;
    },
  
  },
  created() {
  
    // 在组件创建时检查是否有 Cookie 记录
    const savedState = this.getCookie2('showInSecondTable');
    if (savedState) {
      this.showInSecondTable = JSON.parse(savedState);
    }
     console.log('showInSecondTable:',  this.showInSecondTable)
  },
  mounted() {
  
    window.addEventListener('keydown', this.handleKeydown);
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    const yyyy = yesterday.getFullYear();
    const mm = String(yesterday.getMonth() + 1).padStart(2, '0'); // 加一是因为月份从0开始计数
    const dd = String(yesterday.getDate()).padStart(2, '0');
    this.selectedDate = `${yyyy}-${mm}-${dd}`;
    const savedselectedArea= this.getCookie('selectedArea');
    const savedsselectedD= this.getCookie('selectedD');
    const savedsselectedS= this.getCookie('selectedS');
    const savedselectedC= this.getCookie('selectedC');
    const savedselectedL= this.getCookie('selectedL');
    //const savedshowInSecondTable= this.getCookie2('showInSecondTable');
   // this.showInSecondTable = savedshowInSecondTable;
   // console.log('selectedD:',  this.showInSecondTable)
  
    if (savedselectedArea) {
      this.selectedArea = savedselectedArea;
    }
    if (savedsselectedD) {
      this.selectedD = savedsselectedD;
    }
    if (savedsselectedS) {
      this.selectedS = savedsselectedS;
    }
    if (savedselectedC) {
      this.selectedC = savedselectedC;
    }
    if (savedselectedL) {
      this.selectedL = savedselectedL;
    }   
  
    this.MFG_D = this.getCurrentDate();
    this.fetchTableData();
    setInterval(() => {
      this.currentTime = new Date().toLocaleTimeString();
    }, 1000);
    // Refresh data every minute
    setInterval(() => {
      if (this.showRealTimeContent) {
        this.fetchData3();
        
      }
    }, 15000);
    this.getEFFData()
    this.updateTimeOptions();
    
   },
  
  
  });
  
  </script>

</body>
</html>
